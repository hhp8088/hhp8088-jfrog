<!DOCTYPE html>
<!-- saved from url=(0062)https://cloud.tencent.com/developer/article/2233624?from=15425 -->
<html lang="zh"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style class="vjs-styles-defaults">
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid {
        padding-top: 56.25%
      }
    </style><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="format-detection" content="telephone=no"><title>使用 Docker 来快速上手中文 Stable Diffusion 模型：太乙-腾讯云开发者社区-腾讯云</title><meta name="subject" content="通用技术-服务器技术-docker,通用技术-网络技术-https,通用技术-网络技术-网络安全,通用技术-服务器技术-容器"><meta name="subjectTime" content="2023-03-05 17:35:34"><meta name="articleSource" content="W"><meta name="magicSource" content="N"><meta name="authorType" content="O,Z"><meta name="keywords" content="docker,https,网络安全,容器"><meta name="description" content="本篇文章，我们聊聊如何使用 Docker 快速运行中文 Stable Diffusion 模型：太乙。"><meta property="og:title" content="使用 Docker 来快速上手中文 Stable Diffusion 模型：太乙-腾讯云开发者社区-腾讯云"><meta property="og:description" content="本篇文章，我们聊聊如何使用 Docker 快速运行中文 Stable Diffusion 模型：太乙。"><meta property="og:image" content="https://cloudcache.tencentcs.com/open_proj/proj_qcloud_v2/gateway/shareicons/cloud.png"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover"><link rel="dns-prefetch" href="https://qccommunity.qcloudimg.com/"><link rel="dns-prefetch" href="https://ask.qcloudimg.com/"><link rel="dns-prefetch" href="https://cloudcache.tencentcs.com/"><link rel="canonical" href="https://cloud.tencent.com/developer/article/2233624"><meta name="next-head-count" content="19"><link rel="stylesheet" href="./docker-compose_files/base.css"><link rel="stylesheet" href="./docker-compose_files/base-202312191831.css"><link rel="stylesheet" href="./docker-compose_files/Article-202312181805.css"><link rel="stylesheet" href="./docker-compose_files/draft-master-v2.0.41.d4s2ddo9sb.css"><link rel="stylesheet" href="./docker-compose_files/tcplayer.min.css"><script async="" src="./docker-compose_files/gtm.js"></script><script async="" src="./docker-compose_files/analytics.js"></script><script src="./docker-compose_files/aegis.min.js"></script><script>
              if (Aegis) {
                new Aegis({
                  id: 'dWlmyFvjDnalkbZO8q',
                  env: 'production',
                  onError: true,
                  pagePerformance: true,
                  reportAssetSpeed: true,
                  api: {
                    reportRequest: true,
                    resHeaders: ['x-req-id'],
                  },
                  reportApiSpeed: true,
                  beforeRequest: function (data) {
                    // load js failed
                    if (data.logType === 'log') {
                      if (data.logs.level === '32' && data.logs.msg.indexOf('google') > -1) return false;
                    }
                    var ignoreKeys = [
                      'Script error',
                      'chrome-extension',
                      'qq.com',
                      'queryWeappQrcodeStatus',
                      'login/ajax/info',
                      'woa.com',
                      'trafficCollect.php',
                      'google',
                      'dscache',
                      'act-api',
                      'set_qc_cookie',
                      'opc.cloud.tencent.com',
                      'uc_gre_ad_buss',
                      'eb.xcj.pub',
                      'UCShellJava',
                      '/developer/labs/quick/loader',
                      'edgeImmersiveReaderDOM',
                      'sendBeacon',
                      'error-decoder.html'
                    ];
                    var alarmMsg = [data.logs.url, data.logs.msg].join('|');
                    for (var i = 0; i < ignoreKeys.length; i++) {
                      if (alarmMsg.indexOf(ignoreKeys[i]) != -1) return false;
                    }
                    if (/bot|wechatdevtools|spider/i.test(navigator.userAgent)) {
                      return false;
                    }
                    if (location.hostname.indexOf('cloud.tencent.') === -1) {
                      return false;
                    }
                  },
                });
              }
    </script><link rel="preload" href="./docker-compose_files/c497a9b824fd12ec.css" as="style"><link rel="stylesheet" href="./docker-compose_files/c497a9b824fd12ec.css" data-n-g=""><noscript data-n-css=""></noscript><script defer="" nomodule="" src="./docker-compose_files/polyfills-c67a75d1b6f99dc8.js"></script><script src="./docker-compose_files/webpack-fae4559da4a9d65b.js" defer=""></script><script src="./docker-compose_files/framework-fd8364d81523c58f.js" defer=""></script><script src="./docker-compose_files/main-938953b898fa8efe.js" defer=""></script><script src="./docker-compose_files/_app-1f5e1719145fff98.js" defer=""></script><script src="./docker-compose_files/f69bbb46-eed95df46583a2d8.js" defer=""></script><script src="./docker-compose_files/5039-50388001f0796aef.js" defer=""></script><script src="./docker-compose_files/3127-5635ce800957003b.js" defer=""></script><script src="./docker-compose_files/9583-b89b3722d0ea2b6c.js" defer=""></script><script src="./docker-compose_files/9784-eb47b99c688bd3d7.js" defer=""></script><script src="./docker-compose_files/3337-b892661cc815903e.js" defer=""></script><script src="./docker-compose_files/3102-bce09e4469063d1c.js" defer=""></script><script src="./docker-compose_files/1578-8cdd16d067bf3722.js" defer=""></script><script src="./docker-compose_files/2388-39be2d1cc4ec2681.js" defer=""></script><script src="./docker-compose_files/5137-02092d110b508275.js" defer=""></script><script src="./docker-compose_files/4941-4c5a5a08edd16a12.js" defer=""></script><script src="./docker-compose_files/7940-a3469db3a5cb0d1f.js" defer=""></script><script src="./docker-compose_files/9543-ef67e8ac882285fa.js" defer=""></script><script src="./docker-compose_files/1092-1a258d13623583b7.js" defer=""></script><script src="./docker-compose_files/5503-90085f34c00dc3ee.js" defer=""></script><script src="./docker-compose_files/7974-3e12975d1ffacad3.js" defer=""></script><script src="./docker-compose_files/[articleId]-c8508c0d58969d91.js" defer=""></script><script src="./docker-compose_files/_buildManifest.js" defer=""></script><script src="./docker-compose_files/_ssgManifest.js" defer=""></script><script type="text/javascript" async="" src="./docker-compose_files/MathJax.js"></script><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><script type="text/javascript" async="" src="./docker-compose_files/f.txt"></script><script type="text/javascript" async="" src="./docker-compose_files/f(1).txt"></script><style id="dynamic-inserted-css-tea-transition-scale-736984168">
.tea-transition-scale-736984168-enter {
    opacity: 0 !important;
    transform: scale3d(0.94, 0.94, 0.94);
    transform-origin: top;
}
.tea-transition-scale-736984168-enter-active {
    opacity: 1 !important;
    transform: scale3d(1, 1, 1);
    transition: opacity 50ms ease,
                transform 50ms ease;
    transform-origin: top;
}
.tea-transition-scale-736984168-exit {
    opacity: 1 !important;
    transform: scale3d(1, 1, 1);
    transform-origin: top;
}
.tea-transition-scale-736984168-exit-active {
    opacity: 0 !important;
    transform: scale3d(0.94, 0.94, 0.94);
    transition: opacity 300ms ease,
                transform 300ms ease;
    transform-origin: top;
}
</style><style id="dynamic-inserted-css-tea-transition-scale-1610162950">
.tea-transition-scale-1610162950-enter {
    opacity: 0 !important;
    transform: scale3d(0.94, 0.94, 0.94);
    transform-origin: left;
}
.tea-transition-scale-1610162950-enter-active {
    opacity: 1 !important;
    transform: scale3d(1, 1, 1);
    transition: opacity 50ms ease,
                transform 50ms ease;
    transform-origin: left;
}
.tea-transition-scale-1610162950-exit {
    opacity: 1 !important;
    transform: scale3d(1, 1, 1);
    transform-origin: left;
}
.tea-transition-scale-1610162950-exit-active {
    opacity: 0 !important;
    transform: scale3d(0.94, 0.94, 0.94);
    transition: opacity 300ms ease,
                transform 300ms ease;
    transform-origin: left;
}
</style></head><body class=""><div id="MathJax_Message" style="display: none;"></div><div id="__next"><div class="cdc-responsive-layout" aegis-first-screen-timing="true"><div class="cdc-article-page cdc-global"><div class="cdc-sticky-header mod-sticky-header" style="left: 0px;"><div class="cdc-sticky-header__inner"><div class="cdc-sticky-header__main"><div class="mod-sticky-header__main"><div class="mod-sticky-header__author"><span class="cdc-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/1436546" target="_blank" style="background-image: url(&quot;https://ask.qcloudimg.com/http-save/yehe-1436546/8ff3879a73799b17b355bfdd88337c0b.jpg&quot;);"></a></span><div class="author-info"><a class="author-info__name" href="https://cloud.tencent.com/developer/user/1436546" target="_blank"><span class="name-text">soulteary</span></a><div class="author-info__article"><a track-click="" track-exposure="" class="cdc-link blue" href="https://cloud.tencent.com/developer/user/1436546/articles" target="_blank">334篇文章</a></div></div></div><div class="mod-sticky-header__split"></div><div class="mod-sticky-header__title"><h2 class="title-text">使用 Docker 来快速上手中文 Stable Diffusion 模型：太乙</h2></div></div></div><div class="cdc-sticky-header__extra"><div class="mod-sticky-header__operates"><button class="cdc-btn mod-sticky-header__operate btn-focus cdc-btn--primary"><i class="add-icon"></i><span>关注作者</span></button><a class="cdc-btn mod-sticky-header__operate cdc-btn--hole" href="https://cloud.tencent.com/developer/column/73784" target="_blank">前往专栏</a></div></div></div></div><div class="cdc-header cdc-header--block"><div class="cdc-header__placeholder"></div><div class="cdc-header__inner"><div class="cdc-header__top"><div class="cdc-header__top-left"><a href="https://cloud.tencent.com/?from=20060&amp;from_column=20060" target="_blank" class="cdc-header__top-logo" track-click="{&quot;areaId&quot;:102001,&quot;subAreaId&quot;:1}"><i>腾讯云</i></a><div class="cdc-header__top-line"></div><a href="https://cloud.tencent.com/developer" class="cdc-header__top-logo community"><i>开发者社区</i></a><div class="cdc-header__activity"><div class="cdc-header__activity-con"><div class="cdc-header__activity-desc">2核2G云服务器62元/年</div><a class="cdc-header__activity-link">立即购买 &gt;</a></div></div></div><div class="cdc-header__top-operates"><a href="https://cloud.tencent.com/document/product?from=20702&amp;from_column=20702" target="_blank" class="cdc-header__link">文档</a><a href="https://cloud.tencent.com/voc/?from=20703&amp;from_column=20703" target="_blank" class="cdc-header__link">意见反馈</a><a href="https://console.cloud.tencent.com/?from=20063&amp;from_column=20063" target="_blank" class="cdc-header__link" track-click="{&quot;areaId&quot;:102001,&quot;subAreaId&quot;:1}">控制台</a></div></div><div class="cdc-header__bottom"><div class="cdc-header__bottom-nav"><a href="https://cloud.tencent.com/developer" class="cdc-header__bottom-home">首页</a><div class="cdc-header__nav-list"><div class="cdc-header__nav-item">学习</div><div class="cdc-header__nav-item">活动</div><div class="cdc-header__nav-item">专区</div><div class="cdc-header__nav-item">工具</div></div><a href="https://cloud.tencent.com/tvp?from=20154&amp;from_column=20154" class="cdc-header__tvp" target="_blank">TVP</a><div class="cdc-header__activity"><a class="cdc-header__activity-tit" href="https://cloud.tencent.com/act?from=20061&amp;from_column=20061" target="_blank">最新优惠活动<div class="cdc-badge"><div class="cdc-badge-inner"><div class="cdc-badge-text"></div></div></div></a></div><a track-click="{&quot;areaId&quot;:1000,&quot;objectType&quot;:&quot;ad&quot;,&quot;objectId&quot;:1268}" track-exposure="{&quot;areaId&quot;:1000,&quot;objectType&quot;:&quot;ad&quot;,&quot;objectId&quot;:1268}" href="https://cloud.tencent.com/act/pro/bestselling?from=20190&amp;from_column=20190#newuser" target="_blank" class="cdc-header__capsule"><img src="./docker-compose_files/20231227-76e16eb2.png" alt="广告"></a></div><div class="cdc-header__bottom-operates"><div class="cdc-header__search"><div class="cdc-search__wrap"><div class="cdc-search"><span class="cdc-search__text">文章/答案/技术大牛</span><button class="cdc-search__btn">搜索<i class="cdc-search__i search"></i></button></div><div class="cdc-search__dropdown"><div class="cdc-search__bar"><input type="text" class="cdc-search__bar-input" placeholder="文章/答案/技术大牛" value=""><div class="cdc-search__bar-btns"><button class="cdc-search__btn">搜索<i class="cdc-search__i search"></i></button><button class="cdc-search__btn">关闭<i class="cdc-search__i clear"></i></button></div></div></div></div></div><div class="cdc-header__create"><span class="cdc-header__create-btn"><span class="cdc-svg-icon-con"><span class="cdc-svg-icon" style="width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path d="M14.2466 12.0145C14.1698 13.6258 12.8381 14.9131 11.2129 14.9131H11.1579H4.0927H4.03772C2.4125 14.9131 1.08014 13.6258 1.00334 12.0145H1V11.8668V4.07213V4.04627V3.89922H1.00334C1.08014 2.28732 2.4125 1 4.03772 1H9.6473V1.00069H10.0786L8.7688 2.10773H8.43888H7.7916H6.37904H4.03772C2.97234 2.10773 2.10445 2.9777 2.10445 4.04629V4.41869V4.4472V6.39498V11.4269V11.4309V11.8668C2.10445 12.9354 2.97234 13.8053 4.03772 13.8053H6.37904H8.87153H11.2129C12.2782 13.8053 13.1461 12.9355 13.1461 11.8668V11.466V11.454V9.5181V6.39364L14.2506 5.3051V11.8668V12.0145H14.2466ZM10.4324 7.15226L9.63146 7.99761C9.36577 8.2693 8.69326 8.95104 8.48066 9.17631C8.26726 9.40288 8.09039 9.58901 7.95061 9.73544C7.81079 9.88188 7.72667 9.96597 7.70083 9.98656C7.63321 10.0488 7.55703 10.1144 7.47022 10.1846C7.38412 10.2542 7.29404 10.3099 7.20063 10.3516C7.10722 10.4007 6.97072 10.459 6.79049 10.5305C6.61028 10.6001 6.42213 10.6676 6.22468 10.7339C6.02792 10.8002 5.84109 10.8571 5.66484 10.9061C5.48795 10.9538 5.3561 10.9863 5.2693 11.0009C5.08977 11.0214 4.96988 10.993 4.90956 10.9168C4.84931 10.8405 4.83276 10.7107 4.85924 10.5312C4.87315 10.4331 4.9043 10.292 4.95468 10.1078C5.00431 9.92297 5.05802 9.7315 5.11431 9.53341C5.1713 9.33526 5.22629 9.15179 5.27926 8.98484C5.33297 8.8179 5.37599 8.7026 5.40978 8.64032C5.44953 8.54357 5.49463 8.45413 5.54495 8.37399C5.59465 8.29379 5.66616 8.20503 5.75965 8.10766C5.79934 8.06588 5.89281 7.96649 6.03988 7.81018C6.18624 7.65311 6.80114 7.02774 7.02104 6.79783L7.75117 6.03524L8.56212 5.1899L10.6345 3.02466L12.5214 4.93874L10.4324 7.15226ZM13.816 3.58581C13.7166 3.68987 13.6272 3.78064 13.5483 3.85883C13.4694 3.93703 13.4006 4.0066 13.3423 4.06686C13.276 4.13643 13.2144 4.19738 13.1561 4.24903L11.2785 2.33569C11.3785 2.24025 11.4965 2.12565 11.6336 1.99115C11.7707 1.85668 11.8854 1.75061 11.9761 1.67242C12.0934 1.57708 12.2133 1.51013 12.3385 1.47109C12.4525 1.43529 12.5644 1.41805 12.6751 1.41876H12.7056C12.7665 1.42139 12.8268 1.42729 12.8851 1.43724C12.8838 1.4366 12.8811 1.43724 12.8798 1.4366C12.8811 1.4366 12.8838 1.4366 12.8851 1.43724C13.1376 1.48428 13.4019 1.62009 13.6265 1.83743C13.7511 1.95871 13.8524 2.09382 13.9259 2.23296C14.0346 2.43834 14.0863 2.65304 14.0763 2.8491C14.0763 2.87294 14.0783 2.89748 14.0783 2.92201C14.0783 3.03529 14.0571 3.14789 14.0154 3.26055C13.9737 3.37314 13.9067 3.48185 13.816 3.58581Z" fill="white"></path></svg></span></span>发布<span class="cdc-svg-icon-con cdc-header__create-btn-arrow"><span class="cdc-svg-icon" style="width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path d="M8.16377 4L9.57798 5.41421L14.5277 10.364L13.1135 11.7782L8.1638 6.829L3.21402 11.7782L1.7998 10.364L8.16377 4Z"></path></svg></span></span></span></div><div class="cdc-header__account"><div class="cdc-header__account-inner"><button class="cdc-btn cdc-header__account-btn cdc-btn--primary">登录/注册</button></div></div></div></div></div></div><div class="cdc-m-sticky-header is-sticky"><div class="cdc-m-sticky-header__placeholder"></div><div class="cdc-m-sticky-header__main"><div class="cdc-m-sticky-header__con"><div class="cdc-m-sticky-header__trigger"></div><div class="cdc-m-header-article__menu"><div class="cdc-m-header-article__menu-mask"></div><div class="cdc-m-header-article__menu-side"><div class="cdc-m-header__sidebar"><div class="cdc-m-header__sidebar-top"><i class="cdc-m-header__sidebar-top__logo"></i><span class="cdc-m-header__sidebar-top__back"></span></div><div class="cdc-m-header__sidebar-menus"><div class="cdc-m-header__sidebar-capsule"><img src="./docker-compose_files/20231227-1852f419.png" alt="广告"></div><a href="https://cloud.tencent.com/developer" class="cdc-m-header__sidebar-menu link">首页</a><div class="tpm1-collapse"><div class="tpm1-collapse__panel"><header class="tpm1-collapse__panel-hd"><div class="tpm1-collapse__panel-title">学习</div></header></div><div class="tpm1-collapse__panel"><header class="tpm1-collapse__panel-hd"><div class="tpm1-collapse__panel-title">活动</div></header></div><div class="tpm1-collapse__panel"><header class="tpm1-collapse__panel-hd"><div class="tpm1-collapse__panel-title">专区</div></header></div><div class="tpm1-collapse__panel"><header class="tpm1-collapse__panel-hd"><div class="tpm1-collapse__panel-title">工具</div></header></div></div><a href="https://cloud.tencent.com/tvp?from=20154&amp;from_column=20154" class="cdc-m-header__sidebar-menu link">TVP</a><a class="cdc-m-header__sidebar-activity" href="https://cloud.tencent.com/act?from=20061&amp;from_column=20061" target="_blank">最新优惠活动<div class="cdc-badge"><div class="cdc-badge-inner"><div class="cdc-badge-text"></div></div></div></a></div><div class="cdc-m-header__sidebar-back"><a href="https://cloud.tencent.com/?from=20060&amp;from_column=20060" class="cdc-m-header__sidebar-back__link"><i></i><span>返回腾讯云官网</span></a></div></div></div></div><div class="cdc-m-sticky-header__author"><span class="cdc-avatar large circle" style="cursor: unset;"><span class="cdc-avatar__inner" style="background-image: url(&quot;https://ask.qcloudimg.com/http-save/yehe-1436546/8ff3879a73799b17b355bfdd88337c0b.jpg&quot;);"></span></span><div class="cdc-m-sticky-header__author-name">soulteary</div></div></div><div class="cdc-m-sticky-header__extra"><div class="cdc-m-sticky-header__extra-icon"><i class="extra-search"></i></div><div class="cdc-m-sticky-header__extra-icon"><i class="extra-share"></i></div><div class="cdc-m-sticky-header__extra-operate"><div class="cdc-m-sticky-header__extra-icon"><i class="extra-man"></i></div></div></div></div></div><div class="cdc-m-header-article"><div class="cdc-m-header-article__placeholder"></div><div class="cdc-m-header-article__content"><div class="cdc-m-header-article__main"><div class="cdc-m-header-article__con"><div class="cdc-m-header-article__trigger"></div><div class="cdc-m-header-article__menu"><div class="cdc-m-header-article__menu-mask"></div><div class="cdc-m-header-article__menu-side"><div class="cdc-m-header__sidebar"><div class="cdc-m-header__sidebar-top"><i class="cdc-m-header__sidebar-top__logo"></i><span class="cdc-m-header__sidebar-top__back"></span></div><div class="cdc-m-header__sidebar-menus"><div class="cdc-m-header__sidebar-capsule"><img src="./docker-compose_files/20231227-1852f419.png" alt="广告"></div><a href="https://cloud.tencent.com/developer" class="cdc-m-header__sidebar-menu link">首页</a><div class="tpm1-collapse"><div class="tpm1-collapse__panel"><header class="tpm1-collapse__panel-hd"><div class="tpm1-collapse__panel-title">学习</div></header></div><div class="tpm1-collapse__panel"><header class="tpm1-collapse__panel-hd"><div class="tpm1-collapse__panel-title">活动</div></header></div><div class="tpm1-collapse__panel"><header class="tpm1-collapse__panel-hd"><div class="tpm1-collapse__panel-title">专区</div></header></div><div class="tpm1-collapse__panel"><header class="tpm1-collapse__panel-hd"><div class="tpm1-collapse__panel-title">工具</div></header></div></div><a href="https://cloud.tencent.com/tvp?from=20154&amp;from_column=20154" class="cdc-m-header__sidebar-menu link">TVP</a><a class="cdc-m-header__sidebar-activity" href="https://cloud.tencent.com/act?from=20061&amp;from_column=20061" target="_blank">最新优惠活动<div class="cdc-badge"><div class="cdc-badge-inner"><div class="cdc-badge-text"></div></div></div></a></div><div class="cdc-m-header__sidebar-back"><a href="https://cloud.tencent.com/?from=20060&amp;from_column=20060" class="cdc-m-header__sidebar-back__link"><i></i><span>返回腾讯云官网</span></a></div></div></div></div></div><div class="cdc-m-header-article__title"><div class="cdc-m-header-article__title-logo"></div></div><div class="cdc-m-header-article__extra"><div class="cdc-m-header-article__extra-icon"><i class="extra-search"></i></div><div class="cdc-m-header-article__extra-operate"><div class="cdc-m-header-article__extra-icon"><i class="extra-man"></i></div></div></div></div></div></div><div class="cdc-global__main"><div class="cdc-article__body"><div class="cdc-layout"><div class="cdc-layout__main"><div class="cdc-crumb mod-crumb"><div class="cdc-crumb__inner"><a class="cdc-crumb__item" href="https://cloud.tencent.com/developer">社区首页</a><span class="cdc-crumb__split"> &gt;</span><a class="cdc-crumb__item" href="https://cloud.tencent.com/developer/column">专栏</a><span class="cdc-crumb__split"> &gt;</span><a class="cdc-crumb__item" href="https://cloud.tencent.com/developer/column/73784">为了不折腾而去折腾的那些事</a><span class="cdc-crumb__split"> &gt;</span><span class="cdc-crumb__item current">使用 Docker 来快速上手中文 Stable Diffusion 模型：太乙</span></div></div><div class="mod-article-content"><div class="mod-header"><div class="mod-header__top"><div class="mod-header__title"><h1 class="title-text">使用 Docker 来快速上手中文 Stable Diffusion 模型：太乙</h1></div></div><div class="mod-article-source header"><div class="mod-article-source__main"><div class="mod-article-source__avatar"><img src="./docker-compose_files/8ff3879a73799b17b355bfdd88337c0b.jpg" alt="作者头像"></div><div class="mod-article-source__detail"><div class="mod-article-source__name"><span>soulteary</span></div></div><button class="cdc-btn mod-article-source__operate cdc-btn--primary"><span><i></i>关注</span></button></div></div><div class="mod-header__bottom"><div class="mod-header__detail"><div class="mod-header__date"><span class="date-text">发布于 2023-03-05 17:35:34</span></div><div class="mod-header__infos"><div class="cdc-icon__list"><span class="cdc-svg-icon-con"><span class="cdc-svg-icon" style="width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><g id="icon-view" transform="translate(0.000000, 3.000000)" fill="currentcolor" fill-rule="nonzero"><path d="M15.885,4.68036 C14.9951,3.57569 11.7987,-0.004272 7.99883,-0.004272 C4.19895,-0.004272 1.02302,3.57569 0.112682,4.68036 C0.040058,4.77107 0.000488281,4.88381 0.000488281,5 C0.000488281,5.1162 0.040058,5.22894 0.112682,5.31964 C1.00767,6.42432 4.20407,10.0043 7.99883,10.0043 C11.7936,10.0043 14.9951,6.42432 15.885,5.31964 C15.9576,5.22894 15.9972,5.1162 15.9972,5 C15.9972,4.88381 15.9576,4.77107 15.885,4.68036 Z M7.99883,8.97632 C4.93029,8.97632 2.25555,6.25043 1.17644,4.99745 C2.25555,3.74446 4.95586,1.01857 7.99883,1.01857 C11.0418,1.01857 13.7421,3.74446 14.8314,4.99745 C13.7421,6.25043 11.0418,8.97632 7.99883,8.97632 Z" id="形状"></path><path d="M7.97304,2.55286 C7.49865,2.55286 7.03491,2.69353 6.64046,2.95709 C6.24602,3.22065 5.93859,3.59525 5.75704,4.03354 C5.5755,4.47182 5.528,4.95409 5.62055,5.41937 C5.7131,5.88465 5.94154,6.31203 6.27699,6.64748 C6.61244,6.98293 7.03982,7.21137 7.5051,7.30392 C7.97038,7.39647 8.45265,7.34897 8.89093,7.16743 C9.32922,6.98588 9.70382,6.67845 9.96738,6.28401 C10.2309,5.88956 10.3716,5.42582 10.3716,4.95143 C10.3716,4.31529 10.1189,3.7052 9.66909,3.25538 C9.21927,2.80556 8.60918,2.55286 7.97304,2.55286 Z M7.97304,6.32716 C7.70095,6.32716 7.43496,6.24647 7.20872,6.09531 C6.98249,5.94414 6.80616,5.72928 6.70203,5.4779 C6.59791,5.22652 6.57066,4.94991 6.62374,4.68304 C6.67683,4.41617 6.80785,4.17104 7.00025,3.97864 C7.19265,3.78625 7.43778,3.65522 7.70465,3.60214 C7.97151,3.54905 8.24813,3.5763 8.49951,3.68042 C8.75089,3.78455 8.96575,3.96088 9.11692,4.18712 C9.26808,4.41335 9.34877,4.67934 9.34877,4.95143 C9.35012,5.13295 9.31553,5.31295 9.247,5.48104 C9.17846,5.64913 9.07734,5.802 8.94946,5.93084 C8.82158,6.05967 8.66946,6.16192 8.50188,6.2317 C8.3343,6.30147 8.15457,6.33739 7.97304,6.33739 L7.97304,6.32716 Z" id="形状"></path></g></svg></span><span class="cdc-svg-icon-text">1.8K</span></span><span class="cdc-svg-icon-con is-comment"><span class="cdc-svg-icon" style="width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 13.414L5.58594 11H2V3H14V11H10.4141L8 13.414ZM5.17175 12L8 14.8282L10.8282 12H15V2H1V12H5.17175ZM4 6C3.44775 6 3 6.44769 3 7C3 7.55231 3.44775 8 4 8C4.55225 8 5 7.55231 5 7C5 6.44769 4.55225 6 4 6ZM7 7C7 6.44769 7.44775 6 8 6C8.55225 6 9 6.44769 9 7C9 7.55231 8.55225 8 8 8C7.44775 8 7 7.55231 7 7ZM12 6C11.4478 6 11 6.44769 11 7C11 7.55231 11.4478 8 12 8C12.5522 8 13 7.55231 13 7C13 6.44769 12.5522 6 12 6Z"></path></svg></span><span class="cdc-svg-icon-text">0</span></span></div></div><div class="mod-header__date is-mobile"><span class="date-text">发布于 2023-03-05 17:35:34</span></div></div><div class="mod-header__operates"><div class="mod-header__operate"><span class="cdc-svg-icon-con is-operate"><span class="cdc-svg-icon" style="width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.21101 2.54545C8.80733 1.81818 7.79814 1.81818 7.39446 2.54545L1.94481 12.3636C1.54113 13.0909 2.04573 14 2.85308 14H13.7524C14.5597 14 15.0643 13.0909 14.6607 12.3636L9.21101 2.54545ZM2.85308 12.9091L8.30273 3.09091L13.7524 12.9091H2.85308ZM8.00037 6H9.00037V10H8.00037V6ZM8.00037 11H9.00037V12H8.00037V11Z" fill="currentcolor"></path></svg></span><span class="cdc-svg-icon-text">举报</span></span></div></div></div></div><div class="mod-content"><div class="mod-content__markdown"><div><div class="rno-markdown new-version rno-"><p>本篇文章，我们聊聊如何使用 Docker 快速运行中文 <span class="mod-overview__keyword">Stable Diffusion</span> 模型：太乙。</p><h3 id="2rs84" name="%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><strong>写在前面</strong></h3><p>上个月的时候，有朋友和我推荐了一个 “Stable Diffusion” 模型，来自<strong>深圳大湾区数字经济研究院(IDEA)[1]</strong>的<strong>封神榜大模型[2]</strong>中的 “太乙” 。</p><figure class=""><div class="rno-markdown-img-url" style="text-align: center;"><div class="rno-markdown-img-url-inner" style="width: 100%;"><img src="./docker-compose_files/3e03450ecbe9a306120e8d848dfd6098.jpg"></div></div></figure><p>AI 生成 “醉里不知天在水，满船清梦压星河”</p><p>最近想起来，想本地运行试试看，根据官方开源<strong>仓库的指引[3]</strong>和 <strong>Issue 里的记录[4]</strong>，发现<strong>如果用官方提供的</strong><a href="https://cloud.tencent.com/product/tcr?from_column=20065&amp;from=20065" target="_blank" class="rno-markdown__textlink-new" track-click="{&quot;areaId&quot;:0,&quot;objectId&quot;:466,&quot;positionId&quot;:466,&quot;objectName&quot;:&quot;,[object Object]&quot;,&quot;objectType&quot;:&quot;link&quot;}" track-exposure="{&quot;areaId&quot;:0,&quot;objectId&quot;:466,&quot;positionId&quot;:466,&quot;objectName&quot;:&quot;,[object Object]&quot;,&quot;objectType&quot;:&quot;link&quot;}" style="color: rgb(0, 82, 217);"><strong>容器镜像</strong></a><strong>跑“太乙”，这个项目根本跑不起来</strong>。</p><p>于是，花了一些时间，封装了一个可以一键运行、开箱即用的模型镜像。完整代码开源在 <strong>github.com/soulteary/docker-stable-diffusion-taiyi[5]</strong>，有需要的同学自取。</p><p>这篇文章，我将记录下来折腾过程，希望能帮助到有相同需求，想要快速运行这个模型，找乐子的同学。</p><p>当然，也希望这篇文章，能够帮到将模型开源开放出来的 IDEA 研究院的开发团队的同学，改进当前开源项目中的不足之处，让中文开源项目越来越好。</p><h3 id="205mf" name="%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><strong>快速上手</strong></h3><p>如果你本地已经准备好了运行 <code>Docker</code> 的环境，并且有一张显存在 4G 到 8G 之间的显卡，可以尝试使用下面这个镜像，镜像尺寸为 8GB （ 如果你手头没有显卡，也不想使用云主机，<strong>那么可以等等后续不需要 GPU 的“模型把玩”文章</strong>，或者翻阅之前有关模型的文章 :D ）</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">docker pull soulteary<span class="token operator">/</span>stable<span class="token operator">-</span>diffusion<span class="token operator">:</span>taiyi<span class="token operator">-</span><span class="token number">0.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>想运行“太乙”，除了需要下载“模型游乐场”镜像之外，我们还需要获取“太乙模型”文件：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>huggingface<span class="token punctuation">.</span>co<span class="token operator">/</span><span class="token constant">IDEA</span><span class="token operator">-</span><span class="token constant">CCNL</span><span class="token operator">/</span>Taiyi<span class="token operator">-</span>Stable<span class="token operator">-</span>Diffusion<span class="token operator">-</span>1B<span class="token operator">-</span>Chinese<span class="token operator">-</span>v0<span class="token punctuation">.</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>整个仓库尺寸比较大（大概有 18GB），需要花费一些时间：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">Cloning into <span class="token string">'Taiyi-Stable-Diffusion-1B-Chinese-v0.1'</span><span class="token operator">...</span>
<span class="token literal-property property">remote</span><span class="token operator">:</span> Enumerating objects<span class="token operator">:</span> <span class="token number">157</span><span class="token punctuation">,</span> done<span class="token punctuation">.</span>
<span class="token literal-property property">remote</span><span class="token operator">:</span> Counting objects<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">157</span><span class="token operator">/</span><span class="token number">157</span><span class="token punctuation">)</span><span class="token punctuation">,</span> done<span class="token punctuation">.</span>
<span class="token literal-property property">remote</span><span class="token operator">:</span> Compressing objects<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">155</span><span class="token operator">/</span><span class="token number">155</span><span class="token punctuation">)</span><span class="token punctuation">,</span> done<span class="token punctuation">.</span>
<span class="token literal-property property">remote</span><span class="token operator">:</span> Total <span class="token number">157</span> <span class="token punctuation">(</span>delta <span class="token number">77</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pack<span class="token operator">-</span>reused <span class="token number">0</span>
Receiving objects<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">157</span><span class="token operator">/</span><span class="token number">157</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3.06</span> MiB <span class="token operator">|</span> <span class="token number">22.25</span> MiB<span class="token operator">/</span>s<span class="token punctuation">,</span> done<span class="token punctuation">.</span>
Resolving deltas<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">77</span><span class="token operator">/</span><span class="token number">77</span><span class="token punctuation">)</span><span class="token punctuation">,</span> done<span class="token punctuation">.</span>
Filtering content<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8.92</span> GiB <span class="token operator">|</span> <span class="token number">11.48</span> MiB<span class="token operator">/</span>s<span class="token punctuation">,</span> done<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>原始项目启用了 <code>git lfs</code>，所以添加不添加 <code>--depth</code> 参数没有差别，耐心等待模型下载完毕之后，我们编写一个<span class="mod-overview__keyword">容器编排</span>文件，来启动模型应用：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">"2"</span>
<span class="token literal-property property">services</span><span class="token operator">:</span>

  <span class="token literal-property property">taiyi</span><span class="token operator">:</span>
    <span class="token literal-property property">image</span><span class="token operator">:</span> soulteary<span class="token operator">/</span>stable<span class="token operator">-</span>diffusion<span class="token operator">:</span>taiyi<span class="token operator">-</span><span class="token number">0.1</span>
    <span class="token literal-property property">container_name</span><span class="token operator">:</span> taiyi
    <span class="token literal-property property">restart</span><span class="token operator">:</span> always
    <span class="token literal-property property">runtime</span><span class="token operator">:</span> nvidia
    <span class="token literal-property property">ipc</span><span class="token operator">:</span> host
    <span class="token literal-property property">ports</span><span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token string">"7860:7860"</span>
    <span class="token literal-property property">volumes</span><span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token punctuation">.</span><span class="token operator">/</span>Taiyi<span class="token operator">-</span>Stable<span class="token operator">-</span>Diffusion<span class="token operator">-</span>1B<span class="token operator">-</span>Chinese<span class="token operator">-</span>v0<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">:</span><span class="token operator">/</span>stable<span class="token operator">-</span>diffusion<span class="token operator">-</span>webui<span class="token operator">/</span>models<span class="token operator">/</span>Taiyi<span class="token operator">-</span>Stable<span class="token operator">-</span>Diffusion<span class="token operator">-</span>1B<span class="token operator">-</span>Chinese<span class="token operator">-</span>v0<span class="token punctuation">.</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>将上面的内容保存为 <code>docker-compose.yml</code> 之后，执行 <code>docker compose up -d</code>，稍等片刻，在浏览器访问启动服务的 IP 地址和对应端口，比如：<code>http://localhost:7860</code>，就能够正常使用啦。</p><figure class=""><div class="rno-markdown-img-url" style="text-align: center;"><div class="rno-markdown-img-url-inner" style="width: 100%;"><img src="./docker-compose_files/ced98a219f11a53fb300cc1824acebae.jpg"></div></div></figure><p>支持太乙模型的 Stable Diffusion Web 控制台</p><p>模型运行起来，当然是要玩一把了，我使用博客首页的古诗“醉里不知天在水，满船清梦压星河”为主题，尝试生成了一张图，看起来效果还不错：</p><figure class=""><div class="rno-markdown-img-url" style="text-align: center;"><div class="rno-markdown-img-url-inner" style="width: 100%;"><img src="./docker-compose_files/4060f88adc1925292db325dcd0f7d34e.jpg"></div></div></figure><p>干净透明、详尽的构建日志</p><p>想要快速上手中文 Stable Diffusion 模型的同学，看到这里就可以啦。</p><p>如果你想了解如何从零开始配置 GPU <a class="rno-markdown__textlink-new" track-click="{&quot;areaId&quot;:0,&quot;objectId&quot;:2,&quot;positionId&quot;:2,&quot;objectName&quot;:&quot;云服务器&quot;,&quot;objectType&quot;:&quot;link&quot;}" track-exposure="{&quot;areaId&quot;:0,&quot;objectId&quot;:2,&quot;positionId&quot;:2,&quot;objectName&quot;:&quot;云服务器&quot;,&quot;objectType&quot;:&quot;link&quot;}" href="https://cloud.tencent.com/act/pro/promotion-cvm?from_column=20065&amp;from=20065" target="_blank" style="color: rgb(0, 82, 217);">云服务器</a>环境，或者想了解这个 Stable Diffusion <span class="mod-overview__keyword">容器</span>运行环境是如何构建的，可以继续阅读。</p><p>那么，聊聊如何将“太乙”正确的放进容器里。</p><h3 id="cigfq" name="%E5%A6%82%E4%BD%95%E5%B0%86%E2%80%9C%E5%A4%AA%E4%B9%99%E2%80%9D%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%94%BE%E8%BF%9B%E5%AE%B9%E5%99%A8"><strong>如何将“太乙”正确的放进容器</strong></h3><p>既然提到了<strong>正确</strong> ，我们首先要看看官方的镜像都包含哪些问题。</p><h4 id="dbdte" name="%E5%88%86%E6%9E%90%E5%A4%AA%E4%B9%99%E5%AE%98%E6%96%B9%E9%95%9C%E5%83%8F%E5%92%8C%E5%BA%94%E7%94%A8%E9%A1%B9%E7%9B%AE%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><strong>分析太乙官方镜像和应用项目存在的问题</strong></h4><figure class=""><div class="rno-markdown-img-url" style="text-align: center;"><div class="rno-markdown-img-url-inner" style="width: 100%;"><img src="./docker-compose_files/8c624cc4bcc167fa7db0f7ceef4db1a8.jpg"></div></div></figure><p>太乙官方提供的模型</p><p>官方团队并未在仓库中添加容器镜像的编排文件，起初我认为是上线匆忙忘记了，但是随着我翻开 DockerHub 的提交记录时，发现原来这个镜像的构建方式是基于传统的 <code>docker commit</code> <strong>构建的[6]</strong>，这样的镜像存在两个问题，首先是黑盒不透明，拿 Docker 当<span class="mod-overview__keyword">虚拟机</span>用，不利于二次开发和维护；其次，这最后一次提交，单个提交的变动包含 5个GB ，里面是否无心夹带了不该存在的内容，对于想私有化部署的场景下，也着实是有些让人难以放心。</p><figure class=""><div class="rno-markdown-img-url" style="text-align: center;"><div class="rno-markdown-img-url-inner" style="width: 100%;"><img src="./docker-compose_files/9ac7492d7c8215008d6b15740ad7f54c.jpg"></div></div></figure><p>官方镜像的“黑盒子”</p><p>其次，用户如果想在干净完整复现，就只能参考镜像中的“历史操作记录”啦，然而，并不是所有的命令都是能被系统记录下来的，比如 <code>vim</code> 等交互式操作，或者非幂等的操作，用户实际上也无法再次复现。</p><p>我们使用 <code>docker run --rm -it fengshenbang/pytorch:1.10-cuda11.1-cudann8-devel bash</code> 启动一个太乙官方团队，三个月前制作的镜像的 Docker 容器。</p><p>输入 <code>history</code>，能够看到开发同学启动容器之后，又噼里啪啦的搞了“一堆事情”：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token number">1</span>  python
<span class="token number">2</span>  git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token constant">IDEA</span><span class="token operator">-</span><span class="token constant">CCNL</span><span class="token operator">/</span>Fengshenbang<span class="token operator">-</span><span class="token constant">LM</span><span class="token punctuation">.</span>git
<span class="token number">3</span>  cd Fengshenbang<span class="token operator">-</span><span class="token constant">LM</span><span class="token operator">/</span>
<span class="token number">4</span>  ls
<span class="token number">5</span>  vim fengshen<span class="token operator">/</span>requirement<span class="token punctuation">.</span>txt 
<span class="token number">6</span>  pip install <span class="token operator">--</span>editable fengshen
<span class="token number">7</span>  pip install <span class="token operator">--</span>editable <span class="token punctuation">.</span>
<span class="token number">8</span>  pip install <span class="token operator">--</span>update pillow
<span class="token number">9</span>  pip install <span class="token operator">--</span>upgrade pillow
<span class="token number">10</span>  nvcc <span class="token operator">--</span>version
<span class="token number">11</span>  where nvcc
<span class="token number">12</span>  which nvcc
<span class="token number">13</span>  pip install torch<span class="token operator">==</span><span class="token number">1.10</span><span class="token number">.0</span><span class="token operator">+</span>cu111 torchvision<span class="token operator">==</span><span class="token number">0.11</span><span class="token number">.0</span><span class="token operator">+</span>cu111 torchaudio<span class="token operator">==</span><span class="token number">0.10</span><span class="token number">.0</span> <span class="token operator">-</span>f https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>pytorch<span class="token punctuation">.</span>org<span class="token operator">/</span>whl<span class="token operator">/</span>torch_stable<span class="token punctuation">.</span>html
<span class="token number">14</span>  pip install <span class="token operator">--</span>upgrade packaging <span class="token operator">--</span>use<span class="token operator">-</span>feature<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span>resolver
<span class="token number">15</span>  pip install <span class="token operator">--</span>upgrade PyYAML <span class="token operator">--</span>use<span class="token operator">-</span>feature<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span>resolver
<span class="token number">16</span>  pip install <span class="token operator">--</span>upgrade PyYAML <span class="token operator">--</span>use<span class="token operator">-</span>feature<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span>resolver <span class="token operator">--</span>ignore<span class="token operator">-</span>installed
<span class="token number">17</span>  pip install <span class="token operator">--</span>upgrade tqdm <span class="token operator">--</span>use<span class="token operator">-</span>feature<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span>resolver
<span class="token number">18</span>  pip uninstall pip install torchtext
<span class="token number">19</span>  pip uninstall torchtext
<span class="token number">20</span>  pip install torchtext
<span class="token number">21</span>  pip uninstall torchtext
<span class="token number">22</span>  pip install torchtext<span class="token operator">==</span><span class="token number">0.10</span><span class="token number">.0</span>
<span class="token number">23</span>  python
<span class="token number">24</span>  pip install torchtext<span class="token operator">==</span><span class="token number">0.11</span><span class="token number">.0</span>
<span class="token number">25</span>  cd fengshen
<span class="token number">26</span>  ls
<span class="token number">27</span>  cd examples<span class="token operator">/</span>
<span class="token number">28</span>  cd pretrain_erlangshen_deberta_v2<span class="token operator">/</span>
<span class="token number">29</span>  ls
<span class="token number">30</span>  vim pretrain_deberta_base<span class="token punctuation">.</span>sh 
<span class="token number">31</span>  sh pretrain_deberta_base<span class="token punctuation">.</span>sh 
<span class="token number">32</span>  git submodule init
<span class="token number">33</span>  git submodule update
<span class="token number">34</span>  cd <span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">35</span>  cd data<span class="token operator">/</span>fs_datasets<span class="token operator">/</span>
<span class="token number">36</span>  ls
<span class="token number">37</span>  ll
<span class="token number">38</span>  cd <span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">39</span>  git submodule init
<span class="token number">40</span>  git submodule update
<span class="token number">41</span>  cd data<span class="token operator">/</span>fs_datasets<span class="token operator">/</span>
<span class="token number">42</span>  cd <span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">43</span>  vim <span class="token punctuation">.</span>gitmodules 
<span class="token number">44</span>  git submodule update
<span class="token number">45</span>  git submodule init
<span class="token number">46</span>  git submodule update
<span class="token number">47</span>  vim <span class="token punctuation">.</span>gitmodules 
<span class="token number">48</span>  git submodule <span class="token operator">--</span>help
<span class="token number">49</span>  git submodule
<span class="token number">50</span>  git submodule init
<span class="token number">51</span>  git submodule
<span class="token number">52</span>  git submodule update <span class="token operator">--</span>init
<span class="token number">53</span>  vim <span class="token punctuation">.</span>git<span class="token operator">/</span>config 
<span class="token number">54</span>  git submodule init
<span class="token number">55</span>  git submodule update
<span class="token number">56</span>  cd fengshen<span class="token operator">/</span>examples<span class="token operator">/</span>
<span class="token number">57</span>  ls
<span class="token number">58</span>  cd pretrain_erlangshen_deberta_v2<span class="token operator">/</span>
<span class="token number">59</span>  sh pretrain_deberta_base<span class="token punctuation">.</span>sh 
<span class="token number">60</span>  vim pretrain_deberta_base<span class="token punctuation">.</span>sh 
<span class="token number">61</span>  sh pretrain_deberta_base<span class="token punctuation">.</span>sh 
<span class="token number">62</span>  cd <span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">63</span>  cd Fengshenbang<span class="token operator">-</span><span class="token constant">LM</span><span class="token operator">/</span>
<span class="token number">64</span>  git status
<span class="token number">65</span>  rm <span class="token operator">-</span>rf fengshen<span class="token operator">/</span>workspace<span class="token operator">/</span>torch_extendsions
<span class="token number">66</span>  rm fengshen<span class="token operator">/</span>workspace<span class="token operator">/</span>erlangshen<span class="token operator">-</span>deberta<span class="token operator">-</span>base<span class="token operator">/</span>lightning_logs<span class="token operator">/</span>
<span class="token number">67</span>  rm fengshen<span class="token operator">/</span>workspace<span class="token operator">/</span>erlangshen<span class="token operator">-</span>deberta<span class="token operator">-</span>base<span class="token operator">/</span>lightning_logs <span class="token operator">-</span>rf
<span class="token number">68</span>  rm fengshen<span class="token operator">/</span>workspace<span class="token operator">/</span>erlangshen<span class="token operator">-</span>deberta<span class="token operator">-</span>base<span class="token operator">/</span>ckpt <span class="token operator">-</span>rf
<span class="token number">69</span>  cd <span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">70</span>  exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>上面的命令中，主要做了几件事：</p><p>1.调整和配置 Python 应用所需要 Pytorch 基础运行环境，经历了多次失败和重试。2.手动安装项目运行所需要的某几个软件包，也是经历了翻来覆去的重试。3.或许，开发同学不太习惯使用 <code>git submodule</code>，为了让项目程序文件完整，也是折腾来折腾去。4.在提供给用户的镜像里进行了 <code>pretrain_erlangshen_deberta_v2</code> 的预训练，结束后或许是想保持干净的环境，删除掉了日志和模型文件。</p><p>然而，这些三个月前的操作，对于我们想正确运行太乙的模型和界面程序，非但没有正确指引，反而存在“误导”：</p><p>1.PyTorch 版本低，运行程序会因为程序使用了新版本（1.13+）版本才存在的数据类型而无法运行。2.历史操作中反复安装的 <code>torchtext</code> 将阻止我们安装到正确的 PyTorch，进一步阻碍程序在容器内正确运行。3.除此之外，官方项目使用的 <code>submodule</code> 中的引用地址为：<code>git@github.com:IDEA-CCNL/fs_datasets.git</code>，在容器默认环境下是无法完成通过 <code>git</code> 进行下载的。4.最后，官方在项目中推荐的方式是启动 Docker 容器作为虚拟机，然后 <code>docker exec -it fengshen bash</code> 进去之后，使用 <code>git pull &amp;&amp; git submodule ...</code> 来强制更新代码，这样容易出现代码和模型版本不匹配，代码和依赖组件不匹配，和基础环境软件不兼容的情况下，软件无法运行的情况。并且，这样做其实在一些情况下，是无法更新 <code>submodule</code> 中的程序文件的。</p><p>除了基础镜像的问题之外，官方 <code>fork</code> 改版的 <code>stable-diffusion-webui</code> <strong>Web UI 项目[7]</strong>也隐藏了一些问题。虽然，其中不少问题都是从原版程序“继承”过来的。</p><p>首先，项目所需要的依赖，并不是完全都包含在项目的依赖声明文件中；并且，项目中存在俩 <code>requirements.txt</code> 文件，其中都包含了未指定明确版本的软件包。可能官方开发团队想缓解这个问题，于是编写了一个名为 <code>launch.py</code> 的启动文件，在执行程序之后，程序会自动调用 <code>prepare_enviroment()</code> 函数，包含了“近似”所有所需 Python 软件包依赖的安装，以及关联项目的下载。</p><p>在这个文件中，我们会发现目前版本的程序想正确运行起来，实际需要的基础运行环境是：<code>torch==1.12.1+cu113 torchvision==0.13.1+cu113</code>，好吧，如果你没有仔细阅读过这个 <code>launch.py</code>，那么官方镜像提供的默认环境将浪费不少想让程序运行起来，花费的调试时间。</p><p>我们也能够在这个文件中发现大量直接调用 <code>subprocess.run</code> 执行的安装命令。因为项目中没有明确的版本声明，所以当程序下载完 <code>gfpgan</code>、<code>clip</code>、<code>xformers</code>、<code>deepdanbooru</code>、<code>pyngrok</code>、<code>Stable Diffusion</code>、<code>Taming Transformer</code>、<code>K-diffusion</code>、<code>CodeFormer</code>、<code>BLIP</code> 后，一通安装后，再进行安装 <code>web ui</code> 本身的依赖，很容易造成程序因为版本兼容性存在问题，而无法运行，或者运行出错的问题，<strong>对其他人提供公开代码，或者下载的软件，使用显式声明是好习惯</strong>。</p><p>在上面的依赖安装中，还存在两个问题。第一个是来自 Facebook Research 的 xformers，如果想要在 GPU 环境正确安装，安装指令需要调整。推测这里测试的同学，偷懒没有验证 GPU 环境从零到一的安装验证。</p><p>其二，<code>pyngrok</code> 这个包，虽然目前还没有在项目中被公开使用，但是就伴随程序的“自动初始化”悄然无声的安装到用户电脑上，其实不见得是一件合适的事情。太乙团队的镜像里暂时并未发现 <code>ngrok</code> 的执行程序，但是如果其他人再分发的过程中，虽然不改动原始代码，但是在程序中夹带了 <code>ngrok</code>，配合不严格的安全策略，对于用户而言，潜在的<a class="rno-markdown__textlink-new" track-click="{&quot;areaId&quot;:0,&quot;objectId&quot;:52,&quot;positionId&quot;:52,&quot;objectName&quot;:&quot;数据安全&quot;,&quot;objectType&quot;:&quot;link&quot;}" track-exposure="{&quot;areaId&quot;:0,&quot;objectId&quot;:52,&quot;positionId&quot;:52,&quot;objectName&quot;:&quot;数据安全&quot;,&quot;objectType&quot;:&quot;link&quot;}" href="https://cloud.tencent.com/solution/data_protection?from_column=20065&amp;from=20065" target="_blank" style="color: rgb(0, 82, 217);">数据安全</a>风险还是蛮高的。</p><h4 id="7bb7o" name="%E8%A7%A3%E5%86%B3%E8%A2%AB%E5%AE%98%E6%96%B9%E5%BF%BD%E8%A7%86%E7%9A%84-AI-%E5%AE%B9%E5%99%A8%E5%BA%94%E7%94%A8%E9%97%AE%E9%A2%98"><strong>解决被官方忽视的 AI 容器应用问题</strong></h4><p>太乙官方团队之前选择的基础镜像是 <code>pytorch:1.10-cuda11.1-cudann8-devel</code>。结合上面的分析，我们不难知道两点：</p><p>1.第一，我们需要更新 cuda 版本到 11.3.1。2.第二，我们有对 PyTorch “生态” 依赖进行安装更新的需要，使用预置 PyTorch 的镜像意义不大。</p><p>所以，这里我选择使用 <code>nvidia/cuda:11.3.1-devel-ubuntu18.04</code> 作为基础镜像，搭配 <code>miniconda</code> 完成经过验证的 PyTorch “生态”软件版本的安装，搞定程序的基础“运行时”。</p><p>如果你需要寻找其他版本的镜像，可以在 <strong>DockerHub 的这个页面搜索[8]</strong>，另外，如果你需要判断 PyTorch 版本所需要的 CUDA 版本，可以在 PyTorch 官方发布页面中寻找线索：https://pytorch.org/get-started/previous-versions/。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token constant">FROM</span> nvidia<span class="token operator">/</span>cuda<span class="token operator">:</span><span class="token number">11.3</span><span class="token number">.1</span><span class="token operator">-</span>devel<span class="token operator">-</span>ubuntu18<span class="token punctuation">.</span><span class="token number">04</span>

<span class="token constant">ENV</span> <span class="token constant">PATH</span><span class="token operator">=</span><span class="token string">"/root/miniconda3/bin:${PATH}"</span>
<span class="token constant">RUN</span> apt<span class="token operator">-</span><span class="token keyword">get</span> update
<span class="token constant">RUN</span> apt<span class="token operator">-</span><span class="token keyword">get</span> install <span class="token operator">-</span>y wget <span class="token operator">&amp;&amp;</span> rm <span class="token operator">-</span>rf <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>apt<span class="token operator">/</span>lists<span class="token comment">/*

RUN wget \
    https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh \
    &amp;&amp; mkdir /root/.conda \
    &amp;&amp; bash Miniconda3-latest-Linux-x86_64.sh -b \
    &amp;&amp; rm -f Miniconda3-latest-Linux-x86_64.sh

RUN conda install pytorch==1.12.1 torchvision==0.13.1 torchaudio==0.12.1 cudatoolkit=11.3 -c pytorch -y </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>然后，我们开始翻译 <code>launch.py</code> 程序中关于软件的依赖下载和安装命令，先处理基础软件依赖（不进行 <code>pyngrok</code> 的安装）：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"># WebUI
<span class="token constant">RUN</span> pip install transformers<span class="token operator">==</span><span class="token number">4.19</span><span class="token number">.2</span> diffusers<span class="token operator">==</span><span class="token number">0.3</span><span class="token number">.0</span> basicsr<span class="token operator">==</span><span class="token number">1.4</span><span class="token number">.2</span> gfpgan<span class="token operator">==</span><span class="token number">1.3</span><span class="token number">.8</span> gradio<span class="token operator">==</span><span class="token number">3.8</span> numpy<span class="token operator">==</span><span class="token number">1.23</span><span class="token number">.3</span> Pillow<span class="token operator">==</span><span class="token number">9.2</span><span class="token number">.0</span> realesrgan<span class="token operator">==</span><span class="token number">0.3</span><span class="token number">.0</span> torch omegaconf<span class="token operator">==</span><span class="token number">2.2</span><span class="token number">.3</span> pytorch_lightning<span class="token operator">==</span><span class="token number">1.7</span><span class="token number">.6</span> scikit<span class="token operator">-</span>image<span class="token operator">==</span><span class="token number">0.19</span><span class="token number">.2</span> fonts font<span class="token operator">-</span>roboto timm<span class="token operator">==</span><span class="token number">0.6</span><span class="token number">.7</span> fairscale<span class="token operator">==</span><span class="token number">0.4</span><span class="token number">.9</span> piexif<span class="token operator">==</span><span class="token number">1.1</span><span class="token number">.3</span> einops<span class="token operator">==</span><span class="token number">0.4</span><span class="token number">.1</span> jsonmerge<span class="token operator">==</span><span class="token number">1.8</span><span class="token number">.0</span> clean<span class="token operator">-</span>fid<span class="token operator">==</span><span class="token number">0.1</span><span class="token number">.29</span> resize<span class="token operator">-</span>right<span class="token operator">==</span><span class="token number">0.0</span><span class="token number">.2</span> torchdiffeq<span class="token operator">==</span><span class="token number">0.2</span><span class="token number">.3</span> kornia<span class="token operator">==</span><span class="token number">0.6</span><span class="token number">.7</span> lark<span class="token operator">==</span><span class="token number">1.1</span><span class="token number">.2</span> inflection<span class="token operator">==</span><span class="token number">0.5</span><span class="token number">.1</span> GitPython<span class="token operator">==</span><span class="token number">3.1</span><span class="token number">.27</span>
# Etc<span class="token operator">...</span>
<span class="token constant">RUN</span> apt<span class="token operator">-</span><span class="token keyword">get</span> update <span class="token operator">&amp;&amp;</span> apt<span class="token operator">-</span><span class="token keyword">get</span> install <span class="token operator">-</span>y git
<span class="token constant">RUN</span> pip install <span class="token string">"git+https://github.com/TencentARC/GFPGAN.git@8d2447a2d918f8eba5a4a01463fd48e45126a379"</span>
<span class="token constant">RUN</span> pip install <span class="token string">"git+https://github.com/openai/CLIP.git@d50d76daa670286dd6cacf3bcd80b5e4823fc8e1"</span>

<span class="token constant">RUN</span> pip install <span class="token string">"git+https://github.com/KichangKim/DeepDanbooru.git@d91a2963bf87c6a770d74894667e9ffa9f6de7ff#egg=deepdanbooru"</span> <span class="token operator">&amp;&amp;</span> \
    pip install tensorflow<span class="token operator">==</span><span class="token number">2.10</span><span class="token number">.0</span> tensorflow<span class="token operator">-</span>io<span class="token operator">==</span><span class="token number">0.27</span><span class="token number">.0</span>

<span class="token constant">RUN</span> pip install ninja <span class="token operator">&amp;&amp;</span> \
    pip install <span class="token operator">-</span>v <span class="token operator">-</span><span class="token constant">U</span> <span class="token string">"git+https://github.com/facebookresearch/xformers.git@main#egg=xformers"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>接着，我们来处理程序运行所需要的三方开源仓库这类组件依赖，按照官方 Web UI 所需要的 <code>git hash</code> 版本将它们下载下来：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token constant">RUN</span> git clone <span class="token string">"https://github.com/CompVis/stable-diffusion.git"</span> <span class="token string">"stable-diffusion"</span> <span class="token operator">&amp;&amp;</span> \
    cd <span class="token string">"stable-diffusion"</span> <span class="token operator">&amp;&amp;</span> \
    git checkout <span class="token string">"69ae4b35e0a0f6ee1af8bb9a5d0016ccb27e36dc"</span>

<span class="token constant">RUN</span> git clone <span class="token string">"https://github.com/CompVis/taming-transformers.git"</span> <span class="token string">"taming-transformers"</span> <span class="token operator">&amp;&amp;</span> \
    cd <span class="token string">"taming-transformers"</span> <span class="token operator">&amp;&amp;</span> \
    git checkout <span class="token string">"24268930bf1dce879235a7fddd0b2355b84d7ea6"</span>

<span class="token constant">RUN</span> git clone <span class="token string">"https://github.com/crowsonkb/k-diffusion.git"</span> <span class="token string">"k-diffusion"</span> <span class="token operator">&amp;&amp;</span> \
    cd <span class="token string">"k-diffusion"</span> <span class="token operator">&amp;&amp;</span> \
    git checkout <span class="token string">"60e5042ca0da89c14d1dd59d73883280f8fce991"</span>

<span class="token constant">RUN</span> git clone <span class="token string">"https://github.com/sczhou/CodeFormer.git"</span> <span class="token string">"CodeFormer"</span> <span class="token operator">&amp;&amp;</span> \
    cd <span class="token string">"CodeFormer"</span> <span class="token operator">&amp;&amp;</span> \
    git checkout <span class="token string">"c5b4593074ba6214284d6acd5f1719b6c5d739af"</span>

<span class="token constant">RUN</span> git clone <span class="token string">"https://github.com/salesforce/BLIP.git"</span> <span class="token string">"BLIP"</span> <span class="token operator">&amp;&amp;</span> \
    cd <span class="token string">"BLIP"</span> <span class="token operator">&amp;&amp;</span> \
    git checkout <span class="token string">"48211a1594f1321b00f14c9f7a5b4813144b2fb9"</span>

<span class="token constant">RUN</span> cd <span class="token string">"CodeFormer"</span> <span class="token operator">&amp;&amp;</span> \
    pip install <span class="token operator">-</span>r requirements<span class="token punctuation">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>然后，我们来处理太乙专属的 <code>Web UI</code> 这部分的程序，为了让镜像能够稳定构建、稳定运行，我们对 <code>IDEA-CCNL/stable-diffusion-webui</code> 也进行“版本的显式定义”：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token constant">RUN</span> git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token constant">IDEA</span><span class="token operator">-</span><span class="token constant">CCNL</span><span class="token operator">/</span>stable<span class="token operator">-</span>diffusion<span class="token operator">-</span>webui<span class="token punctuation">.</span>git <span class="token operator">&amp;&amp;</span> \
    cd <span class="token string">"stable-diffusion-webui"</span> <span class="token operator">&amp;&amp;</span> \
    git checkout <span class="token string">"b31fc195a6d56a36b4abe1f6e36890211a78e844"</span>

<span class="token constant">RUN</span> mv <span class="token string">"stable-diffusion"</span> stable<span class="token operator">-</span>diffusion<span class="token operator">-</span>webui<span class="token operator">/</span>repositories<span class="token operator">/</span> <span class="token operator">&amp;&amp;</span> \
    mv <span class="token string">"taming-transformers"</span> stable<span class="token operator">-</span>diffusion<span class="token operator">-</span>webui<span class="token operator">/</span>repositories<span class="token operator">/</span> <span class="token operator">&amp;&amp;</span> \
    mv <span class="token string">"k-diffusion"</span> stable<span class="token operator">-</span>diffusion<span class="token operator">-</span>webui<span class="token operator">/</span>repositories<span class="token operator">/</span> <span class="token operator">&amp;&amp;</span> \
    mv <span class="token string">"CodeFormer"</span> stable<span class="token operator">-</span>diffusion<span class="token operator">-</span>webui<span class="token operator">/</span>repositories<span class="token operator">/</span> <span class="token operator">&amp;&amp;</span> \
    mv <span class="token string">"BLIP"</span> stable<span class="token operator">-</span>diffusion<span class="token operator">-</span>webui<span class="token operator">/</span>repositories<span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>接下来，对官方团队准备好的配置文件进行调整，为了方便容器使用，我们将把太乙的模型文件放在 <code>Web UI</code> 的 <code>stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/</code> 目录中：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token constant">RUN</span> cd stable<span class="token operator">-</span>diffusion<span class="token operator">-</span>webui<span class="token operator">/</span>repositories<span class="token operator">/</span> <span class="token operator">&amp;&amp;</span> \
    cp <span class="token string">"stable-diffusion-taiyi/configs/stable-diffusion/v1-inference.yaml"</span> <span class="token string">"stable-diffusion/configs/stable-diffusion/v1-inference.yaml"</span> <span class="token operator">&amp;&amp;</span> \
    cp <span class="token string">"stable-diffusion-taiyi/ldm/modules/encoders/modules.py"</span> <span class="token string">"stable-diffusion/ldm/modules/encoders/modules.py"</span> <span class="token operator">&amp;&amp;</span> \
    sed <span class="token operator">-</span>ie s#your_path<span class="token operator">/</span>Taiyi<span class="token operator">-</span>Stable<span class="token operator">-</span>Diffusion<span class="token operator">-</span>1B<span class="token operator">-</span>Chinese<span class="token operator">-</span>v0<span class="token punctuation">.</span><span class="token number">1</span>#<span class="token operator">/</span>stable<span class="token operator">-</span>diffusion<span class="token operator">-</span>webui<span class="token operator">/</span>models<span class="token operator">/</span>Taiyi<span class="token operator">-</span>Stable<span class="token operator">-</span>Diffusion<span class="token operator">-</span>1B<span class="token operator">-</span>Chinese<span class="token operator">-</span>v0<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">/</span># <span class="token string">"stable-diffusion/configs/stable-diffusion/v1-inference.yaml"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>设置程序运行工作目录，以及启动参数：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token constant">WORKDIR</span> stable<span class="token operator">-</span>diffusion<span class="token operator">-</span>webui
<span class="token constant">CMD</span> <span class="token punctuation">[</span><span class="token string">"python"</span><span class="token punctuation">,</span> <span class="token string">"webui.py"</span><span class="token punctuation">,</span> <span class="token string">"--ckpt"</span><span class="token punctuation">,</span> <span class="token string">"/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/Taiyi-Stable-Diffusion-1B-Chinese-v0.1.ckpt"</span><span class="token punctuation">,</span> <span class="token string">"--listen"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>最后，将上面的内容保存为 <code>Dockerfile</code>，执行 <code>docker build -t soulteary/stable-diffusion:taiyi-0.1 .</code> ，耐心等待镜像构建完毕就好啦。</p><p>我们使用 <code>docker images</code> 查看镜像尺寸：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token constant">REPOSITORY</span>                   <span class="token constant">TAG</span>         <span class="token constant">IMAGE</span> <span class="token constant">ID</span>       <span class="token constant">CREATED</span>        <span class="token constant">SIZE</span>
soulteary<span class="token operator">/</span>stable<span class="token operator">-</span>diffusion   taiyi<span class="token operator">-</span><span class="token number">0.1</span>   359b67ba7c2f   <span class="token number">5</span> hours ago    <span class="token number">17</span><span class="token punctuation">.</span>4GB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>发现虽然比官方镜像解压缩后的 22.5GB 小，但是还是有些大，那么，接下来，我们来进行简单优化。</p><p>如果你想了解极限的“硬核优化”，可以参考<strong>《使用 Docker 和 HuggingFace 实现 NLP 文本情感分析应用》[9]</strong>或者往期大文章，在此就不赘述啦 :D</p><h4 id="atgac" name="%E8%BF%9B%E4%B8%80%E6%AD%A5%E4%BC%98%E5%8C%96-AI-%E5%BA%94%E7%94%A8%E7%9A%84%E9%95%9C%E5%83%8F%E5%B0%BA%E5%AF%B8"><strong>进一步优化 AI 应用的镜像尺寸</strong></h4><p>因为时间关系，我就先不折腾多阶段构建，以及定向的压缩实现啦，我们针对上面的镜像编排指令进行合并，再每个阶段去掉不必要的文件，很容易得到类似下面的，紧凑一些的 <code>Dockerfile</code>：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token constant">FROM</span> nvidia<span class="token operator">/</span>cuda<span class="token operator">:</span><span class="token number">11.3</span><span class="token number">.1</span><span class="token operator">-</span>devel<span class="token operator">-</span>ubuntu18<span class="token punctuation">.</span><span class="token number">04</span>
<span class="token constant">LABEL</span> org<span class="token punctuation">.</span>opencontainers<span class="token punctuation">.</span>image<span class="token punctuation">.</span>authors<span class="token operator">=</span><span class="token string">"soulteary@gmail.com"</span>
<span class="token constant">ENV</span> <span class="token constant">PATH</span><span class="token operator">=</span><span class="token string">"/root/miniconda3/bin:${PATH}"</span>
<span class="token constant">RUN</span> apt<span class="token operator">-</span><span class="token keyword">get</span> update <span class="token operator">&amp;&amp;</span> \
    apt<span class="token operator">-</span><span class="token keyword">get</span> install <span class="token operator">-</span>y wget git ffmpeg libsm6 libxext6 <span class="token operator">&amp;&amp;</span> \
    rm <span class="token operator">-</span>rf <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>apt<span class="token operator">/</span>lists<span class="token comment">/* &amp;&amp; \
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh &amp;&amp; \
    mkdir /root/.conda &amp;&amp; \
    bash Miniconda3-latest-Linux-x86_64.sh -b &amp;&amp; \
    rm -f Miniconda3-latest-Linux-x86_64.sh 
# Basic environment (PyApp &amp; WebUI)
RUN conda install pytorch==1.12.1 torchvision==0.13.1 torchaudio==0.12.1 cudatoolkit=11.3 -c pytorch -y &amp;&amp; \
    pip install transformers==4.19.2 diffusers==0.3.0 basicsr==1.4.2 gfpgan==1.3.8 gradio==3.8 numpy==1.23.3 Pillow==9.2.0 realesrgan==0.3.0 torch omegaconf==2.2.3 pytorch_lightning==1.7.6 scikit-image==0.19.2 fonts font-roboto timm==0.6.7 fairscale==0.4.9 piexif==1.1.3 einops==0.4.1 jsonmerge==1.8.0 clean-fid==0.1.29 resize-right==0.0.2 torchdiffeq==0.2.3 kornia==0.6.7 lark==1.1.2 inflection==0.5.1 GitPython==3.1.27 &amp;&amp; \
    pip install "git+https://github.com/TencentARC/GFPGAN.git@8d2447a2d918f8eba5a4a01463fd48e45126a379" &amp;&amp; \
    pip install "git+https://github.com/openai/CLIP.git@d50d76daa670286dd6cacf3bcd80b5e4823fc8e1" &amp;&amp; \
    pip install "git+https://github.com/KichangKim/DeepDanbooru.git@d91a2963bf87c6a770d74894667e9ffa9f6de7ff#egg=deepdanbooru" &amp;&amp; \
    pip install tensorflow==2.10.0 tensorflow-io==0.27.0 &amp;&amp; \
    pip install ninja &amp;&amp; \
    pip install -v -U "git+https://github.com/facebookresearch/xformers.git@main#egg=xformers" &amp;&amp; \
    pip cache purge
# Components
RUN git clone "https://github.com/CompVis/stable-diffusion.git" "stable-diffusion" &amp;&amp; \
    cd "stable-diffusion" &amp;&amp; \
    git checkout "69ae4b35e0a0f6ee1af8bb9a5d0016ccb27e36dc" &amp;&amp; rm -rf .git
RUN git clone "https://github.com/CompVis/taming-transformers.git" "taming-transformers" &amp;&amp; \
    cd "taming-transformers" &amp;&amp; \
    git checkout "24268930bf1dce879235a7fddd0b2355b84d7ea6" &amp;&amp; rm -rf .git
RUN git clone "https://github.com/crowsonkb/k-diffusion.git" "k-diffusion" &amp;&amp; \
    cd "k-diffusion" &amp;&amp; \
    git checkout "60e5042ca0da89c14d1dd59d73883280f8fce991" &amp;&amp; rm -rf .git
RUN git clone "https://github.com/sczhou/CodeFormer.git" "CodeFormer" &amp;&amp; \
    cd "CodeFormer" &amp;&amp; \
    git checkout "c5b4593074ba6214284d6acd5f1719b6c5d739af" &amp;&amp; rm -rf .git &amp;&amp; \
    pip install -r requirements.txt &amp;&amp; pip cache purge
RUN git clone "https://github.com/salesforce/BLIP.git" "BLIP" &amp;&amp; \
    cd "BLIP" &amp;&amp; \
    git checkout "48211a1594f1321b00f14c9f7a5b4813144b2fb9" &amp;&amp; rm -rf .git
RUN git clone "https://github.com/IDEA-CCNL/stable-diffusion-webui.git" "stable-diffusion-webui" &amp;&amp; \
    cd "stable-diffusion-webui" &amp;&amp; \
    git checkout "b31fc195a6d56a36b4abe1f6e36890211a78e844" &amp;&amp; rm -rf .git &amp;&amp; \
    cd ../ &amp;&amp; \
    mv "stable-diffusion" "stable-diffusion-webui/repositories/" &amp;&amp; \
    mv "taming-transformers" "stable-diffusion-webui/repositories/" &amp;&amp; \
    mv "k-diffusion" "stable-diffusion-webui/repositories/" &amp;&amp; \
    mv "CodeFormer" "stable-diffusion-webui/repositories/" &amp;&amp; \
    mv "BLIP" "stable-diffusion-webui/repositories/" &amp;&amp; \
    cd "stable-diffusion-webui/repositories/" &amp;&amp; \
    cp "stable-diffusion-taiyi/configs/stable-diffusion/v1-inference.yaml" "stable-diffusion/configs/stable-diffusion/v1-inference.yaml" &amp;&amp; \
    cp "stable-diffusion-taiyi/ldm/modules/encoders/modules.py" "stable-diffusion/ldm/modules/encoders/modules.py" &amp;&amp; \
    sed -ie s#your_path/Taiyi-Stable-Diffusion-1B-Chinese-v0.1#/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/# "stable-diffusion/configs/stable-diffusion/v1-inference.yaml"
WORKDIR stable-diffusion-webui
CMD ["python", "webui.py", "--ckpt", "/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/Taiyi-Stable-Diffusion-1B-Chinese-v0.1.ckpt", "--listen"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>再次执行 <code>docker build -t soulteary/stable-diffusion:taiyi-0.1 .</code> 进行镜像的构建，构建完毕后，再一次使用 <code>docker images</code> 查看镜像尺寸，发现尺寸立减 2GB，相比官方镜像小了 6GB+：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token constant">REPOSITORY</span>                   <span class="token constant">TAG</span>         <span class="token constant">IMAGE</span> <span class="token constant">ID</span>       <span class="token constant">CREATED</span>        <span class="token constant">SIZE</span>
soulteary<span class="token operator">/</span>stable<span class="token operator">-</span>diffusion   taiyi<span class="token operator">-</span><span class="token number">0.1</span>   0e1c48709672   <span class="token number">2</span> hours ago    <span class="token number">15</span><span class="token punctuation">.</span>4GB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>将镜像推送到 DockerHub 上，经过平台的压缩，镜像传输尺比官方压缩后的镜像“轻” 2GB：</p><figure class=""><div class="rno-markdown-img-url" style="text-align: center;"><div class="rno-markdown-img-url-inner" style="width: 100%;"><img src="./docker-compose_files/a78965c0f284fd87b24c41dc5e0a2cbc.jpg"></div></div></figure><p>从新构建的太乙模型镜像</p><p>并且，镜像构建细节中，每一步做了什么，构建的层多大，都清清楚楚的展示在了 DockerHub 的镜像详情页中，“干净又卫生”。</p><figure class=""><div class="rno-markdown-img-url" style="text-align: center;"><div class="rno-markdown-img-url-inner" style="width: 100%;"><img src="./docker-compose_files/66283eef2f0a7e30d8206bae1e7badcd.jpg"></div></div></figure><p>干净透明、详尽的构建日志</p><h3 id="5p0c2" name="GPU-%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%8E%AF%E5%A2%83%E7%9A%84%E9%85%8D%E7%BD%AE"><strong>GPU 云主机环境的配置</strong></h3><p>想要简单、丝滑的在云服务器上运行 Python AI 应用，有一些前置工作要做。</p><h4 id="2faeu" name="Docker-%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E7%9A%84%E5%AE%89%E8%A3%85"><strong>Docker 基础环境的安装</strong></h4><p>我们在云环境默认创建的 GPU 服务器，可能环境有这样或者那样的小问题，为了避免时间浪费在琐碎问题上，我们可以考虑用 Docker 所提供的“固定 &amp; 明确的运行环境”来节约时间。</p><p>想要运行 Docker 首先要完成 Docker 的安装，在<strong>《在笔记本上搭建高性价比的 </strong><span class="mod-overview__keyword"><strong>Linux</strong></span><strong> 学习环境：基础篇》[10]</strong>一文的“更简单的 Docker 安装”小节中，我提到过如何快速、正确的在 <span class="mod-overview__keyword">Ubuntu</span> 环境完成 Docker 的安装，这里就不做展开了，有需要的同学可以自行翻阅。</p><p>如果，我们想在 Docker 中调用 Nvidia 显卡，光是完成 Docker 安装，还是不够的，还有一些事情要做。</p><h4 id="6a8eo" name="%E5%AE%8C%E5%96%84-Nvidia-%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8%E5%AE%89%E8%A3%85"><strong>完善 Nvidia 显卡驱动安装</strong></h4><p>我们需要先信任 Nvidia 的 GPG Key，然后才能安装来自 Nvidia 的开源软件。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">curl <span class="token operator">-</span>fsSL https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nvidia<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token operator">/</span>nvidia<span class="token operator">-</span>container<span class="token operator">-</span>runtime<span class="token operator">/</span>gpgkey <span class="token operator">|</span> sudo gpg <span class="token operator">--</span>dearmor <span class="token operator">-</span>o <span class="token operator">/</span>etc<span class="token operator">/</span>apt<span class="token operator">/</span>keyrings<span class="token operator">/</span>nvidia<span class="token operator">-</span>container<span class="token operator">-</span>runtime<span class="token punctuation">.</span>gpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>接着，需要更新系统中的软件源列表，添加 <strong>NVIDIA/nvidia-container-runtime[11]</strong> 开源项目的软件源到 <code>apt</code> 配置中。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">cat <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>apt<span class="token operator">/</span>sources<span class="token punctuation">.</span>list<span class="token punctuation">.</span>d<span class="token operator">/</span>nvidia<span class="token operator">-</span>container<span class="token operator">-</span>runtime<span class="token punctuation">.</span>list <span class="token operator">&lt;&lt;</span> <span class="token constant">EOF</span>
deb https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nvidia<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token operator">/</span>libnvidia<span class="token operator">-</span>container<span class="token operator">/</span>stable<span class="token operator">/</span>ubuntu22<span class="token punctuation">.</span><span class="token number">04</span><span class="token operator">/</span>amd64 <span class="token operator">/</span>
deb https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nvidia<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token operator">/</span>nvidia<span class="token operator">-</span>container<span class="token operator">-</span>runtime<span class="token operator">/</span>stable<span class="token operator">/</span>ubuntu22<span class="token punctuation">.</span><span class="token number">04</span><span class="token operator">/</span>amd64 <span class="token operator">/</span>
<span class="token constant">EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>如果你的系统架构和系统版本不是 <code>amd64</code> 和 <code>ubuntu22.04</code>，请结合实际情况进行调整。</p><p>在添加了软件源之后，我们执行下面的命令，完成 <code>nvidia-container-cli</code> 工具的安装：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">apt<span class="token operator">-</span><span class="token keyword">get</span> update
apt install <span class="token operator">-</span>y nvidia<span class="token operator">-</span>container<span class="token operator">-</span>runtime<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>完成工具安装之后，就可以使用下面的命令，来检查 Docker 需要的 Nvidia 显卡驱动是否完成完整安装了：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">nvidia<span class="token operator">-</span>container<span class="token operator">-</span>cli <span class="token operator">-</span>k <span class="token operator">-</span>d <span class="token operator">/</span>dev<span class="token operator">/</span>tty info<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>执行完毕，我们将看到类似下面的日志：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token operator">--</span> <span class="token constant">WARNING</span><span class="token punctuation">,</span> the following logs are <span class="token keyword">for</span> debugging purposes only <span class="token operator">--</span>

<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.088339</span> <span class="token number">22574</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">376</span><span class="token punctuation">]</span> initializing library <span class="token function">context</span> <span class="token punctuation">(</span>version<span class="token operator">=</span><span class="token number">1.11</span><span class="token number">.0</span><span class="token punctuation">,</span> build<span class="token operator">=</span>c8f267be0bac1c654d59ad4ea5df907141149977<span class="token punctuation">)</span>
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.088444</span> <span class="token number">22574</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">350</span><span class="token punctuation">]</span> using root <span class="token operator">/</span>
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.088458</span> <span class="token number">22574</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">351</span><span class="token punctuation">]</span> using ldcache <span class="token operator">/</span>etc<span class="token operator">/</span>ld<span class="token punctuation">.</span>so<span class="token punctuation">.</span>cache
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.088469</span> <span class="token number">22574</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">352</span><span class="token punctuation">]</span> using unprivileged user <span class="token number">65534</span><span class="token operator">:</span><span class="token number">65534</span>
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.088499</span> <span class="token number">22574</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">393</span><span class="token punctuation">]</span> attempting to load dxcore to see <span class="token keyword">if</span> we are running under Windows Subsystem <span class="token keyword">for</span> <span class="token function">Linux</span> <span class="token punctuation">(</span><span class="token constant">WSL</span><span class="token punctuation">)</span>
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.088915</span> <span class="token number">22574</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">395</span><span class="token punctuation">]</span> dxcore initialization failed<span class="token punctuation">,</span> continuing assuming a non<span class="token operator">-</span><span class="token constant">WSL</span> environment
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.090266</span> <span class="token number">22575</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">278</span><span class="token punctuation">]</span> loading kernel module nvidia
<span class="token constant">E1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.094200</span> <span class="token number">22575</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">280</span><span class="token punctuation">]</span> could not load kernel module nvidia
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.094227</span> <span class="token number">22575</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">296</span><span class="token punctuation">]</span> loading kernel module nvidia_uvm
<span class="token constant">E1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.097819</span> <span class="token number">22575</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">298</span><span class="token punctuation">]</span> could not load kernel module nvidia_uvm
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.097845</span> <span class="token number">22575</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">305</span><span class="token punctuation">]</span> loading kernel module nvidia_modeset
<span class="token constant">E1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.101219</span> <span class="token number">22575</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">307</span><span class="token punctuation">]</span> could not load kernel module nvidia_modeset
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.101496</span> <span class="token number">22579</span> rpc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">71</span><span class="token punctuation">]</span> starting driver rpc service
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.101960</span> <span class="token number">22574</span> rpc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">135</span><span class="token punctuation">]</span> driver rpc service terminated <span class="token keyword">with</span> signal <span class="token number">15</span>
nvidia<span class="token operator">-</span>container<span class="token operator">-</span>cli<span class="token operator">:</span> initialization error<span class="token operator">:</span> load library failed<span class="token operator">:</span> libnvidia<span class="token operator">-</span>ml<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">:</span> cannot open shared object file<span class="token operator">:</span> no such file or directory
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">16.102035</span> <span class="token number">22574</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">434</span><span class="token punctuation">]</span> shutting down library context
<span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>在上面的日志中，我们能看到 <code>could not load kernel module nvidia</code>，说明系统中没有完整安装 Nvidia 的内核驱动。</p><p>解决这个问题很简单，在 Ubuntu 系统环境中，内置了经过官方验证的驱动检查命令：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">ubuntu<span class="token operator">-</span>drivers devices<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>执行命令，能够得到支持安装的显卡驱动列表：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;"><span class="token operator">==</span> <span class="token operator">/</span>sys<span class="token operator">/</span>devices<span class="token operator">/</span>pci0000<span class="token operator">:</span><span class="token number">00</span><span class="token operator">/</span><span class="token number">0000</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">07.0</span> <span class="token operator">==</span>
<span class="token literal-property property">modalias</span> <span class="token operator">:</span> pci<span class="token operator">:</span>v000010DEd00001DB1sv000010DEsd00001212bc03sc02i00
<span class="token literal-property property">vendor</span>   <span class="token operator">:</span> <span class="token constant">NVIDIA</span> Corporation
<span class="token literal-property property">model</span>    <span class="token operator">:</span> <span class="token constant">GV100GL</span> <span class="token punctuation">[</span>Tesla <span class="token constant">V100</span> <span class="token constant">SXM2</span> 16GB<span class="token punctuation">]</span>
<span class="token literal-property property">driver</span>   <span class="token operator">:</span> nvidia<span class="token operator">-</span>driver<span class="token operator">-</span><span class="token number">418</span><span class="token operator">-</span>server <span class="token operator">-</span> distro non<span class="token operator">-</span>free
<span class="token literal-property property">driver</span>   <span class="token operator">:</span> nvidia<span class="token operator">-</span>driver<span class="token operator">-</span><span class="token number">450</span><span class="token operator">-</span>server <span class="token operator">-</span> distro non<span class="token operator">-</span>free
<span class="token literal-property property">driver</span>   <span class="token operator">:</span> nvidia<span class="token operator">-</span>driver<span class="token operator">-</span><span class="token number">510</span> <span class="token operator">-</span> distro non<span class="token operator">-</span>free
<span class="token literal-property property">driver</span>   <span class="token operator">:</span> nvidia<span class="token operator">-</span>driver<span class="token operator">-</span><span class="token number">515</span><span class="token operator">-</span>server <span class="token operator">-</span> distro non<span class="token operator">-</span>free
<span class="token literal-property property">driver</span>   <span class="token operator">:</span> nvidia<span class="token operator">-</span>driver<span class="token operator">-</span><span class="token number">525</span> <span class="token operator">-</span> distro non<span class="token operator">-</span>free recommended
<span class="token literal-property property">driver</span>   <span class="token operator">:</span> nvidia<span class="token operator">-</span>driver<span class="token operator">-</span><span class="token number">515</span> <span class="token operator">-</span> distro non<span class="token operator">-</span>free
<span class="token literal-property property">driver</span>   <span class="token operator">:</span> nvidia<span class="token operator">-</span>driver<span class="token operator">-</span><span class="token number">390</span> <span class="token operator">-</span> distro non<span class="token operator">-</span>free
<span class="token literal-property property">driver</span>   <span class="token operator">:</span> nvidia<span class="token operator">-</span>driver<span class="token operator">-</span><span class="token number">470</span> <span class="token operator">-</span> distro non<span class="token operator">-</span>free
<span class="token literal-property property">driver</span>   <span class="token operator">:</span> nvidia<span class="token operator">-</span>driver<span class="token operator">-</span><span class="token number">470</span><span class="token operator">-</span>server <span class="token operator">-</span> distro non<span class="token operator">-</span>free
<span class="token literal-property property">driver</span>   <span class="token operator">:</span> xserver<span class="token operator">-</span>xorg<span class="token operator">-</span>video<span class="token operator">-</span>nouveau <span class="token operator">-</span> distro free builtin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>如果你不确定安装哪一个好，可以跟着“推荐”（<code>recommended</code>）来：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">apt install nvidia<span class="token operator">-</span>driver<span class="token operator">-</span><span class="token number">525</span> <span class="token operator">-</span>y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>完成驱动安装，在 Ubuntu 22.04 中，将会自动加载内核驱动，如果你的操作系统没有自动完成驱动加载，那么可能需要执行重启。</p><p>再次执行检测命令，得到类似下面的日志：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">nvidia<span class="token operator">-</span>container<span class="token operator">-</span>cli <span class="token operator">-</span>k <span class="token operator">-</span>d <span class="token operator">/</span>dev<span class="token operator">/</span>tty info

<span class="token constant">NVRM</span> <span class="token literal-property property">version</span><span class="token operator">:</span>   <span class="token number">525.60</span><span class="token number">.11</span>
<span class="token constant">CUDA</span> <span class="token literal-property property">version</span><span class="token operator">:</span>   <span class="token number">12.0</span>

Device Index<span class="token operator">:</span>   <span class="token number">0</span>
Device Minor<span class="token operator">:</span>   <span class="token number">0</span>
<span class="token literal-property property">Model</span><span class="token operator">:</span>          Tesla <span class="token constant">V100</span><span class="token operator">-</span><span class="token constant">SXM2</span><span class="token operator">-</span>16GB
<span class="token literal-property property">Brand</span><span class="token operator">:</span>          Tesla
<span class="token constant">GPU</span> <span class="token constant">UUID</span><span class="token operator">:</span>       <span class="token constant">GPU</span><span class="token operator">-</span>775f6201<span class="token operator">-</span><span class="token number">9640</span><span class="token operator">-</span>a18e<span class="token operator">-</span>5d09<span class="token operator">-</span>3b26e9b11a52
Bus Location<span class="token operator">:</span>   <span class="token number">00000000</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">07.0</span>
<span class="token literal-property property">Architecture</span><span class="token operator">:</span>   <span class="token number">7.0</span>
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">25.463383</span> <span class="token number">42317</span> nvc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">434</span><span class="token punctuation">]</span> shutting down library context
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">25.463438</span> <span class="token number">42351</span> rpc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">95</span><span class="token punctuation">]</span> terminating nvcgo rpc service
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">25.463812</span> <span class="token number">42317</span> rpc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">135</span><span class="token punctuation">]</span> nvcgo rpc service terminated successfully
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">25.466657</span> <span class="token number">42346</span> rpc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">95</span><span class="token punctuation">]</span> terminating driver rpc service
<span class="token constant">I1209</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">25.466810</span> <span class="token number">42317</span> rpc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">135</span><span class="token punctuation">]</span> driver rpc service terminated successfully<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>不难发现，显卡类型已经能够被正常展示出来了。</p><h4 id="85m9h" name="%E4%B8%BA-Docker-%E6%B7%BB%E5%8A%A0-Nvidia-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%94%AF%E6%8C%81"><strong>为 Docker 添加 Nvidia 运行时支持</strong></h4><p>完成 Docker 和 Nvidia 显卡的安装之后，此时 Docker 还不能调用显卡硬件，还需要做一些配置上的调整。</p><p>执行下面的命令，将 <code>nvidia-container-runtime</code> 添加到 Docker 的启动参数中：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">sudo mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>docker<span class="token punctuation">.</span>service<span class="token punctuation">.</span>d

sudo tee <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>docker<span class="token punctuation">.</span>service<span class="token punctuation">.</span>d<span class="token operator">/</span>override<span class="token punctuation">.</span>conf <span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span>
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
ExecStart<span class="token operator">=</span>
ExecStart<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>dockerd <span class="token operator">--</span>host<span class="token operator">=</span>fd<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span> <span class="token operator">--</span>add<span class="token operator">-</span>runtime<span class="token operator">=</span>nvidia<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>nvidia<span class="token operator">-</span>container<span class="token operator">-</span>runtime
<span class="token constant">EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>搞定之后，执行下面的命令重载 <code>daemon-reload</code> 和重启 <code>docker</code>，让配置生效。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">sudo systemctl daemon<span class="token operator">-</span>reload
sudo systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>接着，为了万无一失，我们在 <code>/etc/docker/daemon.json</code> 中添加配置字段，如果需要的话，还可以在 <code>runtimeArgs</code> 中添加需要的参数：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">sudo tee <span class="token operator">/</span>etc<span class="token operator">/</span>docker<span class="token operator">/</span>daemon<span class="token punctuation">.</span>json <span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">"runtimes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">"nvidia"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">"path"</span><span class="token operator">:</span> <span class="token string">"/usr/bin/nvidia-container-runtime"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"runtimeArgs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token constant">EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><p>执行完毕，除了执行上面的命令之外，也可以用怀旧命令来重启服务 <code>service docker restart</code>。</p><p>现在，我们就可以在使用 Docker 的时候，调用 Nvidia 显卡啦：</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">docker run <span class="token operator">--</span>runtime<span class="token operator">=</span>nvidia <span class="token operator">--</span>ipc<span class="token operator">=</span>host <span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><h3 id="2a2cu" name="%E5%85%B6%E4%BB%96%EF%BC%9A%E5%A4%AA%E4%B9%99%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%B5%84%E6%BA%90%E8%A6%81%E6%B1%82"><strong>其他：太乙模型的资源要求</strong></h3><p>太乙模型实际资源要求，感觉还不错，默认配置情况下一般也就占 4G 不到的显存，偶尔输出“sampling steps”比较大的图，会膨胀到 8GB 左右。</p><p>所以，如果控制生成配置的“计算量”，“小卡”运行应该也问题不大。</p><div class="developer-code-block"><pre class="prism-token token line-numbers language-javascript" tabindex="0"><code class="language-javascript" style="margin-left: 0px;">nvidia<span class="token operator">-</span>smi
Fri Dec  <span class="token number">9</span> <span class="token number">22</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">23</span> <span class="token number">2022</span>       
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
<span class="token operator">|</span> <span class="token constant">NVIDIA</span><span class="token operator">-</span><span class="token constant">SMI</span> <span class="token number">525.60</span><span class="token number">.11</span>    Driver Version<span class="token operator">:</span> <span class="token number">525.60</span><span class="token number">.11</span>    <span class="token constant">CUDA</span> <span class="token literal-property property">Version</span><span class="token operator">:</span> <span class="token number">12.0</span>     <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
<span class="token operator">|</span> <span class="token constant">GPU</span>  Name        Persistence<span class="token operator">-</span><span class="token constant">M</span><span class="token operator">|</span> Bus<span class="token operator">-</span>Id        Disp<span class="token punctuation">.</span><span class="token constant">A</span> <span class="token operator">|</span> Volatile Uncorr<span class="token punctuation">.</span> <span class="token constant">ECC</span> <span class="token operator">|</span>
<span class="token operator">|</span> Fan  Temp  Perf  Pwr<span class="token operator">:</span>Usage<span class="token operator">/</span>Cap<span class="token operator">|</span>         Memory<span class="token operator">-</span>Usage <span class="token operator">|</span> <span class="token constant">GPU</span><span class="token operator">-</span>Util  Compute <span class="token constant">M</span><span class="token punctuation">.</span> <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span>                      <span class="token operator">|</span>               <span class="token constant">MIG</span> <span class="token constant">M</span><span class="token punctuation">.</span> <span class="token operator">|</span>
<span class="token operator">|=</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">+=</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">+=</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">0</span>  Tesla <span class="token constant">V100</span><span class="token operator">-</span><span class="token constant">SXM2</span><span class="token operator">...</span>  Off  <span class="token operator">|</span> <span class="token number">00000000</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">07.0</span> Off <span class="token operator">|</span>                    <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token constant">N</span><span class="token operator">/</span><span class="token constant">A</span>   38C    <span class="token constant">P0</span>    55W <span class="token operator">/</span> 300W <span class="token operator">|</span>   3202MiB <span class="token operator">/</span> 16384MiB <span class="token operator">|</span>      <span class="token number">0</span><span class="token operator">%</span>      Default <span class="token operator">|</span>
<span class="token operator">|</span>                               <span class="token operator">|</span>                      <span class="token operator">|</span>                  <span class="token constant">N</span><span class="token operator">/</span><span class="token constant">A</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
                                                                               
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
<span class="token operator">|</span> Processes<span class="token operator">:</span>                                                                  <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token constant">GPU</span>   <span class="token constant">GI</span>   <span class="token constant">CI</span>        <span class="token constant">PID</span>   Type   Process name                  <span class="token constant">GPU</span> Memory <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token constant">ID</span>   <span class="token constant">ID</span>                                                   Usage      <span class="token operator">|</span>
<span class="token operator">|=</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span><span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">0</span>   <span class="token constant">N</span><span class="token operator">/</span><span class="token constant">A</span>  <span class="token constant">N</span><span class="token operator">/</span><span class="token constant">A</span>    <span class="token number">181118</span>      <span class="token constant">C</span>   python                           3200MiB <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="developer-code-block-operation"><button class="developer-code-block-btn">复制</button></div></div><h3 id="75rdj" name="%E6%9C%80%E5%90%8E"><strong>最后</strong></h3><p>好啦，到这里本篇文章就写完啦。</p><p>接下来，我会考虑聊聊 AIGC 话题里，绕不开的一些“关键词”，比如：大模型、Mac 、ARMv64 、低成本的 FineTune 等等。</p><p>--EOF</p><p><strong>引用链接</strong></p><p><code>[1]</code> 深圳大湾区数字经济研究院(IDEA): <em style="font-style: italic;">https://idea.edu.cn/</em>
<code>[2]</code> 封神榜大模型: <em style="font-style: italic;">https://github.com/IDEA-CCNL/Fengshenbang-LM</em>
<code>[3]</code> 仓库的指引: <em style="font-style: italic;">https://github.com/IDEA-CCNL/Fengshenbang-LM#%E4%BD%BF%E7%94%A8docker</em>
<code>[4]</code> Issue 里的记录: <em style="font-style: italic;">https://github.com/IDEA-CCNL/Fengshenbang-LM/issues/186</em>
<code>[5]</code> github.com/soulteary/docker-stable-diffusion-taiyi: <em style="font-style: italic;">https://github.com/soulteary/docker-stable-diffusion-taiyi</em>
<code>[6]</code> 构建的: <em style="font-style: italic;">https://hub.docker.com/layers/fengshenbang/pytorch/1.10-cuda11.1-cudann8-devel/images/sha256-00000cd554f202391c27bce3f0bad334e27041f7b925e282e31e811c5a5afa6b?context=explore</em>
<code>[7]</code> Web UI 项目: <em style="font-style: italic;">https://github.com/IDEA-CCNL/stable-diffusion-webui</em>
<code>[8]</code> DockerHub 的这个页面搜索: <em style="font-style: italic;">https://hub.docker.com/r/nvidia/cuda/tags?page=1&amp;name=11.3</em>
<code>[9]</code> 《使用 Docker 和 HuggingFace 实现 NLP 文本情感分析应用》: <em style="font-style: italic;">https://soulteary.com/2022/09/30/nlp-text-sentiment-analysis-application-using-docker-and-huggingface.html</em>
<code>[10]</code> 《在笔记本上搭建高性价比的 Linux 学习环境：基础篇》: <em style="font-style: italic;">https://soulteary.com/2022/06/21/building-a-cost-effective-linux-learning-environment-on-a-laptop-the-basics.html</em>
<code>[11]</code> NVIDIA/nvidia-container-runtime: <em style="font-style: italic;">https://github.com/NVIDIA/nvidia-container-runtime</em>
本文使用「署名 4.0 国际 (CC BY 4.0)」许可协议，欢迎转载、或重新修改使用，但需要注明来源。 <strong>署名 4.0 国际 (CC BY 4.0)</strong></p></div></div></div><div class="mod-content__source"><div class="mod-content__source-inner"><div class="mod-content__source-title">本文参与&nbsp;<a href="https://cloud.tencent.com/developer/support-plan" target="_blank">腾讯云自媒体分享计划</a>，分享自微信公众号。</div><div class="mod-content__source-desc">原始发表：2022-12-09，如有侵权请联系&nbsp;<a href="mailto:cloudcommunity@tencent.com">cloudcommunity@tencent.com</a> 删除</div></div><div class="mod-content__source-qr"></div></div><div class="mod-statement-m"><div class="cdc-tag__list mod-content__tags"><div class="cdc-tag"><a class="cdc-tag__inner" href="https://cloud.tencent.com/developer/tag/10318" target="_blank">docker</a></div><div class="cdc-tag"><a class="cdc-tag__inner" href="https://cloud.tencent.com/developer/tag/10813" target="_blank">https</a></div><div class="cdc-tag"><a class="cdc-tag__inner" href="https://cloud.tencent.com/developer/tag/10681" target="_blank">网络安全</a></div><div class="cdc-tag"><a class="cdc-tag__inner" href="https://cloud.tencent.com/developer/tag/10649" target="_blank">容器</a></div></div><div class="mod-content__statement"><p>本文分享自 <span>折腾技术</span> 微信公众号，<span style="color: rgb(0, 82, 217);">前往查看</span></p><p>如有侵权，请联系 <a href="mailto:cloudcommunity@tencent.com">cloudcommunity@tencent.com</a> 删除。</p><p class="mod-content__statement-tip">本文参与&nbsp;<a href="https://cloud.tencent.com/developer/support-plan" target="_blank">腾讯云自媒体分享计划</a>&nbsp; ，欢迎热爱写作的你一起参与！</p></div></div><div class="cdc-tag__list mod-content__tags"><div class="cdc-tag"><a class="cdc-tag__inner" href="https://cloud.tencent.com/developer/tag/10318" target="_blank">docker</a></div><div class="cdc-tag"><a class="cdc-tag__inner" href="https://cloud.tencent.com/developer/tag/10813" target="_blank">https</a></div><div class="cdc-tag"><a class="cdc-tag__inner" href="https://cloud.tencent.com/developer/tag/10681" target="_blank">网络安全</a></div><div class="cdc-tag"><a class="cdc-tag__inner" href="https://cloud.tencent.com/developer/tag/10649" target="_blank">容器</a></div></div></div></div><div class="mod-article-content is-pill-hidden"><div class="mod-comment"><div class="mod-relevant__title">评论</div><div class="cdc-comment-response is-blank"><div class="cdc-comment-response-single-edit not-logged"><div class="cdc-comment-response-single-edit__inner"><span class="cdc-avatar cdc-comment-response-single-edit__avatar cdc-comment__avatar circle"><span class="cdc-avatar__inner" target="_blank" style="background-image: url(&quot;https://qcloudimg.tencent-cloud.cn/raw/2eca91c9c29816ff056d22815949d83c.png&quot;);"></span></span><div class="cdc-comment-response-single-edit__main"><span>登录</span>后参与评论</div></div></div><div class="cdc-comment-response__toolbar"></div><div class="cdc-comment-response-inner"><div class="cdc-comment-response__body is-blank"><div class="cdc-comment-response__blank"><i class="cdc-comment-response__blank-img"></i><div class="cdc-comment-response__blank-tip">暂无评论</div></div></div></div><div class="cdc-operate-footer"><div class="cdc-operate-footer__inner"><div class="cdc-operate-footer__toggle is-logout"><div class="cdc-operate-footer__toggle-text"><span>登录 </span>后参与评论</div></div></div></div></div></div></div><div class="mod-article-content recommend"><div class="mod-relevant"><div class="mod-relevant__title">推荐</div><div class="mod-relevant__list" track-click="{&quot;areaId&quot;:106001}"><div class="cdc-article-panel-response__list"><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:1,&quot;objectId&quot;:2369775,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:1,&quot;objectId&quot;:2369775,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2369775?areaId=106001" target="_blank" class="cdc-article-panel-response__title">StableDiffusion-WebUI安装</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17674" target="_blank">stable diffusion</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">在webui.py文件77行左右如下代码前加入cmd_opts.listen = True，可以让外部地址访问服务。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/8687029" target="_blank" style="background-image: url(&quot;https://ask.qcloudimg.com/http-save/yehe-8687029/ab11d89ac8cac00e8783bb02ee06ed45.jpeg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">Luoyger</div></div><div class="cdc-article-panel-response__date">2023-12-12</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">220</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:2,&quot;objectId&quot;:2355771,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:2,&quot;objectId&quot;:2355771,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2355771?areaId=106001" target="_blank" class="cdc-article-panel-response__title">AI绘画专栏之statble diffusion入门之插件篇(二)</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17674" target="_blank">stable diffusion</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17717" target="_blank">AI绘画</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17988" target="_blank">2023腾讯·技术创作特训营 第三期</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/12537" target="_blank">chatgpt</a></div></div><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/6026903" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/6ed6a0f26f6bcbdcd9a034a5b0767460.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">疯狂的KK</div></div><div class="cdc-article-panel-response__date">2023-11-07</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">275</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/20231107-a0419ca0.png" alt="AI绘画专栏之statble diffusion入门之插件篇(二)"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:3,&quot;objectId&quot;:2354455,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:3,&quot;objectId&quot;:2354455,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2354455?areaId=106001" target="_blank" class="cdc-article-panel-response__title">完整详细的stable-diffusion-webui的参数和配置</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/11746" target="_blank">aigc</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17674" target="_blank">stable diffusion</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">指定环境变量的推荐方法是编辑 webui-user.bat (Windows) 和 webui-user.sh (Linux)：</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/3546447" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/a56be3827ca932a2b0b948f4608a4a9a.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">一凡sir</div></div><div class="cdc-article-panel-response__date">2023-11-03</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">1.1K</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/45a6036dd8c728a334a1cef94f8eae95.jpg" alt="完整详细的stable-diffusion-webui的参数和配置"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:4,&quot;objectId&quot;:2354474,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:4,&quot;objectId&quot;:2354474,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2354474?areaId=106001" target="_blank" class="cdc-article-panel-response__title">stable-diffusion-webui的优化配置</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/11746" target="_blank">aigc</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17674" target="_blank">stable diffusion</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">1 https://github.com/AUTOMATIC1111/stable-diffusion-webui/discussions/3889 禁用硬件 GPU 调度。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/3546447" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/a56be3827ca932a2b0b948f4608a4a9a.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">一凡sir</div></div><div class="cdc-article-panel-response__date">2023-11-03</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">473</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">2</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/f50b67b5a2c19393eaa15edcd93aa873.jpg" alt="stable-diffusion-webui的优化配置"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:5,&quot;objectId&quot;:2271484,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:5,&quot;objectId&quot;:2271484,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2271484?areaId=106001" target="_blank" class="cdc-article-panel-response__title">StableDiffusion 腾讯云服务器快速部署</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10348" target="_blank">GPU 云服务器</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10149" target="_blank">机器学习</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17203" target="_blank">部署</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10333" target="_blank">深度学习</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/11746" target="_blank">aigc</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">上期给大家介绍了如何用腾讯云服务器快速部署chilloutmix（传送门：ChilloutMix 腾讯云服务器快速部署 - 腾讯云开发者社区-腾讯云）。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/2932999" target="_blank" style="background-image: url(&quot;https://ask.qcloudimg.com/avatar/male/SJal3OT-ruX.png&quot;);"></a></span><div class="cdc-article-panel-response__user-name">geru</div></div><div class="cdc-article-panel-response__date">2023-04-23</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">25.6K</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">47</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/qbm7dvi550.jpeg" alt="StableDiffusion 腾讯云服务器快速部署"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:6,&quot;objectId&quot;:2371576,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:6,&quot;objectId&quot;:2371576,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2371576?areaId=106001" target="_blank" class="cdc-article-panel-response__title">【腾讯云HAI域探密】- AIGC应用助力企业降本增效之路</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17993" target="_blank">高性能应用服务</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">近年来，随着深度学习、大数据、人工智能、AI等技术领域的不断发展，机器学习是目前最火热的人工智能分支之一，是使用大量数据训练计算机程序，以实现智能决策、语音识别、图像处理等任务。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/10585271" target="_blank" style="background-image: url(&quot;https://ask.qcloudimg.com/avatar/female/HkGppj-BOX.png&quot;);"></a></span><div class="cdc-article-panel-response__user-name">用户10585271</div></div><div class="cdc-article-panel-response__date">2023-12-16</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">5.9K</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/a78776ba0ad174550741e1c65d938b31.png" alt="【腾讯云HAI域探密】- AIGC应用助力企业降本增效之路"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:7,&quot;objectId&quot;:2372502,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:7,&quot;objectId&quot;:2372502,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2372502?areaId=106001" target="_blank" class="cdc-article-panel-response__title">Stable Diffusion 认知以及 windows 下部署</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10806" target="_blank">windows</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17203" target="_blank">部署</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17205" target="_blank">测试</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17324" target="_blank">脚本</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17381" target="_blank">模型</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc"> 对每个人而言，真正的职责只有一个：找到自我。然后在心中坚守其一生，全心全意，永不停息。所有其它的路都是不完整的，是人的逃避方式，是对大众理想的懦弱回归，是随波逐流，是对内心的恐惧 ——赫尔曼·黑塞《德米安》</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/9163071" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/47faec4ef47787115e8d4408cf92c5d8.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">山河已无恙</div></div><div class="cdc-article-panel-response__date">2023-12-19</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">103</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/0cd5ae6b5e77c2381c8fcc48bd575309.jpg" alt="Stable Diffusion 认知以及 windows 下部署"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:8,&quot;objectId&quot;:2371482,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:8,&quot;objectId&quot;:2371482,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2371482?areaId=106001" target="_blank" class="cdc-article-panel-response__title">【腾讯云 HAI域探秘】借助高性能应用HAI——我也能使用【stable diffusion】制作高级视频封面了</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10348" target="_blank">GPU 云服务器</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">腾讯云出了个——高性能应用服务HAI_GPU云服务器，有了这个服务器我也能跑一跑【stable diffusion】 来生成一些想要的图片啦——开心。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/10881983" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/202c50a39663a4ca11de66cc6500cb34.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">未来可期</div></div><div class="cdc-article-panel-response__date">2023-12-15</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">131</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/fef9f6befef5c86099cca7d5e6b82ae5.png" alt="【腾讯云 HAI域探秘】借助高性能应用HAI——我也能使用【stable diffusion】制作高级视频封面了"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:9,&quot;objectId&quot;:2361130,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:9,&quot;objectId&quot;:2361130,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2361130?areaId=106001" target="_blank" class="cdc-article-panel-response__title">都2023年了，HAI没玩过AIGC？</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/11615" target="_blank">腾讯云</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/11746" target="_blank">aigc</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17988" target="_blank">2023腾讯·技术创作特训营 第三期</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">腾讯云高性能应用服务(Hyper Application lnventor，HA)，是一款面向 Al、科学计算的 GPU 应用服务产品，为开发者量身打造的澎湃算力平台。无需复杂配置，便可享受即开即用的GPU云服务体验。在 HA] 中，根据应用智能匹配并推选出最适合的 GPU 算力资源，以确保您在数据科学、LLM、AI作画等高性能应用中获得最佳性价比此外，HAI的一键部署特性让您可以在短短几分钟内构建如 StableDifusion、ChatGLM 等热门模型的应用环境。而对于 Al 研究者，我们的直观图形界面大大降低了调试的复杂度，支持jupyterlab、webui 等多种连接方式，助您轻松探索与创新。现在，只需打开浏览器，HAI 便为您打开了一片无限可能的高性能应用领域。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/4189771" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/1734546d8b7dedcd9d24a0592bf1ffe2.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">指剑</div></div><div class="cdc-article-panel-response__date">2023-11-20</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">153</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/20231120-8e5fe7cc.png" alt="都2023年了，HAI没玩过AIGC？"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:10,&quot;objectId&quot;:2355766,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:10,&quot;objectId&quot;:2355766,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2355766?areaId=106001" target="_blank" class="cdc-article-panel-response__title">AI绘画专栏之statble diffusion入门(一)</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/12537" target="_blank">chatgpt</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17674" target="_blank">stable diffusion</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17717" target="_blank">AI绘画</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17988" target="_blank">2023腾讯·技术创作特训营 第三期</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">我用夸克网盘分享了「SD启动器下载」，点击链接即可保存。打开「夸克APP」，无需下载在线播放视频，畅享原画5倍速，支持电视投屏。 链接：https://pan.quark.cn/s/b16bc4d3ff88</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/6026903" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/6ed6a0f26f6bcbdcd9a034a5b0767460.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">疯狂的KK</div></div><div class="cdc-article-panel-response__date">2023-11-07</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">444</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/ee16da8bf1ba8c0269d9ef725c5f3e8c.jpg" alt="AI绘画专栏之statble diffusion入门(一)"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:11,&quot;objectId&quot;:2329175,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:11,&quot;objectId&quot;:2329175,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2329175?areaId=106001" target="_blank" class="cdc-article-panel-response__title">实战制作stable diffusion的修复模型inpaint model</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10539" target="_blank">人工智能</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/11746" target="_blank">aigc</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17674" target="_blank">stable diffusion</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">本文详述如何通过已有的dreamlike-art/dreamlike-photoreal-2.0标准模型standard model，制作其修复模型inpaint model。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/6495786" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/ed0e356fcd0f240ddb36f07b8aaf61f1.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">buzzfrog</div></div><div class="cdc-article-panel-response__date">2023-09-15</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">899</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">3</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/13e81ad163ef1fc95762026bc90d6cfe.png" alt="实战制作stable diffusion的修复模型inpaint model"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:12,&quot;objectId&quot;:2356629,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:12,&quot;objectId&quot;:2356629,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2356629?areaId=106001" target="_blank" class="cdc-article-panel-response__title">AI绘画专栏之statble diffusion  放大图片 (九)</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17674" target="_blank">stable diffusion</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17717" target="_blank">AI绘画</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17919" target="_blank">Midjourney</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17988" target="_blank">2023腾讯·技术创作特训营 第三期</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">在数字时代，拍照、截图、保存美景已经成为我们生活中的常态。然而，有时候我们会遇到一些问题：图像过于模糊、细节不清晰、像素低，这些都可能影响我们欣赏和分享美好瞬间的体验。幸运的是，如今有免费的AI图像高清放大工具可以帮助我们解决这些问题，让我们能够享受更清晰、更精彩的图像。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/6026903" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/6ed6a0f26f6bcbdcd9a034a5b0767460.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">疯狂的KK</div></div><div class="cdc-article-panel-response__date">2023-11-09</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">180</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/1873cefa8c47e0985c2ffe6aeee64e37.png" alt="AI绘画专栏之statble diffusion  放大图片 (九)"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:13,&quot;objectId&quot;:2358570,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:13,&quot;objectId&quot;:2358570,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2358570?areaId=106001" target="_blank" class="cdc-article-panel-response__title">AI绘画专栏之statble diffusion SDXL 1.0 换脸roop easyphoto (24)</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17674" target="_blank">stable diffusion</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17717" target="_blank">AI绘画</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17919" target="_blank">Midjourney</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17988" target="_blank">2023腾讯·技术创作特训营 第三期</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">支持使用SDXL模型和一定的选项直接生成高清大图，不再需要上传模板，需要16GB显存</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/6026903" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/6ed6a0f26f6bcbdcd9a034a5b0767460.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">疯狂的KK</div></div><div class="cdc-article-panel-response__date">2023-11-15</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">632</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/165c40de34de113ca3254a27c3d9781e.png" alt="AI绘画专栏之statble diffusion SDXL 1.0 换脸roop easyphoto (24)"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:14,&quot;objectId&quot;:2369737,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:14,&quot;objectId&quot;:2369737,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2369737?areaId=106001" target="_blank" class="cdc-article-panel-response__title">【腾讯云HAI域探秘】搭建一个永不宕机的本地SD文本生成图像应用--喂饭级高性能应用HAI部署stable diffusion webui 一键文生图</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10555" target="_blank">高性能计算</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17310" target="_blank">计算机视觉</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10539" target="_blank">人工智能</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">本次有幸受邀作为新品先锋体验官参加了【腾讯云HAI域探秘】活动，沉浸式体验高性能应用服务HAI产品 + Stable Diffusion WebUI部署。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/10172274" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/5dfc13256087b29ca746d2f70aefff0c.png&quot;);"></a></span><div class="cdc-article-panel-response__user-name">中杯可乐多加冰</div></div><div class="cdc-article-panel-response__date">2023-12-12</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">165</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:15,&quot;objectId&quot;:2371360,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:15,&quot;objectId&quot;:2371360,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2371360?areaId=106001" target="_blank" class="cdc-article-panel-response__title">【腾讯云HAI域探秘】“赋予艺术生命：通过腾讯云HAI和MagicAnimate呈现动态蒙娜丽莎“</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/11689" target="_blank">achartengine</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">AI 视频生成领域近期算是非常热闹，个人也是非常的感兴趣，奈何电脑不给力，在搭建的过程中总是提示各种各样的问题 ， 不过天无绝人之路， 最近 腾讯云高性能应用服务(Hyper Application Inventor,HAI) 活动正在如火如荼的进行着， 因此决定挑战一下， 看下在HAI 上搭建 AI 动画生成框架 MagicAnimate 是否会有不一样的收获.</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/1258955" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/a09e7bf540ccdea71adc00cf55664022.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">全栈若城</div></div><div class="cdc-article-panel-response__date">2023-12-15</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">214</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">1</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:16,&quot;objectId&quot;:2331523,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:16,&quot;objectId&quot;:2331523,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2331523?areaId=106001" target="_blank" class="cdc-article-panel-response__title">基于腾讯云云服务器CVM运行Grounded-Segment-Anything</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10539" target="_blank">人工智能</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">Grounded-Segment-Anything是一个通过结合Grounding DINO和Segment Anything 来创建一个非常有趣的Demo，旨在检测和分割任何带有文本输入的东西！</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/6495786" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/ed0e356fcd0f240ddb36f07b8aaf61f1.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">buzzfrog</div></div><div class="cdc-article-panel-response__date">2023-09-20</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">226</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:17,&quot;objectId&quot;:2371541,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:17,&quot;objectId&quot;:2371541,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2371541?areaId=106001" target="_blank" class="cdc-article-panel-response__title">【腾讯云 HAI域探秘】——即时职场生存指南小游戏以及【自行搭建Stable Diffusion图片AI绘制 | ChatGLM2-6B AI进行智能对话 |</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/13756" target="_blank">gpu</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10348" target="_blank">GPU 云服务器</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">ChatGLM2-6B 是开源中英双语对话模型 ChatGLM-6B 的第二代版本，在保留了初代模型对话流畅、部署门槛较低等众多优秀特性的基础之上，ChatGLM2-6B 引入了更强大的性能、更长的上下文、更高效的推理，所以用来做个小游戏非常的合适了。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/2671013" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/aebf724c0fc8fce0b30f79f9fb4a4613.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">红目香薰</div></div><div class="cdc-article-panel-response__date">2023-12-16</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">126</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/aaeaea8646b56238f49c1acbde4d866c.png" alt="【腾讯云 HAI域探秘】——即时职场生存指南小游戏以及【自行搭建Stable Diffusion图片AI绘制 | ChatGLM2-6B AI进行智能对话 |"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:18,&quot;objectId&quot;:2307254,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:18,&quot;objectId&quot;:2307254,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2307254?areaId=106001" target="_blank" class="cdc-article-panel-response__title">Stable Diffusion 硬核生存指南：WebUI 中的 CodeFormer</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17674" target="_blank">stable diffusion</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10169" target="_blank">python</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10318" target="_blank">docker</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">本篇文章聊聊 Stable Diffusion WebUI 中的核心组件，强壮的人脸图像面部画面修复模型 CodeFormer 相关的事情。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/1436546" target="_blank" style="background-image: url(&quot;https://ask.qcloudimg.com/http-save/yehe-1436546/8ff3879a73799b17b355bfdd88337c0b.jpg&quot;);"></a></span><div class="cdc-article-panel-response__user-name">soulteary</div></div><div class="cdc-article-panel-response__date">2023-08-02</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">539</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:19,&quot;objectId&quot;:2371174,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:19,&quot;objectId&quot;:2371174,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2371174?areaId=106001" target="_blank" class="cdc-article-panel-response__title">【腾讯云 HAI 域探秘】10 分钟构建一个多音色控制的 TTS 引擎</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/10348" target="_blank">GPU 云服务器</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">最近在业务中有一个生成一批音频的需求，尝试使用有道开源的 EmotiVoice 项目来实现。然而，在部署 EmotiVoice 的过程中，CUDA 和 PyTorch 环境配置总是有问题。经过一天的斗争，决定寻求其他解决方案。在同事的推荐下，了解到腾讯云还在内测的高性能应用服务 HAI。通过使用 HAI，整个部署过程变得无比丝滑，迅速完成了任务。这里记录一下整个过程。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/10819167" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/avatar/19167.png&quot;);"></a></span><div class="cdc-article-panel-response__user-name">用户10819167</div></div><div class="cdc-article-panel-response__date">2023-12-14</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">155</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">1</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/20231214-de284769.png" alt="【腾讯云 HAI 域探秘】10 分钟构建一个多音色控制的 TTS 引擎"></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:20,&quot;objectId&quot;:2360767,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:20,&quot;objectId&quot;:2360767,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106001,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2360767?areaId=106001" target="_blank" class="cdc-article-panel-response__title">【腾讯云 HAI域探秘】HAI轻松搭建stable diffusion, 开启AI绘画奇妙之旅</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-tag-links cdc-article-panel-response__tags"><i class="cdc-tag-links__icon"></i><div class="cdc-tag-links__items"><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/11746" target="_blank">aigc</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17674" target="_blank">stable diffusion</a><a class="cdc-tag-links__item" href="https://cloud.tencent.com/developer/tag/17717" target="_blank">AI绘画</a></div></div><div class="cdc-article-panel-response__media"><div class="cdc-article-panel-response__desc">2022年下半年开始，从chatgpt的火爆出圈到今天各种好玩的模型、工具应用层出不穷，迭代更新速度更是日新月异，让普通用户也直观的感受到了AI技术的强大。</div></div><div class="cdc-article-panel-response__infos"><div class="cdc-article-panel-response__user"><span class="cdc-avatar large cdc-article-panel-response__user-avatar circle"><a class="cdc-avatar__inner" href="https://cloud.tencent.com/developer/user/8653637" target="_blank" style="background-image: url(&quot;https://developer.qcloudimg.com/http-save/10011/72118c1265451a1698727e9a4fe9f741.png&quot;);"></a></span><div class="cdc-article-panel-response__user-name">用户8653637</div></div><div class="cdc-article-panel-response__date">2023-11-19</div><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">338</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div><div class="cdc-article-panel-response__object"><img class="cdc-article-panel-response__object-thumbnail" src="./docker-compose_files/d7132121ece2e3979ea96235ee59558d.png" alt="【腾讯云 HAI域探秘】HAI轻松搭建stable diffusion, 开启AI绘画奇妙之旅"></div></div></div></div></div></div></div><div class="mod-recommend"><div class="mod-recommend__title">相关推荐</div><div class="mod-recommend__list"><div class="cdc-article-panel-response__list"><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:1,&quot;objectId&quot;:2369775,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:1,&quot;objectId&quot;:2369775,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2369775?areaId=106005" target="_blank" class="cdc-article-panel-response__title">StableDiffusion-WebUI安装</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">220</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:2,&quot;objectId&quot;:2355771,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:2,&quot;objectId&quot;:2355771,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2355771?areaId=106005" target="_blank" class="cdc-article-panel-response__title">AI绘画专栏之statble diffusion入门之插件篇(二)</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">275</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:3,&quot;objectId&quot;:2354455,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:3,&quot;objectId&quot;:2354455,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2354455?areaId=106005" target="_blank" class="cdc-article-panel-response__title">完整详细的stable-diffusion-webui的参数和配置</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">1.1K</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:4,&quot;objectId&quot;:2354474,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:4,&quot;objectId&quot;:2354474,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2354474" target="_blank" class="cdc-article-panel-response__title">stable-diffusion-webui的优化配置</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">473</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">2</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:5,&quot;objectId&quot;:2271484,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:5,&quot;objectId&quot;:2271484,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2271484" target="_blank" class="cdc-article-panel-response__title">StableDiffusion 腾讯云服务器快速部署</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">25.6K</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">47</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:6,&quot;objectId&quot;:2371576,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:6,&quot;objectId&quot;:2371576,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2371576" target="_blank" class="cdc-article-panel-response__title">【腾讯云HAI域探密】- AIGC应用助力企业降本增效之路</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">5.9K</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:7,&quot;objectId&quot;:2372502,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:7,&quot;objectId&quot;:2372502,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2372502" target="_blank" class="cdc-article-panel-response__title">Stable Diffusion 认知以及 windows 下部署</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">103</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-event-card with-tag"><span class="cdc-event-card__tag orange" track-click="{&quot;elementId&quot;:1}">广告</span><div track-click="{&quot;elementId&quot;:2}" class="cdc-event-card__close"></div><div class="cdc-event-card__inner"><div class="cdc-event-card__object" track-click="{&quot;elementId&quot;:3}"><div class="cdc-event-card__object-image" style="background-image: url(&quot;&quot;);"></div></div><div class="cdc-event-card__detail"><div class="cdc-event-card__title" track-click="{&quot;elementId&quot;:4}">Web应用防火墙，新用户7天0元试用</div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:8,&quot;objectId&quot;:2371482,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:8,&quot;objectId&quot;:2371482,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2371482" target="_blank" class="cdc-article-panel-response__title">【腾讯云 HAI域探秘】借助高性能应用HAI——我也能使用【stable diffusion】制作高级视频封面了</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">131</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:9,&quot;objectId&quot;:2361130,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:9,&quot;objectId&quot;:2361130,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2361130" target="_blank" class="cdc-article-panel-response__title">都2023年了，HAI没玩过AIGC？</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">153</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:10,&quot;objectId&quot;:2355766,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:10,&quot;objectId&quot;:2355766,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2355766" target="_blank" class="cdc-article-panel-response__title">AI绘画专栏之statble diffusion入门(一)</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">444</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:11,&quot;objectId&quot;:2329175,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:11,&quot;objectId&quot;:2329175,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2329175" target="_blank" class="cdc-article-panel-response__title">实战制作stable diffusion的修复模型inpaint model</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">899</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">3</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:12,&quot;objectId&quot;:2356629,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:12,&quot;objectId&quot;:2356629,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2356629" target="_blank" class="cdc-article-panel-response__title">AI绘画专栏之statble diffusion  放大图片 (九)</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">180</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:13,&quot;objectId&quot;:2358570,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:13,&quot;objectId&quot;:2358570,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2358570" target="_blank" class="cdc-article-panel-response__title">AI绘画专栏之statble diffusion SDXL 1.0 换脸roop easyphoto (24)</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">632</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:14,&quot;objectId&quot;:2369737,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:14,&quot;objectId&quot;:2369737,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2369737" target="_blank" class="cdc-article-panel-response__title">【腾讯云HAI域探秘】搭建一个永不宕机的本地SD文本生成图像应用--喂饭级高性能应用HAI部署stable diffusion webui 一键文生图</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">165</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:15,&quot;objectId&quot;:2371360,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:15,&quot;objectId&quot;:2371360,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2371360" target="_blank" class="cdc-article-panel-response__title">【腾讯云HAI域探秘】“赋予艺术生命：通过腾讯云HAI和MagicAnimate呈现动态蒙娜丽莎“</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">214</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">1</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:16,&quot;objectId&quot;:2331523,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:16,&quot;objectId&quot;:2331523,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2331523" target="_blank" class="cdc-article-panel-response__title">基于腾讯云云服务器CVM运行Grounded-Segment-Anything</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">226</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:17,&quot;objectId&quot;:2371541,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:17,&quot;objectId&quot;:2371541,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2371541" target="_blank" class="cdc-article-panel-response__title">【腾讯云 HAI域探秘】——即时职场生存指南小游戏以及【自行搭建Stable Diffusion图片AI绘制 | ChatGLM2-6B AI进行智能对话 |</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">126</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:18,&quot;objectId&quot;:2307254,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:18,&quot;objectId&quot;:2307254,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2307254" target="_blank" class="cdc-article-panel-response__title">Stable Diffusion 硬核生存指南：WebUI 中的 CodeFormer</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">539</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:19,&quot;objectId&quot;:2371174,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:19,&quot;objectId&quot;:2371174,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2371174" target="_blank" class="cdc-article-panel-response__title">【腾讯云 HAI 域探秘】10 分钟构建一个多音色控制的 TTS 引擎</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">155</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">1</span></span></div></div></div></div></div><div class="cdc-article-panel-response" track-click="{&quot;positionId&quot;:20,&quot;objectId&quot;:2360767,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}" track-exposure="{&quot;positionId&quot;:20,&quot;objectId&quot;:2360767,&quot;objectType&quot;:&quot;article&quot;,&quot;areaId&quot;:106005,&quot;recPolicyId&quot;:&quot;1001&quot;}"><a href="https://cloud.tencent.com/developer/article/2360767" target="_blank" class="cdc-article-panel-response__title">【腾讯云 HAI域探秘】HAI轻松搭建stable diffusion, 开启AI绘画奇妙之旅</a><div class="cdc-article-panel-response__inner"><div class="cdc-article-panel-response__main"><div class="cdc-article-panel-response__media"></div><div class="cdc-article-panel-response__infos"><div class="cdc-icon__list cdc-article-panel-response__operate"><span class="cdc-icon"><i class="icon-view"></i><span class="cdc-icon__number">338</span></span><span class="cdc-icon"><i class="icon-ask"></i><span class="cdc-icon__number">0</span></span></div></div></div></div></div></div></div><div class="cdc-layout__side"><div class="cdc-personal-info mod-author user" track-click="{}"><div class="cdc-personal-info__inner"><div class="cdc-personal-info__content"><div class="cdc-personal-info__hd"><strong>关于作者</strong></div><div class="cdc-personal-info__detail"><div class="cdc-personal-info__avatar"><span track-click="{&quot;elementId&quot;:1}" class="cdc-avatar xxlarge" style="cursor: pointer;"><span class="cdc-avatar__inner" style="background-image: url(&quot;https://ask.qcloudimg.com/http-save/yehe-1436546/8ff3879a73799b17b355bfdd88337c0b.jpg&quot;);"></span><div class="cdc-avatar__level">LV4</div></span></div><div class="cdc-personal-info__main"><div class="cdc-personal-info__name"><span class="cdc-personal-info__name-text" track-click="{&quot;elementId&quot;:2}" style="cursor: pointer;">soulteary</span></div><div class="cdc-personal-info__position"><span class="cdc-personal-info__position-text">数字化领域的创业者</span></div></div></div><div class="cdc-personal-info__list"><a track-click="" class="cdc-personal-info__item" href="https://cloud.tencent.com/developer/user/1436546/articles" target="_blank" style="cursor: pointer;"><div class="cdc-personal-info__item-number">334</div><div class="cdc-personal-info__item-text">文章</div></a><a track-click="" class="cdc-personal-info__item" href="https://cloud.tencent.com/developer/user/1436546" target="_blank" style="cursor: pointer;"><div class="cdc-personal-info__item-number">354.1K</div><div class="cdc-personal-info__item-text">累计阅读量</div></a><a track-click="" class="cdc-personal-info__item" href="https://cloud.tencent.com/developer/user/1436546" target="_blank" style="cursor: pointer;"><div class="cdc-personal-info__item-number">690</div><div class="cdc-personal-info__item-text">获赞</div></a><a track-click="" class="cdc-personal-info__item" href="https://cloud.tencent.com/developer/rank" target="_blank" style="cursor: pointer;"><div class="cdc-personal-info__item-number">69</div><div class="cdc-personal-info__item-text">作者排名</div></a></div><div class="cdc-personal-info__operates"><button class="cdc-btn cdc-personal-info__operate cdc-btn--primary"><i class="icon-add"></i>关注</button><a class="cdc-btn cdc-personal-info__operate cdc-btn--hole" href="https://cloud.tencent.com/developer/column/73784" target="_blank">前往专栏</a></div></div></div></div><div class="cdc-group-qr-card"><div class="cdc-group-qr-card-text"><div class="cdc-group-qr-card-title">添加站长 进交流群</div><div class="cdc-group-qr-card-desc"><p>领取专属 <em>10元无门槛券</em></p><p>私享最新 <em>技术干货</em></p></div></div><div class="cdc-group-qr-card-qr"><img src="./docker-compose_files/6480d40345c19eca1086eea706ccde81.png"></div><div class="cdc-group-qr-card-close"><span class="cdc-svg-icon-con"><span class="cdc-svg-icon" style="width: 12px; height: 12px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9 2H7V7H2V9H7V14H9V9H14V7H9V2Z"></path></svg></span></span></div></div><div class="mod-sticky-act is-sticky"><div class="cdc-directory"><div class="cdc-directory__wrap"><div class="cdc-directory__inner"><div class="cdc-directory__hd">目录</div><div class="cdc-directory__bd"><div class="cdc-directory__bd-box"><ul class="cdc-directory__list level-1"><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-2rs84">写在前面</span></li><li class="cdc-directory__item is-active"><span class="cdc-directory__target" id="menu-205mf">快速上手</span></li><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-cigfq">如何将“太乙”正确的放进容器</span><ul class="cdc-directory__list level-2"><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-dbdte">分析太乙官方镜像和应用项目存在的问题</span><ul class="cdc-directory__list level-3"></ul></li><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-7bb7o">解决被官方忽视的 AI 容器应用问题</span><ul class="cdc-directory__list level-3"></ul></li><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-atgac">进一步优化 AI 应用的镜像尺寸</span><ul class="cdc-directory__list level-3"></ul></li></ul></li><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-5p0c2">GPU 云主机环境的配置</span><ul class="cdc-directory__list level-2"><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-2faeu">Docker 基础环境的安装</span><ul class="cdc-directory__list level-3"></ul></li><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-6a8eo">完善 Nvidia 显卡驱动安装</span><ul class="cdc-directory__list level-3"></ul></li><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-85m9h">为 Docker 添加 Nvidia 运行时支持</span><ul class="cdc-directory__list level-3"></ul></li></ul></li><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-2a2cu">其他：太乙模型的资源要求</span></li><li class="cdc-directory__item"><span class="cdc-directory__target" id="menu-75rdj">最后</span></li></ul></div></div></div></div></div><div class="cdc-commercial-swiper"><div class="tpm1-swiper cdc-commercial-swiper-con"><div class="swiper-container swiper-container-initialized swiper-container-horizontal swiper-container-pointer-events"><div class="swiper-wrapper" id="swiper-wrapper-d0daa2d97c10bd1059" aria-live="polite" style="transform: translate3d(0px, 0px, 0px);"><div class="swiper-slide swiper-slide-active" role="group" aria-label="1 / 1" style="width: 336px;"><div class="cdc-commercial-space"><div class="cdc-commercial-space__inner"><div class="cdc-commercial-space__tag">广告</div><div class="cdc-commercial-space__close"></div><a href="https://cloud.tencent.com/act/pro/Exclusive-TXY?from=20177&amp;from_column=20177" target="_blank"><img src="./docker-compose_files/20230817-52e3cd4b.png" alt="广告图" class="cdc-commercial-space__image"></a></div></div></div></div><span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span></div></div></div></div></div></div></div></div><div class="cdc-widget-global"><div class="cdc-widget-global__btn"><div class="cdc-widget-global__btn-tag">领券</div></div><div class="cdc-widget-global__btn top" style=""></div></div><div class="cdc-footer"><div class="cdc-footer__inner"><div class="cdc-footer__main"><div class="cdc-footer__website"><ul class="cdc-footer__website-group"><li class="cdc-footer__website-column"><div class="cdc-footer__website-box"><h3 class="cdc-footer__website-title">社区</h3><ul class="cdc-footer__website-list"><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/column">专栏文章</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/inventory">阅读清单</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/ask">互动问答</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/salon">技术沙龙</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/video">技术视频</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/teams">团队主页</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/timl">腾讯云TI平台</a></li></ul></div></li><li class="cdc-footer__website-column"><div class="cdc-footer__website-box"><h3 class="cdc-footer__website-title">活动</h3><ul class="cdc-footer__website-list"><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/support-plan">自媒体分享计划</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/support-plan-invitation">邀请作者入驻</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/article/1535830">自荐上首页</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/competition">技术竞赛</a></li></ul></div></li><li class="cdc-footer__website-column"><div class="cdc-footer__website-box"><h3 class="cdc-footer__website-title">资源</h3><ul class="cdc-footer__website-list"><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/specials">技术周刊</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/tags">社区标签</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/developer/devdocs">开发者手册</a></li><li class="cdc-footer__website-item"><a href="https://cloud.tencent.com/lab?from=20064&amp;from_column=20064">开发者实验室</a></li></ul></div></li><li class="cdc-footer__website-column"><div class="cdc-footer__website-box"><h3 class="cdc-footer__website-title">关于</h3><ul class="cdc-footer__website-list"><li class="cdc-footer__website-item"><a rel="nofollow" href="https://cloud.tencent.com/developer/article/1006434">社区规范</a></li><li class="cdc-footer__website-item"><a rel="nofollow" href="https://cloud.tencent.com/developer/article/1006435">免责声明</a></li><li class="cdc-footer__website-item"><a rel="nofollow" href="mailto:cloudcommunity@tencent.com">联系我们</a></li><li class="cdc-footer__website-item"><a rel="nofollow" href="https://cloud.tencent.com/developer/friendlink">友情链接</a></li></ul></div></li></ul></div><div class="cdc-footer__qr"><h3 class="cdc-footer__qr-title">腾讯云开发者</h3><div class="cdc-footer__qr-object"><img class="cdc-footer__qr-image" src="https://cloud.tencent.com/developer/article/2233624?from=15425" alt="扫码关注腾讯云开发者"></div><div class="cdc-footer__qr-infos"><p class="cdc-footer__qr-info"><span class="cdc-footer__qr-text">扫码关注腾讯云开发者</span></p><p class="cdc-footer__qr-info"><span class="cdc-footer__qr-text">领取腾讯云代金券</span></p></div></div></div><div class="cdc-footer__recommend"><div class="cdc-footer__recommend-rows"><div class="cdc-footer__recommend-cell"><h3 class="cdc-footer__recommend-title">热门产品</h3><div class="cdc-footer__recommend-wrap"><ul class="cdc-footer__recommend-list"><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://dnspod.cloud.tencent.com/?from=20064&amp;from_column=20064">域名注册</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/cvm?from=20064&amp;from_column=20064">云服务器</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/tbaas?from=20064&amp;from_column=20064">区块链服务</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/mq?from=20064&amp;from_column=20064">消息队列</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/dsa?from=20064&amp;from_column=20064">网络加速</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/tencentdb-catalog?from=20064&amp;from_column=20064">云数据库</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/cns?from=20064&amp;from_column=20064">域名解析</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/cos?from=20064&amp;from_column=20064">云存储</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/css?from=20064&amp;from_column=20064">视频直播</a></li></ul></div></div><div class="cdc-footer__recommend-cell"><h3 class="cdc-footer__recommend-title">热门推荐</h3><div class="cdc-footer__recommend-wrap"><ul class="cdc-footer__recommend-list"><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/facerecognition?from=20064&amp;from_column=20064">人脸识别</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/tm?from=20064&amp;from_column=20064">腾讯会议</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/act/pro/enterprise2019?from=20064&amp;from_column=20064">企业云</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/cdn-scd?from=20064&amp;from_column=20064">CDN加速</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/trtc?from=20064&amp;from_column=20064">视频通话</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/tiia?from=20064&amp;from_column=20064">图像分析</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/cdb?from=20064&amp;from_column=20064">MySQL 数据库</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/symantecssl?from=20064&amp;from_column=20064">SSL 证书</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/asr?from=20064&amp;from_column=20064">语音识别</a></li></ul></div></div><div class="cdc-footer__recommend-cell"><h3 class="cdc-footer__recommend-title">更多推荐</h3><div class="cdc-footer__recommend-wrap"><ul class="cdc-footer__recommend-list"><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/solution/data_protection?from=20064&amp;from_column=20064">数据安全</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/clb?from=20064&amp;from_column=20064">负载均衡</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/sms?from=20064&amp;from_column=20064">短信</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/ocr?from=20064&amp;from_column=20064">文字识别</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/vod?from=20064&amp;from_column=20064">云点播</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://tm.cloud.tencent.com/?from=20064&amp;from_column=20064">商标注册</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/solution/la?from=20064&amp;from_column=20064">小程序开发</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/cat?from=20064&amp;from_column=20064">网站监控</a></li><li class="cdc-footer__recommend-item"><a class="com-2-footer-recommend-link" href="https://cloud.tencent.com/product/cdm?from=20064&amp;from_column=20064">数据迁移</a></li></ul></div></div></div></div><div class="cdc-footer__copyright"><div class="cdc-footer__copyright-text"><p>Copyright © 2013 - 2023 Tencent Cloud. All Rights Reserved. 腾讯云 版权所有&nbsp;</p><p>深圳市腾讯计算机系统有限公司 ICP备案/许可证号：<a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank">粤B2-20090059&nbsp;</a><a href="https://www.beian.gov.cn/portal/index.do" target="_blank">深公网安备号 44030502008569</a></p><p>腾讯云计算（北京）有限责任公司 京ICP证150476号 | &nbsp;<a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank">京ICP备11018762号</a> | <a href="https://www.beian.gov.cn/portal/index.do" target="_blank">京公网安备号11010802020287</a></p></div></div></div></div><div style="display: none;"><a href="https://cloud.tencent.com/developer/ask/archives.html">问题归档</a><a href="https://cloud.tencent.com/developer/column/archives.html">专栏文章</a><a href="https://cloud.tencent.com/developer/news/archives.html">快讯文章归档</a><a href="https://cloud.tencent.com/developer/information/all.html">关键词归档</a><a href="https://cloud.tencent.com/developer/devdocs/archives.html">开发者手册归档</a><a href="https://cloud.tencent.com/developer/devdocs/sections_p1.html">开发者手册 Section 归档</a></div><div class="cdc-m-footer"><div class="cdc-m-footer__inner"><div class="cdc-m-footer__copyright"><p>Copyright © 2013 - 2023 Tencent Cloud.</p><p>All Rights Reserved. 腾讯云 版权所有</p></div></div></div><div class="cdc-operate-footer is-hidden"><div class="cdc-operate-footer__inner"><div class="cdc-operate-footer__toggle is-logout"><div class="cdc-operate-footer__toggle-text"><span>登录 </span>后参与评论</div></div><div class="cdc-operate-footer__operations"><div class="cdc-operate-footer__operate"><i class="cdc-operate-footer__operate-icon comment"></i></div><div class="cdc-operate-footer__operate like"><i class="cdc-operate-footer__operate-icon like"></i><span class="cdc-operate-footer__operate-text">4</span></div><div class="cdc-operate-footer__operate"><i class="cdc-operate-footer__operate-icon book"></i></div><div class="cdc-operate-footer__operate"><i class="cdc-operate-footer__operate-icon menu"></i></div><div class="cdc-operate-footer__operate"><i class="cdc-operate-footer__operate-icon more"></i></div></div></div></div><div class="cdc-suspend-pill"><div class="cdc-suspend-pill__inner"><button class="cdc-icon-btn cdc-suspend-pill__item like cdc-icon-btn--text"><span class="cdc-svg-icon-con"><span class="cdc-svg-icon" style="width: 24px; height: 24px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path d="M4 22C3.73736 22 3.47728 21.9483 3.23463 21.8478C2.99198 21.7472 2.7715 21.5999 2.58579 21.4142C2.40007 21.2285 2.25275 21.008 2.15224 20.7654C2.05173 20.5227 2 20.2626 2 20V12C2 11.7374 2.05173 11.4773 2.15224 11.2346C2.25275 10.992 2.40007 10.7715 2.58579 10.5858C2.7715 10.4001 2.99198 10.2527 3.23463 10.1522C3.47728 10.0517 3.73736 10 4 10H6L9 2H10C11.0609 2 12.0783 2.42143 12.8284 3.17157C13.5786 3.92172 14 4.93913 14 6V10H19.438C19.7419 10 20.0418 10.0693 20.3149 10.2026C20.588 10.3359 20.8272 10.5297 21.0142 10.7693C21.2012 11.0088 21.3312 11.2878 21.3942 11.5851C21.4572 11.8824 21.4517 12.1902 21.378 12.485L19.758 18.97C19.5416 19.8357 19.042 20.6042 18.3386 21.1532C17.6351 21.7022 16.7683 22.0003 15.876 22H4ZM6 12H4V20H6V12ZM10.386 4L8 10.363V20H15.877C16.323 19.9999 16.7562 19.8508 17.1077 19.5763C17.4592 19.3018 17.7088 18.9177 17.817 18.485L19.438 12H12V5.614C12 4.772 11.355 4.081 10.533 4.007L10.386 4Z"></path></svg></span></span><span class="cdc-suspend-pill__item-number">4</span></button><button class="cdc-icon-btn cdc-suspend-pill__item like cdc-icon-btn--text"><span class="cdc-svg-icon-con"><span class="cdc-svg-icon" style="width: 24px; height: 24px;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor"><path fill-rule="evenodd" clip-rule="evenodd" d="M17.5 11.25C17.5 11.9404 16.9404 12.5 16.25 12.5C15.5596 12.5 15 11.9404 15 11.25C15 10.5596 15.5596 10 16.25 10C16.9404 10 17.5 10.5596 17.5 11.25Z M12.25 12.5C12.9404 12.5 13.5 11.9404 13.5 11.25C13.5 10.5596 12.9404 10 12.25 10C11.5596 10 11 10.5596 11 11.25C11 11.9404 11.5596 12.5 12.25 12.5Z M8.25 12.5C8.94036 12.5 9.5 11.9404 9.5 11.25C9.5 10.5596 8.94036 10 8.25 10C7.55964 10 7 10.5596 7 11.25C7 11.9404 7.55964 12.5 8.25 12.5Z M5 3C3.34315 3 2 4.34315 2 6V16C2 17.6569 3.34315 19 5 19H8.34311L10.5858 21.2426C11.3668 22.0237 12.6331 22.0237 13.4142 21.2426L15.6568 19H19C20.6569 19 22 17.6569 22 16V6C22 4.34315 20.6569 3 19 3H5ZM4 6C4 5.44772 4.44772 5 5 5H19C19.5523 5 20 5.44772 20 6V16C20 16.5523 19.5523 17 19 17H14.8284L12 19.8284L9.17154 17H5C4.44772 17 4 16.5523 4 16V6Z"></path></svg></span></span><span class="cdc-suspend-pill__item-number">0</span></button><button class="cdc-icon-btn cdc-suspend-pill__item collect cdc-icon-btn--text"><span class="cdc-svg-icon-con"><span class="cdc-svg-icon" style="width: 24px; height: 24px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.2057 3.11487C10.9393 1.62838 13.059 1.62838 13.7927 3.11487L15.9724 7.53141L20.8463 8.23963C22.4867 8.478 23.1418 10.4939 21.9547 11.651L18.4279 15.0888L19.2605 19.9431C19.5407 21.5769 17.8258 22.8228 16.3586 22.0514L11.9992 19.7596L7.63981 22.0514C6.17255 22.8228 4.45769 21.5769 4.73791 19.9431L5.57048 15.0888L2.04366 11.651C0.856629 10.4939 1.51165 8.478 3.15209 8.23963L8.02603 7.53141L10.2057 3.11487ZM11.9992 4L9.8195 8.41654C9.52818 9.00683 8.96504 9.41597 8.31363 9.51062L3.43969 10.2188L6.9665 13.6566C7.43787 14.1161 7.65297 14.7781 7.5417 15.4269L6.70913 20.2812L11.0685 17.9893C11.6512 17.683 12.3472 17.683 12.9299 17.9893L17.2893 20.2812L16.4567 15.4269C16.3454 14.7781 16.5605 14.1161 17.0319 13.6566L20.5587 10.2188L15.6848 9.51062C15.0333 9.41597 14.4702 9.00683 14.1789 8.41654L11.9992 4Z"></path></svg></span></span><span class="cdc-suspend-pill__item-number">0</span></button><button class="cdc-icon-btn cdc-suspend-pill__item cdc-icon-btn--text"><span class="cdc-svg-icon-con"><span class="cdc-svg-icon" style="width: 24px; height: 24px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path d="M13.0001 4V6H17.5859L10.1787 13.4072L11.6043 14.81L19.0001 7.41424V12H21.0001V4H13.0001Z"></path><path d="M3 12.9996C3 8.71646 5.99202 5.13211 10 4.22266V6.28952C7.10851 7.15007 5 9.82862 5 12.9996C5 16.8656 8.13401 19.9996 12 19.9996C15.1709 19.9996 17.8494 17.8912 18.71 14.9999H20.7769C19.8674 19.0077 16.2831 21.9996 12 21.9996C7.02944 21.9996 3 17.9702 3 12.9996Z"></path></svg></span></span></button><button class="cdc-icon-btn cdc-suspend-pill__item cdc-icon-btn--text"><span class="cdc-svg-icon-con"><span class="cdc-svg-icon" style="width: 24px; height: 24px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 6C2 4.34315 3.34315 3 5 3H17C18.6569 3 20 4.34315 20 6V11H18V6C18 5.44772 17.5523 5 17 5H5C4.44772 5 4 5.44772 4 6V18C4 18.5523 4.44772 19 5 19H12V21H5C3.34315 21 2 19.6569 2 18V6ZM6 8H12V10H6V8ZM6 12H15V14H6V12ZM22 16H19V13H17V16H14V18H17V21H19V18H22V16Z"></path></svg></span></span></button><div class="cdc-suspend-pill__line"></div><button class="cdc-icon-btn cdc-suspend-pill__item cdc-icon-btn--text"><span class="cdc-svg-icon-con"><span class="cdc-svg-icon" style="width: 24px; height: 24px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path d="M16.5047 6H13V4H20V10.876H18V7.33313L14.4571 10.876L13.0429 9.46182L16.5047 6Z"></path><path d="M11 6.00006H7.4953L10.9571 9.46189L9.54291 10.8761L6 7.33319V10.8761H4V4.00006H11V6.00006Z"></path><path d="M7.4953 18.8761H11V20.8761H4V14.0001H6V17.543L9.54291 14.0001L10.9571 15.4143L7.4953 18.8761Z"></path><path d="M16.5047 18.8761H13V20.8761H20V14.0001H18V17.543L14.4571 14.0001L13.0429 15.4143L16.5047 18.8761Z"></path></svg></span></span></button><button class="cdc-icon-btn cdc-suspend-pill__item recommend cdc-icon-btn--text"><span class="cdc-svg-icon-con"><span class="cdc-svg-icon" style="width: 24px; height: 24px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path d="M5 8H10V10H5V8Z"></path><path d="M10 12H5V14H10V12Z"></path><path d="M14 8H19V10H14V8Z"></path><path d="M19 12H14V14H19V12Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M11 20.608L9.57047 20.1996C8.83303 19.9889 8.05701 19.9506 7.30243 20.0878L4.35777 20.6232C3.13009 20.8464 2 19.9033 2 18.6555V5.2669C2 4.2325 2.78877 3.36877 3.81893 3.27512L6.52892 3.02875C7.95704 2.89892 9.39058 3.21084 10.6356 3.9223L12 4.70194L13.3644 3.9223C14.6094 3.21084 16.043 2.89892 17.4711 3.02875L20.1811 3.27512C21.2112 3.36877 22 4.2325 22 5.2669V18.6555C22 19.9033 20.8699 20.8464 19.6422 20.6232L16.6976 20.0878C15.943 19.9506 15.167 19.9889 14.4295 20.1996L13 20.608L12.5 20.8535L12 20.8937L11.5 20.8535L11 20.608ZM6.70999 5.02054C7.73007 4.9278 8.75403 5.1506 9.64336 5.65879L11 6.43401V18.528L10.1199 18.2765C9.0875 17.9815 8.00107 17.928 6.94466 18.1201L4 18.6555V5.2669L6.70999 5.02054ZM13 18.528L13.8801 18.2765C14.9125 17.9815 15.9989 17.928 17.0553 18.1201L20 18.6555V5.2669L17.29 5.02054C16.2699 4.9278 15.246 5.1506 14.3566 5.65879L13 6.43401V18.528Z"></path></svg></span></span><span class="cdc-suspend-pill__item-text">推荐</span></button></div></div></div></div></div><script>
          if (!String.prototype.replaceAll) {
            String.prototype.replaceAll = function (str, newStr) {
              // If a regex pattern
              if (Object.prototype.toString.call(str).toLowerCase() === '[object regexp]') {
                return this.replace(str, newStr);
              }
        
              // If a string
              return this.replace(new RegExp(str, 'g'), newStr);
            };
          }
          </script><script src="./docker-compose_files/jquery.min.js"></script><script src="./docker-compose_files/api.js"></script><script src="./docker-compose_files/react.16.8.6.min.js"></script><script src="./docker-compose_files/TXLivePlayer-1.2.0.min.js" defer=""></script><script src="./docker-compose_files/hls.min.0.13.2m.js"></script><script src="./docker-compose_files/tcplayer.v4.1.min.js"></script><script id="__NEXT_DATA__" type="application/json">{"props":{"isMobile":false,"isSupportWebp":true,"reqId":"MpZmX7B9xuJbVGpclNQ5Y","query":{"from":"15425","articleId":"2233624"},"platform":"other","env":"production","__N_SSP":true,"pageProps":{"fallback":{"#url:\"/api/article/detail\",params:#articleId:2233624,,":{"articleData":{"articleId":2233624,"wordsNum":7455,"codeLineNum":312,"readingTime":1627},"articleInfo":{"articleId":2233624,"channel":4,"columnId":73784,"commentNum":0,"content":{"blocks":[{"key":"b7icf","text":"本篇文章，我们聊聊如何使用 Docker 快速运行中文 Stable Diffusion 模型：太乙。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2rs84","text":"写在前面","type":"header-two","depth":0,"inlineStyleRanges":[{"offset":0,"length":4,"style":"BOLD"}],"entityRanges":[],"data":{"text":"%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"}},{"key":"87rde","text":"上个月的时候，有朋友和我推荐了一个 “Stable Diffusion” 模型，来自深圳大湾区数字经济研究院(IDEA)[1]的封神榜大模型[2]中的 “太乙” 。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":42,"length":21,"style":"BOLD"},{"offset":64,"length":9,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"8m4lv","text":"\ud83d","type":"atomic","depth":0,"inlineStyleRanges":[],"entityRanges":[{"offset":0,"length":1,"key":0}],"data":{}},{"key":"ujfa","text":"AI 生成 “醉里不知天在水，满船清梦压星河”","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"3j5j9","text":"最近想起来，想本地运行试试看，根据官方开源仓库的指引[3]和 Issue 里的记录[4]，发现如果用官方提供的容器镜像跑“太乙”，这个项目根本跑不起来。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":21,"length":8,"style":"BOLD"},{"offset":31,"length":13,"style":"BOLD"},{"offset":47,"length":28,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"fhgch","text":"于是，花了一些时间，封装了一个可以一键运行、开箱即用的模型镜像。完整代码开源在 github.com/soulteary/docker-stable-diffusion-taiyi[5]，有需要的同学自取。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":40,"length":53,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"5isk1","text":"这篇文章，我将记录下来折腾过程，希望能帮助到有相同需求，想要快速运行这个模型，找乐子的同学。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"9f7co","text":"当然，也希望这篇文章，能够帮到将模型开源开放出来的 IDEA 研究院的开发团队的同学，改进当前开源项目中的不足之处，让中文开源项目越来越好。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"205mf","text":"快速上手","type":"header-two","depth":0,"inlineStyleRanges":[{"offset":0,"length":4,"style":"BOLD"}],"entityRanges":[],"data":{"text":"%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"}},{"key":"1vm53","text":"如果你本地已经准备好了运行 Docker 的环境，并且有一张显存在 4G 到 8G 之间的显卡，可以尝试使用下面这个镜像，镜像尺寸为 8GB （ 如果你手头没有显卡，也不想使用云主机，那么可以等等后续不需要 GPU 的“模型把玩”文章，或者翻阅之前有关模型的文章 :D ）","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":14,"length":6,"style":"CODE"},{"offset":92,"length":25,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"71pn2","text":"docker pull soulteary/stable-diffusion:taiyi-0.1","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"b2787","text":"想运行“太乙”，除了需要下载“模型游乐场”镜像之外，我们还需要获取“太乙模型”文件：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"311dp","text":"git clone https://huggingface.co/IDEA-CCNL/Taiyi-Stable-Diffusion-1B-Chinese-v0.1","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"7of13","text":"整个仓库尺寸比较大（大概有 18GB），需要花费一些时间：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"ahggf","text":"Cloning into 'Taiyi-Stable-Diffusion-1B-Chinese-v0.1'...\nremote: Enumerating objects: 157, done.\nremote: Counting objects: 100% (157/157), done.\nremote: Compressing objects: 100% (155/155), done.\nremote: Total 157 (delta 77), reused 0 (delta 0), pack-reused 0\nReceiving objects: 100% (157/157), 3.06 MiB | 22.25 MiB/s, done.\nResolving deltas: 100% (77/77), done.\nFiltering content: 100% (5/5), 8.92 GiB | 11.48 MiB/s, done.","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"ba5bg","text":"原始项目启用了 git lfs，所以添加不添加 --depth 参数没有差别，耐心等待模型下载完毕之后，我们编写一个容器编排文件，来启动模型应用：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":8,"length":7,"style":"CODE"},{"offset":24,"length":7,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"deph9","text":"version: \"2\"\nservices:\n\n  taiyi:\n    image: soulteary/stable-diffusion:taiyi-0.1\n    container_name: taiyi\n    restart: always\n    runtime: nvidia\n    ipc: host\n    ports:\n      - \"7860:7860\"\n    volumes:\n      - ./Taiyi-Stable-Diffusion-1B-Chinese-v0.1:/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"f710l","text":"将上面的内容保存为 docker-compose.yml 之后，执行 docker compose up -d，稍等片刻，在浏览器访问启动服务的 IP 地址和对应端口，比如：http://localhost:7860，就能够正常使用啦。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":10,"length":18,"style":"CODE"},{"offset":35,"length":20,"style":"CODE"},{"offset":87,"length":21,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"f9orn","text":"\ud83d","type":"atomic","depth":0,"inlineStyleRanges":[],"entityRanges":[{"offset":0,"length":1,"key":1}],"data":{}},{"key":"4cs58","text":"支持太乙模型的 Stable Diffusion Web 控制台","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"27lot","text":"模型运行起来，当然是要玩一把了，我使用博客首页的古诗“醉里不知天在水，满船清梦压星河”为主题，尝试生成了一张图，看起来效果还不错：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"57qbs","text":"\ud83d","type":"atomic","depth":0,"inlineStyleRanges":[],"entityRanges":[{"offset":0,"length":1,"key":2}],"data":{}},{"key":"f6mj7","text":"干净透明、详尽的构建日志","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"9odhk","text":"想要快速上手中文 Stable Diffusion 模型的同学，看到这里就可以啦。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"cr33d","text":"如果你想了解如何从零开始配置 GPU 云服务器环境，或者想了解这个 Stable Diffusion 容器运行环境是如何构建的，可以继续阅读。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"bsfu","text":"那么，聊聊如何将“太乙”正确的放进容器里。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"cigfq","text":"如何将“太乙”正确的放进容器","type":"header-two","depth":0,"inlineStyleRanges":[{"offset":0,"length":14,"style":"BOLD"}],"entityRanges":[],"data":{"text":"%E5%A6%82%E4%BD%95%E5%B0%86%E2%80%9C%E5%A4%AA%E4%B9%99%E2%80%9D%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%94%BE%E8%BF%9B%E5%AE%B9%E5%99%A8"}},{"key":"4gh7f","text":"既然提到了正确 ，我们首先要看看官方的镜像都包含哪些问题。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":5,"length":2,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"dbdte","text":"分析太乙官方镜像和应用项目存在的问题","type":"header-three","depth":0,"inlineStyleRanges":[{"offset":0,"length":18,"style":"BOLD"}],"entityRanges":[],"data":{"text":"%E5%88%86%E6%9E%90%E5%A4%AA%E4%B9%99%E5%AE%98%E6%96%B9%E9%95%9C%E5%83%8F%E5%92%8C%E5%BA%94%E7%94%A8%E9%A1%B9%E7%9B%AE%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"}},{"key":"3050n","text":"\ud83d","type":"atomic","depth":0,"inlineStyleRanges":[],"entityRanges":[{"offset":0,"length":1,"key":3}],"data":{}},{"key":"6o8v1","text":"太乙官方提供的模型","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"6jd24","text":"官方团队并未在仓库中添加容器镜像的编排文件，起初我认为是上线匆忙忘记了，但是随着我翻开 DockerHub 的提交记录时，发现原来这个镜像的构建方式是基于传统的 docker commit 构建的[6]，这样的镜像存在两个问题，首先是黑盒不透明，拿 Docker 当虚拟机用，不利于二次开发和维护；其次，这最后一次提交，单个提交的变动包含 5个GB ，里面是否无心夹带了不该存在的内容，对于想私有化部署的场景下，也着实是有些让人难以放心。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":81,"length":13,"style":"CODE"},{"offset":95,"length":6,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"auvbj","text":"\ud83d","type":"atomic","depth":0,"inlineStyleRanges":[],"entityRanges":[{"offset":0,"length":1,"key":4}],"data":{}},{"key":"906de","text":"官方镜像的“黑盒子”","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"31oi2","text":"其次，用户如果想在干净完整复现，就只能参考镜像中的“历史操作记录”啦，然而，并不是所有的命令都是能被系统记录下来的，比如 vim 等交互式操作，或者非幂等的操作，用户实际上也无法再次复现。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":61,"length":3,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"duonu","text":"我们使用 docker run --rm -it fengshenbang/pytorch:1.10-cuda11.1-cudann8-devel bash 启动一个太乙官方团队，三个月前制作的镜像的 Docker 容器。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":5,"length":73,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"5qluj","text":"输入 history，能够看到开发同学启动容器之后，又噼里啪啦的搞了“一堆事情”：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":3,"length":7,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"3e6r9","text":"1  python\n2  git clone https://github.com/IDEA-CCNL/Fengshenbang-LM.git\n3  cd Fengshenbang-LM/\n4  ls\n5  vim fengshen/requirement.txt \n6  pip install --editable fengshen\n7  pip install --editable .\n8  pip install --update pillow\n9  pip install --upgrade pillow\n10  nvcc --version\n11  where nvcc\n12  which nvcc\n13  pip install torch==1.10.0+cu111 torchvision==0.11.0+cu111 torchaudio==0.10.0 -f https://download.pytorch.org/whl/torch_stable.html\n14  pip install --upgrade packaging --use-feature=2020-resolver\n15  pip install --upgrade PyYAML --use-feature=2020-resolver\n16  pip install --upgrade PyYAML --use-feature=2020-resolver --ignore-installed\n17  pip install --upgrade tqdm --use-feature=2020-resolver\n18  pip uninstall pip install torchtext\n19  pip uninstall torchtext\n20  pip install torchtext\n21  pip uninstall torchtext\n22  pip install torchtext==0.10.0\n23  python\n24  pip install torchtext==0.11.0\n25  cd fengshen\n26  ls\n27  cd examples/\n28  cd pretrain_erlangshen_deberta_v2/\n29  ls\n30  vim pretrain_deberta_base.sh \n31  sh pretrain_deberta_base.sh \n32  git submodule init\n33  git submodule update\n34  cd ..\n35  cd data/fs_datasets/\n36  ls\n37  ll\n38  cd ..\n39  git submodule init\n40  git submodule update\n41  cd data/fs_datasets/\n42  cd ..\n43  vim .gitmodules \n44  git submodule update\n45  git submodule init\n46  git submodule update\n47  vim .gitmodules \n48  git submodule --help\n49  git submodule\n50  git submodule init\n51  git submodule\n52  git submodule update --init\n53  vim .git/config \n54  git submodule init\n55  git submodule update\n56  cd fengshen/examples/\n57  ls\n58  cd pretrain_erlangshen_deberta_v2/\n59  sh pretrain_deberta_base.sh \n60  vim pretrain_deberta_base.sh \n61  sh pretrain_deberta_base.sh \n62  cd ..\n63  cd Fengshenbang-LM/\n64  git status\n65  rm -rf fengshen/workspace/torch_extendsions\n66  rm fengshen/workspace/erlangshen-deberta-base/lightning_logs/\n67  rm fengshen/workspace/erlangshen-deberta-base/lightning_logs -rf\n68  rm fengshen/workspace/erlangshen-deberta-base/ckpt -rf\n69  cd ..\n70  exit","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"2eebm","text":"上面的命令中，主要做了几件事：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"fiofu","text":"1.调整和配置 Python 应用所需要 Pytorch 基础运行环境，经历了多次失败和重试。2.手动安装项目运行所需要的某几个软件包，也是经历了翻来覆去的重试。3.或许，开发同学不太习惯使用 git submodule，为了让项目程序文件完整，也是折腾来折腾去。4.在提供给用户的镜像里进行了 pretrain_erlangshen_deberta_v2 的预训练，结束后或许是想保持干净的环境，删除掉了日志和模型文件。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":97,"length":13,"style":"CODE"},{"offset":148,"length":30,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"7nqa8","text":"然而，这些三个月前的操作，对于我们想正确运行太乙的模型和界面程序，非但没有正确指引，反而存在“误导”：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"36trl","text":"1.PyTorch 版本低，运行程序会因为程序使用了新版本（1.13+）版本才存在的数据类型而无法运行。2.历史操作中反复安装的 torchtext 将阻止我们安装到正确的 PyTorch，进一步阻碍程序在容器内正确运行。3.除此之外，官方项目使用的 submodule 中的引用地址为：git@github.com:IDEA-CCNL/fs_datasets.git，在容器默认环境下是无法完成通过 git 进行下载的。4.最后，官方在项目中推荐的方式是启动 Docker 容器作为虚拟机，然后 docker exec -it fengshen bash 进去之后，使用 git pull \u0026\u0026 git submodule ... 来强制更新代码，这样容易出现代码和模型版本不匹配，代码和依赖组件不匹配，和基础环境软件不兼容的情况下，软件无法运行的情况。并且，这样做其实在一些情况下，是无法更新 submodule 中的程序文件的。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":65,"length":9,"style":"CODE"},{"offset":126,"length":9,"style":"CODE"},{"offset":144,"length":40,"style":"CODE"},{"offset":201,"length":3,"style":"CODE"},{"offset":249,"length":29,"style":"CODE"},{"offset":287,"length":29,"style":"CODE"},{"offset":399,"length":9,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"40p14","text":"除了基础镜像的问题之外，官方 fork 改版的 stable-diffusion-webui Web UI 项目[7]也隐藏了一些问题。虽然，其中不少问题都是从原版程序“继承”过来的。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":15,"length":4,"style":"CODE"},{"offset":24,"length":22,"style":"CODE"},{"offset":47,"length":12,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"83rr9","text":"首先，项目所需要的依赖，并不是完全都包含在项目的依赖声明文件中；并且，项目中存在俩 requirements.txt 文件，其中都包含了未指定明确版本的软件包。可能官方开发团队想缓解这个问题，于是编写了一个名为 launch.py 的启动文件，在执行程序之后，程序会自动调用 prepare_enviroment() 函数，包含了“近似”所有所需 Python 软件包依赖的安装，以及关联项目的下载。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":42,"length":16,"style":"CODE"},{"offset":106,"length":9,"style":"CODE"},{"offset":138,"length":20,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"csb5o","text":"在这个文件中，我们会发现目前版本的程序想正确运行起来，实际需要的基础运行环境是：torch==1.12.1+cu113 torchvision==0.13.1+cu113，好吧，如果你没有仔细阅读过这个 launch.py，那么官方镜像提供的默认环境将浪费不少想让程序运行起来，花费的调试时间。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":40,"length":45,"style":"CODE"},{"offset":102,"length":9,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"c5jnv","text":"我们也能够在这个文件中发现大量直接调用 subprocess.run 执行的安装命令。因为项目中没有明确的版本声明，所以当程序下载完 gfpgan、clip、xformers、deepdanbooru、pyngrok、Stable Diffusion、Taming Transformer、K-diffusion、CodeFormer、BLIP 后，一通安装后，再进行安装 web ui 本身的依赖，很容易造成程序因为版本兼容性存在问题，而无法运行，或者运行出错的问题，对其他人提供公开代码，或者下载的软件，使用显式声明是好习惯。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":20,"length":14,"style":"CODE"},{"offset":67,"length":6,"style":"CODE"},{"offset":74,"length":4,"style":"CODE"},{"offset":79,"length":8,"style":"CODE"},{"offset":88,"length":12,"style":"CODE"},{"offset":101,"length":7,"style":"CODE"},{"offset":109,"length":16,"style":"CODE"},{"offset":126,"length":18,"style":"CODE"},{"offset":145,"length":11,"style":"CODE"},{"offset":157,"length":10,"style":"CODE"},{"offset":168,"length":4,"style":"CODE"},{"offset":187,"length":6,"style":"CODE"},{"offset":235,"length":29,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"djnej","text":"在上面的依赖安装中，还存在两个问题。第一个是来自 Facebook Research 的 xformers，如果想要在 GPU 环境正确安装，安装指令需要调整。推测这里测试的同学，偷懒没有验证 GPU 环境从零到一的安装验证。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"bg7o3","text":"其二，pyngrok 这个包，虽然目前还没有在项目中被公开使用，但是就伴随程序的“自动初始化”悄然无声的安装到用户电脑上，其实不见得是一件合适的事情。太乙团队的镜像里暂时并未发现 ngrok 的执行程序，但是如果其他人再分发的过程中，虽然不改动原始代码，但是在程序中夹带了 ngrok，配合不严格的安全策略，对于用户而言，潜在的数据安全风险还是蛮高的。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":3,"length":7,"style":"CODE"},{"offset":90,"length":5,"style":"CODE"},{"offset":137,"length":5,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"7bb7o","text":"解决被官方忽视的 AI 容器应用问题","type":"header-three","depth":0,"inlineStyleRanges":[{"offset":0,"length":18,"style":"BOLD"}],"entityRanges":[],"data":{"text":"%E8%A7%A3%E5%86%B3%E8%A2%AB%E5%AE%98%E6%96%B9%E5%BF%BD%E8%A7%86%E7%9A%84-AI-%E5%AE%B9%E5%99%A8%E5%BA%94%E7%94%A8%E9%97%AE%E9%A2%98"}},{"key":"fe5ii","text":"太乙官方团队之前选择的基础镜像是 pytorch:1.10-cuda11.1-cudann8-devel。结合上面的分析，我们不难知道两点：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":17,"length":35,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"7bujp","text":"1.第一，我们需要更新 cuda 版本到 11.3.1。2.第二，我们有对 PyTorch “生态” 依赖进行安装更新的需要，使用预置 PyTorch 的镜像意义不大。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"f4a84","text":"所以，这里我选择使用 nvidia/cuda:11.3.1-devel-ubuntu18.04 作为基础镜像，搭配 miniconda 完成经过验证的 PyTorch “生态”软件版本的安装，搞定程序的基础“运行时”。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":11,"length":36,"style":"CODE"},{"offset":58,"length":9,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"8ci6k","text":"如果你需要寻找其他版本的镜像，可以在 DockerHub 的这个页面搜索[8]，另外，如果你需要判断 PyTorch 版本所需要的 CUDA 版本，可以在 PyTorch 官方发布页面中寻找线索：https://pytorch.org/get-started/previous-versions/。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":19,"length":20,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"55pi8","text":"FROM nvidia/cuda:11.3.1-devel-ubuntu18.04\n\nENV PATH=\"/root/miniconda3/bin:${PATH}\"\nRUN apt-get update\nRUN apt-get install -y wget \u0026\u0026 rm -rf /var/lib/apt/lists/*\n\nRUN wget \\\n    https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh \\\n    \u0026\u0026 mkdir /root/.conda \\\n    \u0026\u0026 bash Miniconda3-latest-Linux-x86_64.sh -b \\\n    \u0026\u0026 rm -f Miniconda3-latest-Linux-x86_64.sh\n\nRUN conda install pytorch==1.12.1 torchvision==0.13.1 torchaudio==0.12.1 cudatoolkit=11.3 -c pytorch -y ","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"dkfdk","text":"然后，我们开始翻译 launch.py 程序中关于软件的依赖下载和安装命令，先处理基础软件依赖（不进行 pyngrok 的安装）：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":10,"length":9,"style":"CODE"},{"offset":52,"length":7,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"f9pbc","text":"# WebUI\nRUN pip install transformers==4.19.2 diffusers==0.3.0 basicsr==1.4.2 gfpgan==1.3.8 gradio==3.8 numpy==1.23.3 Pillow==9.2.0 realesrgan==0.3.0 torch omegaconf==2.2.3 pytorch_lightning==1.7.6 scikit-image==0.19.2 fonts font-roboto timm==0.6.7 fairscale==0.4.9 piexif==1.1.3 einops==0.4.1 jsonmerge==1.8.0 clean-fid==0.1.29 resize-right==0.0.2 torchdiffeq==0.2.3 kornia==0.6.7 lark==1.1.2 inflection==0.5.1 GitPython==3.1.27\n# Etc...\nRUN apt-get update \u0026\u0026 apt-get install -y git\nRUN pip install \"git+https://github.com/TencentARC/GFPGAN.git@8d2447a2d918f8eba5a4a01463fd48e45126a379\"\nRUN pip install \"git+https://github.com/openai/CLIP.git@d50d76daa670286dd6cacf3bcd80b5e4823fc8e1\"\n\nRUN pip install \"git+https://github.com/KichangKim/DeepDanbooru.git@d91a2963bf87c6a770d74894667e9ffa9f6de7ff#egg=deepdanbooru\" \u0026\u0026 \\\n    pip install tensorflow==2.10.0 tensorflow-io==0.27.0\n\nRUN pip install ninja \u0026\u0026 \\\n    pip install -v -U \"git+https://github.com/facebookresearch/xformers.git@main#egg=xformers\"","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"ck1cp","text":"接着，我们来处理程序运行所需要的三方开源仓库这类组件依赖，按照官方 Web UI 所需要的 git hash 版本将它们下载下来：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":46,"length":8,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"bllc7","text":"RUN git clone \"https://github.com/CompVis/stable-diffusion.git\" \"stable-diffusion\" \u0026\u0026 \\\n    cd \"stable-diffusion\" \u0026\u0026 \\\n    git checkout \"69ae4b35e0a0f6ee1af8bb9a5d0016ccb27e36dc\"\n\nRUN git clone \"https://github.com/CompVis/taming-transformers.git\" \"taming-transformers\" \u0026\u0026 \\\n    cd \"taming-transformers\" \u0026\u0026 \\\n    git checkout \"24268930bf1dce879235a7fddd0b2355b84d7ea6\"\n\nRUN git clone \"https://github.com/crowsonkb/k-diffusion.git\" \"k-diffusion\" \u0026\u0026 \\\n    cd \"k-diffusion\" \u0026\u0026 \\\n    git checkout \"60e5042ca0da89c14d1dd59d73883280f8fce991\"\n\nRUN git clone \"https://github.com/sczhou/CodeFormer.git\" \"CodeFormer\" \u0026\u0026 \\\n    cd \"CodeFormer\" \u0026\u0026 \\\n    git checkout \"c5b4593074ba6214284d6acd5f1719b6c5d739af\"\n\nRUN git clone \"https://github.com/salesforce/BLIP.git\" \"BLIP\" \u0026\u0026 \\\n    cd \"BLIP\" \u0026\u0026 \\\n    git checkout \"48211a1594f1321b00f14c9f7a5b4813144b2fb9\"\n\nRUN cd \"CodeFormer\" \u0026\u0026 \\\n    pip install -r requirements.txt","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"2sl2c","text":"然后，我们来处理太乙专属的 Web UI 这部分的程序，为了让镜像能够稳定构建、稳定运行，我们对 IDEA-CCNL/stable-diffusion-webui 也进行“版本的显式定义”：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":14,"length":6,"style":"CODE"},{"offset":49,"length":32,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"cc99g","text":"RUN git clone https://github.com/IDEA-CCNL/stable-diffusion-webui.git \u0026\u0026 \\\n    cd \"stable-diffusion-webui\" \u0026\u0026 \\\n    git checkout \"b31fc195a6d56a36b4abe1f6e36890211a78e844\"\n\nRUN mv \"stable-diffusion\" stable-diffusion-webui/repositories/ \u0026\u0026 \\\n    mv \"taming-transformers\" stable-diffusion-webui/repositories/ \u0026\u0026 \\\n    mv \"k-diffusion\" stable-diffusion-webui/repositories/ \u0026\u0026 \\\n    mv \"CodeFormer\" stable-diffusion-webui/repositories/ \u0026\u0026 \\\n    mv \"BLIP\" stable-diffusion-webui/repositories/","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"777dh","text":"接下来，对官方团队准备好的配置文件进行调整，为了方便容器使用，我们将把太乙的模型文件放在 Web UI 的 stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/ 目录中：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":45,"length":6,"style":"CODE"},{"offset":54,"length":69,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"74pph","text":"RUN cd stable-diffusion-webui/repositories/ \u0026\u0026 \\\n    cp \"stable-diffusion-taiyi/configs/stable-diffusion/v1-inference.yaml\" \"stable-diffusion/configs/stable-diffusion/v1-inference.yaml\" \u0026\u0026 \\\n    cp \"stable-diffusion-taiyi/ldm/modules/encoders/modules.py\" \"stable-diffusion/ldm/modules/encoders/modules.py\" \u0026\u0026 \\\n    sed -ie s#your_path/Taiyi-Stable-Diffusion-1B-Chinese-v0.1#/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/# \"stable-diffusion/configs/stable-diffusion/v1-inference.yaml\"","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"fvbj3","text":"设置程序运行工作目录，以及启动参数：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"596jr","text":"WORKDIR stable-diffusion-webui\nCMD [\"python\", \"webui.py\", \"--ckpt\", \"/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/Taiyi-Stable-Diffusion-1B-Chinese-v0.1.ckpt\", \"--listen\"]","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"8t5lu","text":"最后，将上面的内容保存为 Dockerfile，执行 docker build -t soulteary/stable-diffusion:taiyi-0.1 . ，耐心等待镜像构建完毕就好啦。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":13,"length":10,"style":"CODE"},{"offset":27,"length":54,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"9l8qk","text":"我们使用 docker images 查看镜像尺寸：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":5,"length":13,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"9l5o","text":"REPOSITORY                   TAG         IMAGE ID       CREATED        SIZE\nsoulteary/stable-diffusion   taiyi-0.1   359b67ba7c2f   5 hours ago    17.4GB","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"dm15m","text":"发现虽然比官方镜像解压缩后的 22.5GB 小，但是还是有些大，那么，接下来，我们来进行简单优化。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"59en7","text":"如果你想了解极限的“硬核优化”，可以参考《使用 Docker 和 HuggingFace 实现 NLP 文本情感分析应用》[9]或者往期大文章，在此就不赘述啦 :D","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":20,"length":44,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"atgac","text":"进一步优化 AI 应用的镜像尺寸","type":"header-three","depth":0,"inlineStyleRanges":[{"offset":0,"length":16,"style":"BOLD"}],"entityRanges":[],"data":{"text":"%E8%BF%9B%E4%B8%80%E6%AD%A5%E4%BC%98%E5%8C%96-AI-%E5%BA%94%E7%94%A8%E7%9A%84%E9%95%9C%E5%83%8F%E5%B0%BA%E5%AF%B8"}},{"key":"6l09j","text":"因为时间关系，我就先不折腾多阶段构建，以及定向的压缩实现啦，我们针对上面的镜像编排指令进行合并，再每个阶段去掉不必要的文件，很容易得到类似下面的，紧凑一些的 Dockerfile：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":79,"length":10,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"db26i","text":"FROM nvidia/cuda:11.3.1-devel-ubuntu18.04\nLABEL org.opencontainers.image.authors=\"soulteary@gmail.com\"\nENV PATH=\"/root/miniconda3/bin:${PATH}\"\nRUN apt-get update \u0026\u0026 \\\n    apt-get install -y wget git ffmpeg libsm6 libxext6 \u0026\u0026 \\\n    rm -rf /var/lib/apt/lists/* \u0026\u0026 \\\n    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh \u0026\u0026 \\\n    mkdir /root/.conda \u0026\u0026 \\\n    bash Miniconda3-latest-Linux-x86_64.sh -b \u0026\u0026 \\\n    rm -f Miniconda3-latest-Linux-x86_64.sh \n# Basic environment (PyApp \u0026 WebUI)\nRUN conda install pytorch==1.12.1 torchvision==0.13.1 torchaudio==0.12.1 cudatoolkit=11.3 -c pytorch -y \u0026\u0026 \\\n    pip install transformers==4.19.2 diffusers==0.3.0 basicsr==1.4.2 gfpgan==1.3.8 gradio==3.8 numpy==1.23.3 Pillow==9.2.0 realesrgan==0.3.0 torch omegaconf==2.2.3 pytorch_lightning==1.7.6 scikit-image==0.19.2 fonts font-roboto timm==0.6.7 fairscale==0.4.9 piexif==1.1.3 einops==0.4.1 jsonmerge==1.8.0 clean-fid==0.1.29 resize-right==0.0.2 torchdiffeq==0.2.3 kornia==0.6.7 lark==1.1.2 inflection==0.5.1 GitPython==3.1.27 \u0026\u0026 \\\n    pip install \"git+https://github.com/TencentARC/GFPGAN.git@8d2447a2d918f8eba5a4a01463fd48e45126a379\" \u0026\u0026 \\\n    pip install \"git+https://github.com/openai/CLIP.git@d50d76daa670286dd6cacf3bcd80b5e4823fc8e1\" \u0026\u0026 \\\n    pip install \"git+https://github.com/KichangKim/DeepDanbooru.git@d91a2963bf87c6a770d74894667e9ffa9f6de7ff#egg=deepdanbooru\" \u0026\u0026 \\\n    pip install tensorflow==2.10.0 tensorflow-io==0.27.0 \u0026\u0026 \\\n    pip install ninja \u0026\u0026 \\\n    pip install -v -U \"git+https://github.com/facebookresearch/xformers.git@main#egg=xformers\" \u0026\u0026 \\\n    pip cache purge\n# Components\nRUN git clone \"https://github.com/CompVis/stable-diffusion.git\" \"stable-diffusion\" \u0026\u0026 \\\n    cd \"stable-diffusion\" \u0026\u0026 \\\n    git checkout \"69ae4b35e0a0f6ee1af8bb9a5d0016ccb27e36dc\" \u0026\u0026 rm -rf .git\nRUN git clone \"https://github.com/CompVis/taming-transformers.git\" \"taming-transformers\" \u0026\u0026 \\\n    cd \"taming-transformers\" \u0026\u0026 \\\n    git checkout \"24268930bf1dce879235a7fddd0b2355b84d7ea6\" \u0026\u0026 rm -rf .git\nRUN git clone \"https://github.com/crowsonkb/k-diffusion.git\" \"k-diffusion\" \u0026\u0026 \\\n    cd \"k-diffusion\" \u0026\u0026 \\\n    git checkout \"60e5042ca0da89c14d1dd59d73883280f8fce991\" \u0026\u0026 rm -rf .git\nRUN git clone \"https://github.com/sczhou/CodeFormer.git\" \"CodeFormer\" \u0026\u0026 \\\n    cd \"CodeFormer\" \u0026\u0026 \\\n    git checkout \"c5b4593074ba6214284d6acd5f1719b6c5d739af\" \u0026\u0026 rm -rf .git \u0026\u0026 \\\n    pip install -r requirements.txt \u0026\u0026 pip cache purge\nRUN git clone \"https://github.com/salesforce/BLIP.git\" \"BLIP\" \u0026\u0026 \\\n    cd \"BLIP\" \u0026\u0026 \\\n    git checkout \"48211a1594f1321b00f14c9f7a5b4813144b2fb9\" \u0026\u0026 rm -rf .git\nRUN git clone \"https://github.com/IDEA-CCNL/stable-diffusion-webui.git\" \"stable-diffusion-webui\" \u0026\u0026 \\\n    cd \"stable-diffusion-webui\" \u0026\u0026 \\\n    git checkout \"b31fc195a6d56a36b4abe1f6e36890211a78e844\" \u0026\u0026 rm -rf .git \u0026\u0026 \\\n    cd ../ \u0026\u0026 \\\n    mv \"stable-diffusion\" \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    mv \"taming-transformers\" \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    mv \"k-diffusion\" \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    mv \"CodeFormer\" \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    mv \"BLIP\" \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    cd \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    cp \"stable-diffusion-taiyi/configs/stable-diffusion/v1-inference.yaml\" \"stable-diffusion/configs/stable-diffusion/v1-inference.yaml\" \u0026\u0026 \\\n    cp \"stable-diffusion-taiyi/ldm/modules/encoders/modules.py\" \"stable-diffusion/ldm/modules/encoders/modules.py\" \u0026\u0026 \\\n    sed -ie s#your_path/Taiyi-Stable-Diffusion-1B-Chinese-v0.1#/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/# \"stable-diffusion/configs/stable-diffusion/v1-inference.yaml\"\nWORKDIR stable-diffusion-webui\nCMD [\"python\", \"webui.py\", \"--ckpt\", \"/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/Taiyi-Stable-Diffusion-1B-Chinese-v0.1.ckpt\", \"--listen\"]","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"b68t2","text":"再次执行 docker build -t soulteary/stable-diffusion:taiyi-0.1 . 进行镜像的构建，构建完毕后，再一次使用 docker images 查看镜像尺寸，发现尺寸立减 2GB，相比官方镜像小了 6GB+：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":5,"length":54,"style":"CODE"},{"offset":80,"length":13,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"5me9k","text":"REPOSITORY                   TAG         IMAGE ID       CREATED        SIZE\nsoulteary/stable-diffusion   taiyi-0.1   0e1c48709672   2 hours ago    15.4GB","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"46e9h","text":"将镜像推送到 DockerHub 上，经过平台的压缩，镜像传输尺比官方压缩后的镜像“轻” 2GB：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2q0u4","text":"\ud83d","type":"atomic","depth":0,"inlineStyleRanges":[],"entityRanges":[{"offset":0,"length":1,"key":5}],"data":{}},{"key":"4q0je","text":"从新构建的太乙模型镜像","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"fib5p","text":"并且，镜像构建细节中，每一步做了什么，构建的层多大，都清清楚楚的展示在了 DockerHub 的镜像详情页中，“干净又卫生”。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"9r4q2","text":"\ud83d","type":"atomic","depth":0,"inlineStyleRanges":[],"entityRanges":[{"offset":0,"length":1,"key":6}],"data":{}},{"key":"fh5gb","text":"干净透明、详尽的构建日志","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"5p0c2","text":"GPU 云主机环境的配置","type":"header-two","depth":0,"inlineStyleRanges":[{"offset":0,"length":12,"style":"BOLD"}],"entityRanges":[],"data":{"text":"GPU-%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%8E%AF%E5%A2%83%E7%9A%84%E9%85%8D%E7%BD%AE"}},{"key":"1hfm5","text":"想要简单、丝滑的在云服务器上运行 Python AI 应用，有一些前置工作要做。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2faeu","text":"Docker 基础环境的安装","type":"header-three","depth":0,"inlineStyleRanges":[{"offset":0,"length":14,"style":"BOLD"}],"entityRanges":[],"data":{"text":"Docker-%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E7%9A%84%E5%AE%89%E8%A3%85"}},{"key":"b578l","text":"我们在云环境默认创建的 GPU 服务器，可能环境有这样或者那样的小问题，为了避免时间浪费在琐碎问题上，我们可以考虑用 Docker 所提供的“固定 \u0026 明确的运行环境”来节约时间。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"57iij","text":"想要运行 Docker 首先要完成 Docker 的安装，在《在笔记本上搭建高性价比的 Linux 学习环境：基础篇》[10]一文的“更简单的 Docker 安装”小节中，我提到过如何快速、正确的在 Ubuntu 环境完成 Docker 的安装，这里就不做展开了，有需要的同学可以自行翻阅。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":30,"length":33,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"1qm1l","text":"如果，我们想在 Docker 中调用 Nvidia 显卡，光是完成 Docker 安装，还是不够的，还有一些事情要做。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"6a8eo","text":"完善 Nvidia 显卡驱动安装","type":"header-three","depth":0,"inlineStyleRanges":[{"offset":0,"length":16,"style":"BOLD"}],"entityRanges":[],"data":{"text":"%E5%AE%8C%E5%96%84-Nvidia-%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8%E5%AE%89%E8%A3%85"}},{"key":"3rpci","text":"我们需要先信任 Nvidia 的 GPG Key，然后才能安装来自 Nvidia 的开源软件。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"3phd2","text":"curl -fsSL https://nvidia.github.io/nvidia-container-runtime/gpgkey | sudo gpg --dearmor -o /etc/apt/keyrings/nvidia-container-runtime.gpg","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"7r4tk","text":"接着，需要更新系统中的软件源列表，添加 NVIDIA/nvidia-container-runtime[11] 开源项目的软件源到 apt 配置中。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":20,"length":35,"style":"BOLD"},{"offset":66,"length":3,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"c26d1","text":"cat \u003e /etc/apt/sources.list.d/nvidia-container-runtime.list \u003c\u003c EOF\ndeb https://nvidia.github.io/libnvidia-container/stable/ubuntu22.04/amd64 /\ndeb https://nvidia.github.io/nvidia-container-runtime/stable/ubuntu22.04/amd64 /\nEOF","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"2jhuf","text":"如果你的系统架构和系统版本不是 amd64 和 ubuntu22.04，请结合实际情况进行调整。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":16,"length":5,"style":"CODE"},{"offset":24,"length":11,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"465v3","text":"在添加了软件源之后，我们执行下面的命令，完成 nvidia-container-cli 工具的安装：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":23,"length":20,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"bk30p","text":"apt-get update\napt install -y nvidia-container-runtime","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"3l1r9","text":"完成工具安装之后，就可以使用下面的命令，来检查 Docker 需要的 Nvidia 显卡驱动是否完成完整安装了：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"24dp9","text":"nvidia-container-cli -k -d /dev/tty info","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"eb5hr","text":"执行完毕，我们将看到类似下面的日志：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"2sv8d","text":"-- WARNING, the following logs are for debugging purposes only --\n\nI1209 15:46:16.088339 22574 nvc.c:376] initializing library context (version=1.11.0, build=c8f267be0bac1c654d59ad4ea5df907141149977)\nI1209 15:46:16.088444 22574 nvc.c:350] using root /\nI1209 15:46:16.088458 22574 nvc.c:351] using ldcache /etc/ld.so.cache\nI1209 15:46:16.088469 22574 nvc.c:352] using unprivileged user 65534:65534\nI1209 15:46:16.088499 22574 nvc.c:393] attempting to load dxcore to see if we are running under Windows Subsystem for Linux (WSL)\nI1209 15:46:16.088915 22574 nvc.c:395] dxcore initialization failed, continuing assuming a non-WSL environment\nI1209 15:46:16.090266 22575 nvc.c:278] loading kernel module nvidia\nE1209 15:46:16.094200 22575 nvc.c:280] could not load kernel module nvidia\nI1209 15:46:16.094227 22575 nvc.c:296] loading kernel module nvidia_uvm\nE1209 15:46:16.097819 22575 nvc.c:298] could not load kernel module nvidia_uvm\nI1209 15:46:16.097845 22575 nvc.c:305] loading kernel module nvidia_modeset\nE1209 15:46:16.101219 22575 nvc.c:307] could not load kernel module nvidia_modeset\nI1209 15:46:16.101496 22579 rpc.c:71] starting driver rpc service\nI1209 15:46:16.101960 22574 rpc.c:135] driver rpc service terminated with signal 15\nnvidia-container-cli: initialization error: load library failed: libnvidia-ml.so.1: cannot open shared object file: no such file or directory\nI1209 15:46:16.102035 22574 nvc.c:434] shutting down library context\n...","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"f77cc","text":"在上面的日志中，我们能看到 could not load kernel module nvidia，说明系统中没有完整安装 Nvidia 的内核驱动。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":14,"length":35,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"c90d6","text":"解决这个问题很简单，在 Ubuntu 系统环境中，内置了经过官方验证的驱动检查命令：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"7am5c","text":"ubuntu-drivers devices","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"bt4q2","text":"执行命令，能够得到支持安装的显卡驱动列表：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"drjtq","text":"== /sys/devices/pci0000:00/0000:00:07.0 ==\nmodalias : pci:v000010DEd00001DB1sv000010DEsd00001212bc03sc02i00\nvendor   : NVIDIA Corporation\nmodel    : GV100GL [Tesla V100 SXM2 16GB]\ndriver   : nvidia-driver-418-server - distro non-free\ndriver   : nvidia-driver-450-server - distro non-free\ndriver   : nvidia-driver-510 - distro non-free\ndriver   : nvidia-driver-515-server - distro non-free\ndriver   : nvidia-driver-525 - distro non-free recommended\ndriver   : nvidia-driver-515 - distro non-free\ndriver   : nvidia-driver-390 - distro non-free\ndriver   : nvidia-driver-470 - distro non-free\ndriver   : nvidia-driver-470-server - distro non-free\ndriver   : xserver-xorg-video-nouveau - distro free builtin","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"b7thr","text":"如果你不确定安装哪一个好，可以跟着“推荐”（recommended）来：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":22,"length":11,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"8gqso","text":"apt install nvidia-driver-525 -y","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"1d13o","text":"完成驱动安装，在 Ubuntu 22.04 中，将会自动加载内核驱动，如果你的操作系统没有自动完成驱动加载，那么可能需要执行重启。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"69j1l","text":"再次执行检测命令，得到类似下面的日志：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"5s0qa","text":"nvidia-container-cli -k -d /dev/tty info\n\nNVRM version:   525.60.11\nCUDA version:   12.0\n\nDevice Index:   0\nDevice Minor:   0\nModel:          Tesla V100-SXM2-16GB\nBrand:          Tesla\nGPU UUID:       GPU-775f6201-9640-a18e-5d09-3b26e9b11a52\nBus Location:   00000000:00:07.0\nArchitecture:   7.0\nI1209 15:52:25.463383 42317 nvc.c:434] shutting down library context\nI1209 15:52:25.463438 42351 rpc.c:95] terminating nvcgo rpc service\nI1209 15:52:25.463812 42317 rpc.c:135] nvcgo rpc service terminated successfully\nI1209 15:52:25.466657 42346 rpc.c:95] terminating driver rpc service\nI1209 15:52:25.466810 42317 rpc.c:135] driver rpc service terminated successfully","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"4eoao","text":"不难发现，显卡类型已经能够被正常展示出来了。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"85m9h","text":"为 Docker 添加 Nvidia 运行时支持","type":"header-three","depth":0,"inlineStyleRanges":[{"offset":0,"length":24,"style":"BOLD"}],"entityRanges":[],"data":{"text":"%E4%B8%BA-Docker-%E6%B7%BB%E5%8A%A0-Nvidia-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%94%AF%E6%8C%81"}},{"key":"d8ltk","text":"完成 Docker 和 Nvidia 显卡的安装之后，此时 Docker 还不能调用显卡硬件，还需要做一些配置上的调整。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"eibsh","text":"执行下面的命令，将 nvidia-container-runtime 添加到 Docker 的启动参数中：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":10,"length":24,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"9nvpv","text":"sudo mkdir -p /etc/systemd/system/docker.service.d\n\nsudo tee /etc/systemd/system/docker.service.d/override.conf \u003c\u003cEOF\n[Service]\nExecStart=\nExecStart=/usr/bin/dockerd --host=fd:// --add-runtime=nvidia=/usr/bin/nvidia-container-runtime\nEOF","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"60imk","text":"搞定之后，执行下面的命令重载 daemon-reload 和重启 docker，让配置生效。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":15,"length":13,"style":"CODE"},{"offset":33,"length":6,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"5fvj1","text":"sudo systemctl daemon-reload\nsudo systemctl restart docker","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"6v49q","text":"接着，为了万无一失，我们在 /etc/docker/daemon.json 中添加配置字段，如果需要的话，还可以在 runtimeArgs 中添加需要的参数：","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":14,"length":23,"style":"CODE"},{"offset":58,"length":11,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"1kk9i","text":"sudo tee /etc/docker/daemon.json \u003c\u003cEOF\n{\n    \"runtimes\": {\n        \"nvidia\": {\n            \"path\": \"/usr/bin/nvidia-container-runtime\",\n            \"runtimeArgs\": []\n        }\n    }\n}\nEOF","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"ctmfh","text":"执行完毕，除了执行上面的命令之外，也可以用怀旧命令来重启服务 service docker restart。","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":31,"length":22,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"adf3g","text":"现在，我们就可以在使用 Docker 的时候，调用 Nvidia 显卡啦：","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"ebru3","text":"docker run --runtime=nvidia --ipc=host ...","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"2a2cu","text":"其他：太乙模型的资源要求","type":"header-two","depth":0,"inlineStyleRanges":[{"offset":0,"length":12,"style":"BOLD"}],"entityRanges":[],"data":{"text":"%E5%85%B6%E4%BB%96%EF%BC%9A%E5%A4%AA%E4%B9%99%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%B5%84%E6%BA%90%E8%A6%81%E6%B1%82"}},{"key":"5rusv","text":"太乙模型实际资源要求，感觉还不错，默认配置情况下一般也就占 4G 不到的显存，偶尔输出“sampling steps”比较大的图，会膨胀到 8GB 左右。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"415k6","text":"所以，如果控制生成配置的“计算量”，“小卡”运行应该也问题不大。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"bgct5","text":"nvidia-smi\nFri Dec  9 22:20:23 2022       \n+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 525.60.11    Driver Version: 525.60.11    CUDA Version: 12.0     |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|                               |                      |               MIG M. |\n|===============================+======================+======================|\n|   0  Tesla V100-SXM2...  Off  | 00000000:00:07.0 Off |                    0 |\n| N/A   38C    P0    55W / 300W |   3202MiB / 16384MiB |      0%      Default |\n|                               |                      |                  N/A |\n+-------------------------------+----------------------+----------------------+\n                                                                               \n+-----------------------------------------------------------------------------+\n| Processes:                                                                  |\n|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n|        ID   ID                                                   Usage      |\n|=============================================================================|\n|    0   N/A  N/A    181118      C   python                           3200MiB |\n+-----------------------------------------------------------------------------+","type":"code-block","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{"syntax":"javascript"}},{"key":"75rdj","text":"最后","type":"header-two","depth":0,"inlineStyleRanges":[{"offset":0,"length":2,"style":"BOLD"}],"entityRanges":[],"data":{"text":"%E6%9C%80%E5%90%8E"}},{"key":"a5mqg","text":"好啦，到这里本篇文章就写完啦。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"1op8j","text":"接下来，我会考虑聊聊 AIGC 话题里，绕不开的一些“关键词”，比如：大模型、Mac 、ARMv64 、低成本的 FineTune 等等。","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"526u1","text":"--EOF","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"8us5l","text":"引用链接","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":0,"length":4,"style":"BOLD"}],"entityRanges":[],"data":{}},{"key":"fda2e","text":"[1] 深圳大湾区数字经济研究院(IDEA): https://idea.edu.cn/\n[2] 封神榜大模型: https://github.com/IDEA-CCNL/Fengshenbang-LM\n[3] 仓库的指引: https://github.com/IDEA-CCNL/Fengshenbang-LM#%E4%BD%BF%E7%94%A8docker\n[4] Issue 里的记录: https://github.com/IDEA-CCNL/Fengshenbang-LM/issues/186\n[5] github.com/soulteary/docker-stable-diffusion-taiyi: https://github.com/soulteary/docker-stable-diffusion-taiyi\n[6] 构建的: https://hub.docker.com/layers/fengshenbang/pytorch/1.10-cuda11.1-cudann8-devel/images/sha256-00000cd554f202391c27bce3f0bad334e27041f7b925e282e31e811c5a5afa6b?context=explore\n[7] Web UI 项目: https://github.com/IDEA-CCNL/stable-diffusion-webui\n[8] DockerHub 的这个页面搜索: https://hub.docker.com/r/nvidia/cuda/tags?page=1\u0026name=11.3\n[9] 《使用 Docker 和 HuggingFace 实现 NLP 文本情感分析应用》: https://soulteary.com/2022/09/30/nlp-text-sentiment-analysis-application-using-docker-and-huggingface.html\n[10] 《在笔记本上搭建高性价比的 Linux 学习环境：基础篇》: https://soulteary.com/2022/06/21/building-a-cost-effective-linux-learning-environment-on-a-laptop-the-basics.html\n[11] NVIDIA/nvidia-container-runtime: https://github.com/NVIDIA/nvidia-container-runtime\n本文使用「署名 4.0 国际 (CC BY 4.0)」许可协议，欢迎转载、或重新修改使用，但需要注明来源。 署名 4.0 国际 (CC BY 4.0)","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":0,"length":3,"style":"CODE"},{"offset":45,"length":3,"style":"CODE"},{"offset":102,"length":3,"style":"CODE"},{"offset":183,"length":3,"style":"CODE"},{"offset":255,"length":3,"style":"CODE"},{"offset":370,"length":3,"style":"CODE"},{"offset":553,"length":3,"style":"CODE"},{"offset":620,"length":3,"style":"CODE"},{"offset":702,"length":3,"style":"CODE"},{"offset":856,"length":4,"style":"CODE"},{"offset":1006,"length":4,"style":"CODE"},{"offset":24,"length":20,"style":"ITALIC"},{"offset":57,"length":44,"style":"ITALIC"},{"offset":113,"length":69,"style":"ITALIC"},{"offset":199,"length":55,"style":"ITALIC"},{"offset":311,"length":58,"style":"ITALIC"},{"offset":379,"length":173,"style":"ITALIC"},{"offset":568,"length":51,"style":"ITALIC"},{"offset":643,"length":58,"style":"ITALIC"},{"offset":749,"length":106,"style":"ITALIC"},{"offset":892,"length":113,"style":"ITALIC"},{"offset":1044,"length":50,"style":"ITALIC"},{"offset":1149,"length":21,"style":"BOLD"}],"entityRanges":[],"data":{}}],"entityMap":{"0":{"type":"IMAGE","mutability":"IMMUTABLE","data":{"imageUrl":"https://developer.qcloudimg.com/http-save/yehe-1436546/3e03450ecbe9a306120e8d848dfd6098.jpg","imageAlt":"","blockWidth":1024,"blockHeight":738}},"1":{"type":"IMAGE","mutability":"IMMUTABLE","data":{"imageUrl":"https://developer.qcloudimg.com/http-save/yehe-1436546/ced98a219f11a53fb300cc1824acebae.jpg","imageAlt":"","blockWidth":1080,"blockHeight":679}},"2":{"type":"IMAGE","mutability":"IMMUTABLE","data":{"imageUrl":"https://developer.qcloudimg.com/http-save/yehe-1436546/4060f88adc1925292db325dcd0f7d34e.jpg","imageAlt":"","blockWidth":1080,"blockHeight":662}},"3":{"type":"IMAGE","mutability":"IMMUTABLE","data":{"imageUrl":"https://developer.qcloudimg.com/http-save/yehe-1436546/8c624cc4bcc167fa7db0f7ceef4db1a8.jpg","imageAlt":"","blockWidth":1080,"blockHeight":705}},"4":{"type":"IMAGE","mutability":"IMMUTABLE","data":{"imageUrl":"https://developer.qcloudimg.com/http-save/yehe-1436546/9ac7492d7c8215008d6b15740ad7f54c.jpg","imageAlt":"","blockWidth":1080,"blockHeight":468}},"5":{"type":"IMAGE","mutability":"IMMUTABLE","data":{"imageUrl":"https://developer.qcloudimg.com/http-save/yehe-1436546/a78965c0f284fd87b24c41dc5e0a2cbc.jpg","imageAlt":"","blockWidth":1080,"blockHeight":266}},"6":{"type":"IMAGE","mutability":"IMMUTABLE","data":{"imageUrl":"https://developer.qcloudimg.com/http-save/yehe-1436546/66283eef2f0a7e30d8206bae1e7badcd.jpg","imageAlt":"","blockWidth":800,"blockHeight":1151}}}},"createTime":1678008934,"ext":{"closeTextLink":0,"focusRead":0,"comment_ban":0,"description":""},"favNum":0,"isOriginal":0,"likeNum":4,"pic":"https://developer.qcloudimg.com/http-save/yehe-1436546/5303cea0749810876d5b0193cb618a65.jpg","plain":"本篇文章，我们聊聊如何使用 Docker 快速运行中文 Stable Diffusion 模型：太乙。\n写在前面\n上个月的时候，有朋友和我推荐了一个 “Stable Diffusion” 模型，来自深圳大湾区数字经济研究院(IDEA)[1]的封神榜大模型[2]中的 “太乙” 。\n📷\nAI 生成 “醉里不知天在水，满船清梦压星河”\n最近想起来，想本地运行试试看，根据官方开源仓库的指引[3]和 Issue 里的记录[4]，发现如果用官方提供的容器镜像跑“太乙”，这个项目根本跑不起来。\n于是，花了一些时间，封装了一个可以一键运行、开箱即用的模型镜像。完整代码开源在 github.com/soulteary/docker-stable-diffusion-taiyi[5]，有需要的同学自取。\n这篇文章，我将记录下来折腾过程，希望能帮助到有相同需求，想要快速运行这个模型，找乐子的同学。\n当然，也希望这篇文章，能够帮到将模型开源开放出来的 IDEA 研究院的开发团队的同学，改进当前开源项目中的不足之处，让中文开源项目越来越好。\n快速上手\n如果你本地已经准备好了运行 Docker 的环境，并且有一张显存在 4G 到 8G 之间的显卡，可以尝试使用下面这个镜像，镜像尺寸为 8GB （ 如果你手头没有显卡，也不想使用云主机，那么可以等等后续不需要 GPU 的“模型把玩”文章，或者翻阅之前有关模型的文章 :D ）\ndocker pull soulteary/stable-diffusion:taiyi-0.1\n想运行“太乙”，除了需要下载“模型游乐场”镜像之外，我们还需要获取“太乙模型”文件：\ngit clone https://huggingface.co/IDEA-CCNL/Taiyi-Stable-Diffusion-1B-Chinese-v0.1\n整个仓库尺寸比较大（大概有 18GB），需要花费一些时间：\nCloning into 'Taiyi-Stable-Diffusion-1B-Chinese-v0.1'...\nremote: Enumerating objects: 157, done.\nremote: Counting objects: 100% (157/157), done.\nremote: Compressing objects: 100% (155/155), done.\nremote: Total 157 (delta 77), reused 0 (delta 0), pack-reused 0\nReceiving objects: 100% (157/157), 3.06 MiB | 22.25 MiB/s, done.\nResolving deltas: 100% (77/77), done.\nFiltering content: 100% (5/5), 8.92 GiB | 11.48 MiB/s, done.\n原始项目启用了 git lfs，所以添加不添加 --depth 参数没有差别，耐心等待模型下载完毕之后，我们编写一个容器编排文件，来启动模型应用：\nversion: \"2\"\nservices:\n\n  taiyi:\n    image: soulteary/stable-diffusion:taiyi-0.1\n    container_name: taiyi\n    restart: always\n    runtime: nvidia\n    ipc: host\n    ports:\n      - \"7860:7860\"\n    volumes:\n      - ./Taiyi-Stable-Diffusion-1B-Chinese-v0.1:/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1\n将上面的内容保存为 docker-compose.yml 之后，执行 docker compose up -d，稍等片刻，在浏览器访问启动服务的 IP 地址和对应端口，比如：http://localhost:7860，就能够正常使用啦。\n📷\n支持太乙模型的 Stable Diffusion Web 控制台\n模型运行起来，当然是要玩一把了，我使用博客首页的古诗“醉里不知天在水，满船清梦压星河”为主题，尝试生成了一张图，看起来效果还不错：\n📷\n干净透明、详尽的构建日志\n想要快速上手中文 Stable Diffusion 模型的同学，看到这里就可以啦。\n如果你想了解如何从零开始配置 GPU 云服务器环境，或者想了解这个 Stable Diffusion 容器运行环境是如何构建的，可以继续阅读。\n那么，聊聊如何将“太乙”正确的放进容器里。\n如何将“太乙”正确的放进容器\n既然提到了正确 ，我们首先要看看官方的镜像都包含哪些问题。\n分析太乙官方镜像和应用项目存在的问题\n📷\n太乙官方提供的模型\n官方团队并未在仓库中添加容器镜像的编排文件，起初我认为是上线匆忙忘记了，但是随着我翻开 DockerHub 的提交记录时，发现原来这个镜像的构建方式是基于传统的 docker commit 构建的[6]，这样的镜像存在两个问题，首先是黑盒不透明，拿 Docker 当虚拟机用，不利于二次开发和维护；其次，这最后一次提交，单个提交的变动包含 5个GB ，里面是否无心夹带了不该存在的内容，对于想私有化部署的场景下，也着实是有些让人难以放心。\n📷\n官方镜像的“黑盒子”\n其次，用户如果想在干净完整复现，就只能参考镜像中的“历史操作记录”啦，然而，并不是所有的命令都是能被系统记录下来的，比如 vim 等交互式操作，或者非幂等的操作，用户实际上也无法再次复现。\n我们使用 docker run --rm -it fengshenbang/pytorch:1.10-cuda11.1-cudann8-devel bash 启动一个太乙官方团队，三个月前制作的镜像的 Docker 容器。\n输入 history，能够看到开发同学启动容器之后，又噼里啪啦的搞了“一堆事情”：\n1  python\n2  git clone https://github.com/IDEA-CCNL/Fengshenbang-LM.git\n3  cd Fengshenbang-LM/\n4  ls\n5  vim fengshen/requirement.txt \n6  pip install --editable fengshen\n7  pip install --editable .\n8  pip install --update pillow\n9  pip install --upgrade pillow\n10  nvcc --version\n11  where nvcc\n12  which nvcc\n13  pip install torch==1.10.0+cu111 torchvision==0.11.0+cu111 torchaudio==0.10.0 -f https://download.pytorch.org/whl/torch_stable.html\n14  pip install --upgrade packaging --use-feature=2020-resolver\n15  pip install --upgrade PyYAML --use-feature=2020-resolver\n16  pip install --upgrade PyYAML --use-feature=2020-resolver --ignore-installed\n17  pip install --upgrade tqdm --use-feature=2020-resolver\n18  pip uninstall pip install torchtext\n19  pip uninstall torchtext\n20  pip install torchtext\n21  pip uninstall torchtext\n22  pip install torchtext==0.10.0\n23  python\n24  pip install torchtext==0.11.0\n25  cd fengshen\n26  ls\n27  cd examples/\n28  cd pretrain_erlangshen_deberta_v2/\n29  ls\n30  vim pretrain_deberta_base.sh \n31  sh pretrain_deberta_base.sh \n32  git submodule init\n33  git submodule update\n34  cd ..\n35  cd data/fs_datasets/\n36  ls\n37  ll\n38  cd ..\n39  git submodule init\n40  git submodule update\n41  cd data/fs_datasets/\n42  cd ..\n43  vim .gitmodules \n44  git submodule update\n45  git submodule init\n46  git submodule update\n47  vim .gitmodules \n48  git submodule --help\n49  git submodule\n50  git submodule init\n51  git submodule\n52  git submodule update --init\n53  vim .git/config \n54  git submodule init\n55  git submodule update\n56  cd fengshen/examples/\n57  ls\n58  cd pretrain_erlangshen_deberta_v2/\n59  sh pretrain_deberta_base.sh \n60  vim pretrain_deberta_base.sh \n61  sh pretrain_deberta_base.sh \n62  cd ..\n63  cd Fengshenbang-LM/\n64  git status\n65  rm -rf fengshen/workspace/torch_extendsions\n66  rm fengshen/workspace/erlangshen-deberta-base/lightning_logs/\n67  rm fengshen/workspace/erlangshen-deberta-base/lightning_logs -rf\n68  rm fengshen/workspace/erlangshen-deberta-base/ckpt -rf\n69  cd ..\n70  exit\n上面的命令中，主要做了几件事：\n1.调整和配置 Python 应用所需要 Pytorch 基础运行环境，经历了多次失败和重试。2.手动安装项目运行所需要的某几个软件包，也是经历了翻来覆去的重试。3.或许，开发同学不太习惯使用 git submodule，为了让项目程序文件完整，也是折腾来折腾去。4.在提供给用户的镜像里进行了 pretrain_erlangshen_deberta_v2 的预训练，结束后或许是想保持干净的环境，删除掉了日志和模型文件。\n然而，这些三个月前的操作，对于我们想正确运行太乙的模型和界面程序，非但没有正确指引，反而存在“误导”：\n1.PyTorch 版本低，运行程序会因为程序使用了新版本（1.13+）版本才存在的数据类型而无法运行。2.历史操作中反复安装的 torchtext 将阻止我们安装到正确的 PyTorch，进一步阻碍程序在容器内正确运行。3.除此之外，官方项目使用的 submodule 中的引用地址为：git@github.com:IDEA-CCNL/fs_datasets.git，在容器默认环境下是无法完成通过 git 进行下载的。4.最后，官方在项目中推荐的方式是启动 Docker 容器作为虚拟机，然后 docker exec -it fengshen bash 进去之后，使用 git pull \u0026\u0026 git submodule ... 来强制更新代码，这样容易出现代码和模型版本不匹配，代码和依赖组件不匹配，和基础环境软件不兼容的情况下，软件无法运行的情况。并且，这样做其实在一些情况下，是无法更新 submodule 中的程序文件的。\n除了基础镜像的问题之外，官方 fork 改版的 stable-diffusion-webui Web UI 项目[7]也隐藏了一些问题。虽然，其中不少问题都是从原版程序“继承”过来的。\n首先，项目所需要的依赖，并不是完全都包含在项目的依赖声明文件中；并且，项目中存在俩 requirements.txt 文件，其中都包含了未指定明确版本的软件包。可能官方开发团队想缓解这个问题，于是编写了一个名为 launch.py 的启动文件，在执行程序之后，程序会自动调用 prepare_enviroment() 函数，包含了“近似”所有所需 Python 软件包依赖的安装，以及关联项目的下载。\n在这个文件中，我们会发现目前版本的程序想正确运行起来，实际需要的基础运行环境是：torch==1.12.1+cu113 torchvision==0.13.1+cu113，好吧，如果你没有仔细阅读过这个 launch.py，那么官方镜像提供的默认环境将浪费不少想让程序运行起来，花费的调试时间。\n我们也能够在这个文件中发现大量直接调用 subprocess.run 执行的安装命令。因为项目中没有明确的版本声明，所以当程序下载完 gfpgan、clip、xformers、deepdanbooru、pyngrok、Stable Diffusion、Taming Transformer、K-diffusion、CodeFormer、BLIP 后，一通安装后，再进行安装 web ui 本身的依赖，很容易造成程序因为版本兼容性存在问题，而无法运行，或者运行出错的问题，对其他人提供公开代码，或者下载的软件，使用显式声明是好习惯。\n在上面的依赖安装中，还存在两个问题。第一个是来自 Facebook Research 的 xformers，如果想要在 GPU 环境正确安装，安装指令需要调整。推测这里测试的同学，偷懒没有验证 GPU 环境从零到一的安装验证。\n其二，pyngrok 这个包，虽然目前还没有在项目中被公开使用，但是就伴随程序的“自动初始化”悄然无声的安装到用户电脑上，其实不见得是一件合适的事情。太乙团队的镜像里暂时并未发现 ngrok 的执行程序，但是如果其他人再分发的过程中，虽然不改动原始代码，但是在程序中夹带了 ngrok，配合不严格的安全策略，对于用户而言，潜在的数据安全风险还是蛮高的。\n解决被官方忽视的 AI 容器应用问题\n太乙官方团队之前选择的基础镜像是 pytorch:1.10-cuda11.1-cudann8-devel。结合上面的分析，我们不难知道两点：\n1.第一，我们需要更新 cuda 版本到 11.3.1。2.第二，我们有对 PyTorch “生态” 依赖进行安装更新的需要，使用预置 PyTorch 的镜像意义不大。\n所以，这里我选择使用 nvidia/cuda:11.3.1-devel-ubuntu18.04 作为基础镜像，搭配 miniconda 完成经过验证的 PyTorch “生态”软件版本的安装，搞定程序的基础“运行时”。\n如果你需要寻找其他版本的镜像，可以在 DockerHub 的这个页面搜索[8]，另外，如果你需要判断 PyTorch 版本所需要的 CUDA 版本，可以在 PyTorch 官方发布页面中寻找线索：https://pytorch.org/get-started/previous-versions/。\nFROM nvidia/cuda:11.3.1-devel-ubuntu18.04\n\nENV PATH=\"/root/miniconda3/bin:${PATH}\"\nRUN apt-get update\nRUN apt-get install -y wget \u0026\u0026 rm -rf /var/lib/apt/lists/*\n\nRUN wget \\\n    https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh \\\n    \u0026\u0026 mkdir /root/.conda \\\n    \u0026\u0026 bash Miniconda3-latest-Linux-x86_64.sh -b \\\n    \u0026\u0026 rm -f Miniconda3-latest-Linux-x86_64.sh\n\nRUN conda install pytorch==1.12.1 torchvision==0.13.1 torchaudio==0.12.1 cudatoolkit=11.3 -c pytorch -y \n然后，我们开始翻译 launch.py 程序中关于软件的依赖下载和安装命令，先处理基础软件依赖（不进行 pyngrok 的安装）：\n# WebUI\nRUN pip install transformers==4.19.2 diffusers==0.3.0 basicsr==1.4.2 gfpgan==1.3.8 gradio==3.8 numpy==1.23.3 Pillow==9.2.0 realesrgan==0.3.0 torch omegaconf==2.2.3 pytorch_lightning==1.7.6 scikit-image==0.19.2 fonts font-roboto timm==0.6.7 fairscale==0.4.9 piexif==1.1.3 einops==0.4.1 jsonmerge==1.8.0 clean-fid==0.1.29 resize-right==0.0.2 torchdiffeq==0.2.3 kornia==0.6.7 lark==1.1.2 inflection==0.5.1 GitPython==3.1.27\n# Etc...\nRUN apt-get update \u0026\u0026 apt-get install -y git\nRUN pip install \"git+https://github.com/TencentARC/GFPGAN.git@8d2447a2d918f8eba5a4a01463fd48e45126a379\"\nRUN pip install \"git+https://github.com/openai/CLIP.git@d50d76daa670286dd6cacf3bcd80b5e4823fc8e1\"\n\nRUN pip install \"git+https://github.com/KichangKim/DeepDanbooru.git@d91a2963bf87c6a770d74894667e9ffa9f6de7ff#egg=deepdanbooru\" \u0026\u0026 \\\n    pip install tensorflow==2.10.0 tensorflow-io==0.27.0\n\nRUN pip install ninja \u0026\u0026 \\\n    pip install -v -U \"git+https://github.com/facebookresearch/xformers.git@main#egg=xformers\"\n接着，我们来处理程序运行所需要的三方开源仓库这类组件依赖，按照官方 Web UI 所需要的 git hash 版本将它们下载下来：\nRUN git clone \"https://github.com/CompVis/stable-diffusion.git\" \"stable-diffusion\" \u0026\u0026 \\\n    cd \"stable-diffusion\" \u0026\u0026 \\\n    git checkout \"69ae4b35e0a0f6ee1af8bb9a5d0016ccb27e36dc\"\n\nRUN git clone \"https://github.com/CompVis/taming-transformers.git\" \"taming-transformers\" \u0026\u0026 \\\n    cd \"taming-transformers\" \u0026\u0026 \\\n    git checkout \"24268930bf1dce879235a7fddd0b2355b84d7ea6\"\n\nRUN git clone \"https://github.com/crowsonkb/k-diffusion.git\" \"k-diffusion\" \u0026\u0026 \\\n    cd \"k-diffusion\" \u0026\u0026 \\\n    git checkout \"60e5042ca0da89c14d1dd59d73883280f8fce991\"\n\nRUN git clone \"https://github.com/sczhou/CodeFormer.git\" \"CodeFormer\" \u0026\u0026 \\\n    cd \"CodeFormer\" \u0026\u0026 \\\n    git checkout \"c5b4593074ba6214284d6acd5f1719b6c5d739af\"\n\nRUN git clone \"https://github.com/salesforce/BLIP.git\" \"BLIP\" \u0026\u0026 \\\n    cd \"BLIP\" \u0026\u0026 \\\n    git checkout \"48211a1594f1321b00f14c9f7a5b4813144b2fb9\"\n\nRUN cd \"CodeFormer\" \u0026\u0026 \\\n    pip install -r requirements.txt\n然后，我们来处理太乙专属的 Web UI 这部分的程序，为了让镜像能够稳定构建、稳定运行，我们对 IDEA-CCNL/stable-diffusion-webui 也进行“版本的显式定义”：\nRUN git clone https://github.com/IDEA-CCNL/stable-diffusion-webui.git \u0026\u0026 \\\n    cd \"stable-diffusion-webui\" \u0026\u0026 \\\n    git checkout \"b31fc195a6d56a36b4abe1f6e36890211a78e844\"\n\nRUN mv \"stable-diffusion\" stable-diffusion-webui/repositories/ \u0026\u0026 \\\n    mv \"taming-transformers\" stable-diffusion-webui/repositories/ \u0026\u0026 \\\n    mv \"k-diffusion\" stable-diffusion-webui/repositories/ \u0026\u0026 \\\n    mv \"CodeFormer\" stable-diffusion-webui/repositories/ \u0026\u0026 \\\n    mv \"BLIP\" stable-diffusion-webui/repositories/\n接下来，对官方团队准备好的配置文件进行调整，为了方便容器使用，我们将把太乙的模型文件放在 Web UI 的 stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/ 目录中：\nRUN cd stable-diffusion-webui/repositories/ \u0026\u0026 \\\n    cp \"stable-diffusion-taiyi/configs/stable-diffusion/v1-inference.yaml\" \"stable-diffusion/configs/stable-diffusion/v1-inference.yaml\" \u0026\u0026 \\\n    cp \"stable-diffusion-taiyi/ldm/modules/encoders/modules.py\" \"stable-diffusion/ldm/modules/encoders/modules.py\" \u0026\u0026 \\\n    sed -ie s#your_path/Taiyi-Stable-Diffusion-1B-Chinese-v0.1#/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/# \"stable-diffusion/configs/stable-diffusion/v1-inference.yaml\"\n设置程序运行工作目录，以及启动参数：\nWORKDIR stable-diffusion-webui\nCMD [\"python\", \"webui.py\", \"--ckpt\", \"/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/Taiyi-Stable-Diffusion-1B-Chinese-v0.1.ckpt\", \"--listen\"]\n最后，将上面的内容保存为 Dockerfile，执行 docker build -t soulteary/stable-diffusion:taiyi-0.1 . ，耐心等待镜像构建完毕就好啦。\n我们使用 docker images 查看镜像尺寸：\nREPOSITORY                   TAG         IMAGE ID       CREATED        SIZE\nsoulteary/stable-diffusion   taiyi-0.1   359b67ba7c2f   5 hours ago    17.4GB\n发现虽然比官方镜像解压缩后的 22.5GB 小，但是还是有些大，那么，接下来，我们来进行简单优化。\n如果你想了解极限的“硬核优化”，可以参考《使用 Docker 和 HuggingFace 实现 NLP 文本情感分析应用》[9]或者往期大文章，在此就不赘述啦 :D\n进一步优化 AI 应用的镜像尺寸\n因为时间关系，我就先不折腾多阶段构建，以及定向的压缩实现啦，我们针对上面的镜像编排指令进行合并，再每个阶段去掉不必要的文件，很容易得到类似下面的，紧凑一些的 Dockerfile：\nFROM nvidia/cuda:11.3.1-devel-ubuntu18.04\nLABEL org.opencontainers.image.authors=\"soulteary@gmail.com\"\nENV PATH=\"/root/miniconda3/bin:${PATH}\"\nRUN apt-get update \u0026\u0026 \\\n    apt-get install -y wget git ffmpeg libsm6 libxext6 \u0026\u0026 \\\n    rm -rf /var/lib/apt/lists/* \u0026\u0026 \\\n    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh \u0026\u0026 \\\n    mkdir /root/.conda \u0026\u0026 \\\n    bash Miniconda3-latest-Linux-x86_64.sh -b \u0026\u0026 \\\n    rm -f Miniconda3-latest-Linux-x86_64.sh \n# Basic environment (PyApp \u0026 WebUI)\nRUN conda install pytorch==1.12.1 torchvision==0.13.1 torchaudio==0.12.1 cudatoolkit=11.3 -c pytorch -y \u0026\u0026 \\\n    pip install transformers==4.19.2 diffusers==0.3.0 basicsr==1.4.2 gfpgan==1.3.8 gradio==3.8 numpy==1.23.3 Pillow==9.2.0 realesrgan==0.3.0 torch omegaconf==2.2.3 pytorch_lightning==1.7.6 scikit-image==0.19.2 fonts font-roboto timm==0.6.7 fairscale==0.4.9 piexif==1.1.3 einops==0.4.1 jsonmerge==1.8.0 clean-fid==0.1.29 resize-right==0.0.2 torchdiffeq==0.2.3 kornia==0.6.7 lark==1.1.2 inflection==0.5.1 GitPython==3.1.27 \u0026\u0026 \\\n    pip install \"git+https://github.com/TencentARC/GFPGAN.git@8d2447a2d918f8eba5a4a01463fd48e45126a379\" \u0026\u0026 \\\n    pip install \"git+https://github.com/openai/CLIP.git@d50d76daa670286dd6cacf3bcd80b5e4823fc8e1\" \u0026\u0026 \\\n    pip install \"git+https://github.com/KichangKim/DeepDanbooru.git@d91a2963bf87c6a770d74894667e9ffa9f6de7ff#egg=deepdanbooru\" \u0026\u0026 \\\n    pip install tensorflow==2.10.0 tensorflow-io==0.27.0 \u0026\u0026 \\\n    pip install ninja \u0026\u0026 \\\n    pip install -v -U \"git+https://github.com/facebookresearch/xformers.git@main#egg=xformers\" \u0026\u0026 \\\n    pip cache purge\n# Components\nRUN git clone \"https://github.com/CompVis/stable-diffusion.git\" \"stable-diffusion\" \u0026\u0026 \\\n    cd \"stable-diffusion\" \u0026\u0026 \\\n    git checkout \"69ae4b35e0a0f6ee1af8bb9a5d0016ccb27e36dc\" \u0026\u0026 rm -rf .git\nRUN git clone \"https://github.com/CompVis/taming-transformers.git\" \"taming-transformers\" \u0026\u0026 \\\n    cd \"taming-transformers\" \u0026\u0026 \\\n    git checkout \"24268930bf1dce879235a7fddd0b2355b84d7ea6\" \u0026\u0026 rm -rf .git\nRUN git clone \"https://github.com/crowsonkb/k-diffusion.git\" \"k-diffusion\" \u0026\u0026 \\\n    cd \"k-diffusion\" \u0026\u0026 \\\n    git checkout \"60e5042ca0da89c14d1dd59d73883280f8fce991\" \u0026\u0026 rm -rf .git\nRUN git clone \"https://github.com/sczhou/CodeFormer.git\" \"CodeFormer\" \u0026\u0026 \\\n    cd \"CodeFormer\" \u0026\u0026 \\\n    git checkout \"c5b4593074ba6214284d6acd5f1719b6c5d739af\" \u0026\u0026 rm -rf .git \u0026\u0026 \\\n    pip install -r requirements.txt \u0026\u0026 pip cache purge\nRUN git clone \"https://github.com/salesforce/BLIP.git\" \"BLIP\" \u0026\u0026 \\\n    cd \"BLIP\" \u0026\u0026 \\\n    git checkout \"48211a1594f1321b00f14c9f7a5b4813144b2fb9\" \u0026\u0026 rm -rf .git\nRUN git clone \"https://github.com/IDEA-CCNL/stable-diffusion-webui.git\" \"stable-diffusion-webui\" \u0026\u0026 \\\n    cd \"stable-diffusion-webui\" \u0026\u0026 \\\n    git checkout \"b31fc195a6d56a36b4abe1f6e36890211a78e844\" \u0026\u0026 rm -rf .git \u0026\u0026 \\\n    cd ../ \u0026\u0026 \\\n    mv \"stable-diffusion\" \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    mv \"taming-transformers\" \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    mv \"k-diffusion\" \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    mv \"CodeFormer\" \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    mv \"BLIP\" \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    cd \"stable-diffusion-webui/repositories/\" \u0026\u0026 \\\n    cp \"stable-diffusion-taiyi/configs/stable-diffusion/v1-inference.yaml\" \"stable-diffusion/configs/stable-diffusion/v1-inference.yaml\" \u0026\u0026 \\\n    cp \"stable-diffusion-taiyi/ldm/modules/encoders/modules.py\" \"stable-diffusion/ldm/modules/encoders/modules.py\" \u0026\u0026 \\\n    sed -ie s#your_path/Taiyi-Stable-Diffusion-1B-Chinese-v0.1#/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/# \"stable-diffusion/configs/stable-diffusion/v1-inference.yaml\"\nWORKDIR stable-diffusion-webui\nCMD [\"python\", \"webui.py\", \"--ckpt\", \"/stable-diffusion-webui/models/Taiyi-Stable-Diffusion-1B-Chinese-v0.1/Taiyi-Stable-Diffusion-1B-Chinese-v0.1.ckpt\", \"--listen\"]\n再次执行 docker build -t soulteary/stable-diffusion:taiyi-0.1 . 进行镜像的构建，构建完毕后，再一次使用 docker images 查看镜像尺寸，发现尺寸立减 2GB，相比官方镜像小了 6GB+：\nREPOSITORY                   TAG         IMAGE ID       CREATED        SIZE\nsoulteary/stable-diffusion   taiyi-0.1   0e1c48709672   2 hours ago    15.4GB\n将镜像推送到 DockerHub 上，经过平台的压缩，镜像传输尺比官方压缩后的镜像“轻” 2GB：\n📷\n从新构建的太乙模型镜像\n并且，镜像构建细节中，每一步做了什么，构建的层多大，都清清楚楚的展示在了 DockerHub 的镜像详情页中，“干净又卫生”。\n📷\n干净透明、详尽的构建日志\nGPU 云主机环境的配置\n想要简单、丝滑的在云服务器上运行 Python AI 应用，有一些前置工作要做。\nDocker 基础环境的安装\n我们在云环境默认创建的 GPU 服务器，可能环境有这样或者那样的小问题，为了避免时间浪费在琐碎问题上，我们可以考虑用 Docker 所提供的“固定 \u0026 明确的运行环境”来节约时间。\n想要运行 Docker 首先要完成 Docker 的安装，在《在笔记本上搭建高性价比的 Linux 学习环境：基础篇》[10]一文的“更简单的 Docker 安装”小节中，我提到过如何快速、正确的在 Ubuntu 环境完成 Docker 的安装，这里就不做展开了，有需要的同学可以自行翻阅。\n如果，我们想在 Docker 中调用 Nvidia 显卡，光是完成 Docker 安装，还是不够的，还有一些事情要做。\n完善 Nvidia 显卡驱动安装\n我们需要先信任 Nvidia 的 GPG Key，然后才能安装来自 Nvidia 的开源软件。\ncurl -fsSL https://nvidia.github.io/nvidia-container-runtime/gpgkey | sudo gpg --dearmor -o /etc/apt/keyrings/nvidia-container-runtime.gpg\n接着，需要更新系统中的软件源列表，添加 NVIDIA/nvidia-container-runtime[11] 开源项目的软件源到 apt 配置中。\ncat \u003e /etc/apt/sources.list.d/nvidia-container-runtime.list \u003c\u003c EOF\ndeb https://nvidia.github.io/libnvidia-container/stable/ubuntu22.04/amd64 /\ndeb https://nvidia.github.io/nvidia-container-runtime/stable/ubuntu22.04/amd64 /\nEOF\n如果你的系统架构和系统版本不是 amd64 和 ubuntu22.04，请结合实际情况进行调整。\n在添加了软件源之后，我们执行下面的命令，完成 nvidia-container-cli 工具的安装：\napt-get update\napt install -y nvidia-container-runtime\n完成工具安装之后，就可以使用下面的命令，来检查 Docker 需要的 Nvidia 显卡驱动是否完成完整安装了：\nnvidia-container-cli -k -d /dev/tty info\n执行完毕，我们将看到类似下面的日志：\n-- WARNING, the following logs are for debugging purposes only --\n\nI1209 15:46:16.088339 22574 nvc.c:376] initializing library context (version=1.11.0, build=c8f267be0bac1c654d59ad4ea5df907141149977)\nI1209 15:46:16.088444 22574 nvc.c:350] using root /\nI1209 15:46:16.088458 22574 nvc.c:351] using ldcache /etc/ld.so.cache\nI1209 15:46:16.088469 22574 nvc.c:352] using unprivileged user 65534:65534\nI1209 15:46:16.088499 22574 nvc.c:393] attempting to load dxcore to see if we are running under Windows Subsystem for Linux (WSL)\nI1209 15:46:16.088915 22574 nvc.c:395] dxcore initialization failed, continuing assuming a non-WSL environment\nI1209 15:46:16.090266 22575 nvc.c:278] loading kernel module nvidia\nE1209 15:46:16.094200 22575 nvc.c:280] could not load kernel module nvidia\nI1209 15:46:16.094227 22575 nvc.c:296] loading kernel module nvidia_uvm\nE1209 15:46:16.097819 22575 nvc.c:298] could not load kernel module nvidia_uvm\nI1209 15:46:16.097845 22575 nvc.c:305] loading kernel module nvidia_modeset\nE1209 15:46:16.101219 22575 nvc.c:307] could not load kernel module nvidia_modeset\nI1209 15:46:16.101496 22579 rpc.c:71] starting driver rpc service\nI1209 15:46:16.101960 22574 rpc.c:135] driver rpc service terminated with signal 15\nnvidia-container-cli: initialization error: load library failed: libnvidia-ml.so.1: cannot open shared object file: no such file or directory\nI1209 15:46:16.102035 22574 nvc.c:434] shutting down library context\n...\n在上面的日志中，我们能看到 could not load kernel module nvidia，说明系统中没有完整安装 Nvidia 的内核驱动。\n解决这个问题很简单，在 Ubuntu 系统环境中，内置了经过官方验证的驱动检查命令：\nubuntu-drivers devices\n执行命令，能够得到支持安装的显卡驱动列表：\n== /sys/devices/pci0000:00/0000:00:07.0 ==\nmodalias : pci:v000010DEd00001DB1sv000010DEsd00001212bc03sc02i00\nvendor   : NVIDIA Corporation\nmodel    : GV100GL [Tesla V100 SXM2 16GB]\ndriver   : nvidia-driver-418-server - distro non-free\ndriver   : nvidia-driver-450-server - distro non-free\ndriver   : nvidia-driver-510 - distro non-free\ndriver   : nvidia-driver-515-server - distro non-free\ndriver   : nvidia-driver-525 - distro non-free recommended\ndriver   : nvidia-driver-515 - distro non-free\ndriver   : nvidia-driver-390 - distro non-free\ndriver   : nvidia-driver-470 - distro non-free\ndriver   : nvidia-driver-470-server - distro non-free\ndriver   : xserver-xorg-video-nouveau - distro free builtin\n如果你不确定安装哪一个好，可以跟着“推荐”（recommended）来：\napt install nvidia-driver-525 -y\n完成驱动安装，在 Ubuntu 22.04 中，将会自动加载内核驱动，如果你的操作系统没有自动完成驱动加载，那么可能需要执行重启。\n再次执行检测命令，得到类似下面的日志：\nnvidia-container-cli -k -d /dev/tty info\n\nNVRM version:   525.60.11\nCUDA version:   12.0\n\nDevice Index:   0\nDevice Minor:   0\nModel:          Tesla V100-SXM2-16GB\nBrand:          Tesla\nGPU UUID:       GPU-775f6201-9640-a18e-5d09-3b26e9b11a52\nBus Location:   00000000:00:07.0\nArchitecture:   7.0\nI1209 15:52:25.463383 42317 nvc.c:434] shutting down library context\nI1209 15:52:25.463438 42351 rpc.c:95] terminating nvcgo rpc service\nI1209 15:52:25.463812 42317 rpc.c:135] nvcgo rpc service terminated successfully\nI1209 15:52:25.466657 42346 rpc.c:95] terminating driver rpc service\nI1209 15:52:25.466810 42317 rpc.c:135] driver rpc service terminated successfully\n不难发现，显卡类型已经能够被正常展示出来了。\n为 Docker 添加 Nvidia 运行时支持\n完成 Docker 和 Nvidia 显卡的安装之后，此时 Docker 还不能调用显卡硬件，还需要做一些配置上的调整。\n执行下面的命令，将 nvidia-container-runtime 添加到 Docker 的启动参数中：\nsudo mkdir -p /etc/systemd/system/docker.service.d\n\nsudo tee /etc/systemd/system/docker.service.d/override.conf \u003c\u003cEOF\n[Service]\nExecStart=\nExecStart=/usr/bin/dockerd --host=fd:// --add-runtime=nvidia=/usr/bin/nvidia-container-runtime\nEOF\n搞定之后，执行下面的命令重载 daemon-reload 和重启 docker，让配置生效。\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n接着，为了万无一失，我们在 /etc/docker/daemon.json 中添加配置字段，如果需要的话，还可以在 runtimeArgs 中添加需要的参数：\nsudo tee /etc/docker/daemon.json \u003c\u003cEOF\n{\n    \"runtimes\": {\n        \"nvidia\": {\n            \"path\": \"/usr/bin/nvidia-container-runtime\",\n            \"runtimeArgs\": []\n        }\n    }\n}\nEOF\n执行完毕，除了执行上面的命令之外，也可以用怀旧命令来重启服务 service docker restart。\n现在，我们就可以在使用 Docker 的时候，调用 Nvidia 显卡啦：\ndocker run --runtime=nvidia --ipc=host ...\n其他：太乙模型的资源要求\n太乙模型实际资源要求，感觉还不错，默认配置情况下一般也就占 4G 不到的显存，偶尔输出“sampling steps”比较大的图，会膨胀到 8GB 左右。\n所以，如果控制生成配置的“计算量”，“小卡”运行应该也问题不大。\nnvidia-smi\nFri Dec  9 22:20:23 2022       \n+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 525.60.11    Driver Version: 525.60.11    CUDA Version: 12.0     |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|                               |                      |               MIG M. |\n|===============================+======================+======================|\n|   0  Tesla V100-SXM2...  Off  | 00000000:00:07.0 Off |                    0 |\n| N/A   38C    P0    55W / 300W |   3202MiB / 16384MiB |      0%      Default |\n|                               |                      |                  N/A |\n+-------------------------------+----------------------+----------------------+\n                                                                               \n+-----------------------------------------------------------------------------+\n| Processes:                                                                  |\n|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n|        ID   ID                                                   Usage      |\n|=============================================================================|\n|    0   N/A  N/A    181118      C   python                           3200MiB |\n+-----------------------------------------------------------------------------+\n最后\n好啦，到这里本篇文章就写完啦。\n接下来，我会考虑聊聊 AIGC 话题里，绕不开的一些“关键词”，比如：大模型、Mac 、ARMv64 、低成本的 FineTune 等等。\n--EOF\n引用链接\n[1] 深圳大湾区数字经济研究院(IDEA): https://idea.edu.cn/\n[2] 封神榜大模型: https://github.com/IDEA-CCNL/Fengshenbang-LM\n[3] 仓库的指引: https://github.com/IDEA-CCNL/Fengshenbang-LM#%E4%BD%BF%E7%94%A8docker\n[4] Issue 里的记录: https://github.com/IDEA-CCNL/Fengshenbang-LM/issues/186\n[5] github.com/soulteary/docker-stable-diffusion-taiyi: https://github.com/soulteary/docker-stable-diffusion-taiyi\n[6] 构建的: https://hub.docker.com/layers/fengshenbang/pytorch/1.10-cuda11.1-cudann8-devel/images/sha256-00000cd554f202391c27bce3f0bad334e27041f7b925e282e31e811c5a5afa6b?context=explore\n[7] Web UI 项目: https://github.com/IDEA-CCNL/stable-diffusion-webui\n[8] DockerHub 的这个页面搜索: https://hub.docker.com/r/nvidia/cuda/tags?page=1\u0026name=11.3\n[9] 《使用 Docker 和 HuggingFace 实现 NLP 文本情感分析应用》: https://soulteary.com/2022/09/30/nlp-text-sentiment-analysis-application-using-docker-and-huggingface.html\n[10] 《在笔记本上搭建高性价比的 Linux 学习环境：基础篇》: https://soulteary.com/2022/06/21/building-a-cost-effective-linux-learning-environment-on-a-laptop-the-basics.html\n[11] NVIDIA/nvidia-container-runtime: https://github.com/NVIDIA/nvidia-container-runtime\n本文使用「署名 4.0 国际 (CC BY 4.0)」许可协议，欢迎转载、或重新修改使用，但需要注明来源。 署名 4.0 国际 (CC BY 4.0)","showReadNum":1773,"sourceType":99,"status":2,"summary":"本篇文章，我们聊聊如何使用 Docker 快速运行中文 Stable Diffusion 模型：太乙。","tagIds":[10318,10813,10681,10649],"title":"使用 Docker 来快速上手中文 Stable Diffusion 模型：太乙","uid":1436546,"updateTime":1678008934,"userSummary":"","userUpdateTime":1678008934},"authorInfo":{"uid":1436546,"nickname":"soulteary","avatarUrl":"https://ask.qcloudimg.com/http-save/yehe-1436546/8ff3879a73799b17b355bfdd88337c0b.jpg","introduce":"游戏迷、网瘾“少”年。","isProfessionVerified":0,"company":"数字化领域的","title":"创业者"},"authorType":{"isInternalAuthor":0,"isCoCreator":0,"isOriginalAuthor":1,"isBlogMoveAuthor":1},"classify":[{"2":"人工智能"}],"columnInfo":{"columnAvatar":"https://ask.qcloudimg.com/column-icons/73784/1436546/vy3xz4eqnz.png","columnDesc":"","columnId":73784,"columnName":"为了不折腾而去折腾的那些事","createTime":1544852431,"createUid":1436546,"memberNum":1,"showArticleNum":300,"showConcernNum":32},"cost":{"checkTencent":2,"getAuthorInfo":24,"getTextLink":28,"needArticleData":2,"needBlog":1,"needClassify":3,"needColumn":1,"needDetail":6,"needLongtailTag":12,"needTag":26,"queryUserAuthorType":11},"editTime":0,"isTencent":false,"longtailTags":[],"publishTime":1678008934,"sourceDetail":{"blogType":1,"channelSource":"wechat","originalTime":"2022-12-09","sourceAuthor":"折腾技术","sourceLink":"https://mp.weixin.qq.com/s?__biz=MzU3NTcxNTE1Mg==\u0026mid=2247485707\u0026idx=1\u0026sn=18d0e37087c01d2668bb21bb7171bcc4\u0026chksm=fd1fab34ca682222b611b52485edaabe6a31fd32b7d57bddd69a51cc2763d02f571a74fa91e8#rd","wechatNickName":"折腾技术","wechatUserName":"gh_8463ebf39241"},"tags":[{"tagId":10318,"tagName":"docker","categoryId":3,"groupId":10136,"groupName":"服务器技术","createTime":"2018-05-11 12:38:26"},{"tagId":10813,"tagName":"https","categoryId":3,"groupId":10555,"groupName":"网络技术","createTime":"2018-09-06 18:31:36"},{"tagId":10681,"tagName":"网络安全","categoryId":3,"groupId":10555,"groupName":"网络技术","createTime":"2018-09-06 18:31:32"},{"tagId":10649,"tagName":"容器","categoryId":3,"groupId":10136,"groupName":"服务器技术","createTime":"2018-08-31 17:19:35"}],"textLink":[{"id":3663,"text":"Stable Diffusion","link":"https://cloud.tencent.com/developer/techpedia/1966","sources":[2],"ext":{"termId":1966,"pCategoryId":1002,"categoryId":1019,"categoryName":"通用技术 - 人工智能","name":"Stable Diffusion","desc":"Stable Diffusion是一种潜在变量模型的扩散模型，由慕尼黑大学的CompVis研究团体开发的各种生成性人工神经网络，主要用于根据文本的描述产生详细图像。","kpCount":8}},{"id":466,"text":"容器镜像","link":"https://cloud.tencent.com/product/tcr","sources":[1],"ext":null},{"id":52,"text":"数据安全","link":"https://cloud.tencent.com/solution/data_protection","sources":[1,2],"ext":{"termId":1724,"pCategoryId":1002,"categoryId":1030,"categoryName":"通用技术 - 安全","name":"数据安全","desc":"数据安全是指保护数据不受非法或未经授权的访问、使用、泄露、修改、破坏等威胁和风险的一系列措施和技术。","kpCount":7}},{"id":2,"text":"云服务器","link":"https://cloud.tencent.com/act/pro/promotion-cvm","sources":[1,2],"ext":{"termId":1000,"pCategoryId":1000,"categoryId":1004,"categoryName":"云产品 - 计算","name":"云服务器","desc":"云服务器（Cloud Virtual Machine，CVM）提供安全可靠的弹性计算服务。 您可以实时扩展或缩减计算资源，适应变化的业务需求，并只需按实际使用的资源计费。使用 CVM 可以极大降低您的软硬件采购成本，简化 IT 运维工作。","kpCount":458}},{"id":3291,"text":"容器编排","link":"https://cloud.tencent.com/developer/techpedia/1530","sources":[2],"ext":{"termId":1530,"pCategoryId":1002,"categoryId":1024,"categoryName":"通用技术 - 云原生","name":"容器编排","desc":"容器编排是一种自动化的过程，用于管理容器化应用程序的部署、扩展、运行和维护。","kpCount":3}},{"id":374,"text":"服务器","link":"https://cloud.tencent.com/act/pro/promotion-cvm","sources":[1],"ext":null},{"id":3285,"text":"虚拟机","link":"https://cloud.tencent.com/developer/techpedia/1523","sources":[2],"ext":{"termId":1523,"pCategoryId":1002,"categoryId":1020,"categoryName":"通用技术 - 云计算","name":"虚拟机","desc":"虚拟机（Virtual Machine，简称VM）是一种软件模拟的计算机系统，它可以在物理计算机上运行多个操作系统和应用程序。","kpCount":3}},{"id":375,"text":"云主机","link":"https://cloud.tencent.com/product/cvm","sources":[1],"ext":null},{"id":3531,"text":"Windows","link":"https://cloud.tencent.com/developer/techpedia/1822","sources":[2],"ext":{"termId":1822,"pCategoryId":1002,"categoryId":1026,"categoryName":"通用技术 - 操作系统","name":"Windows","desc":"Windows是一种操作系统，由微软公司开发和维护。它是一种图形用户界面的操作系统，允许用户使用鼠标和键盘来与计算机进行交互。Windows操作系统提供了许多功能，包括文件管理、网络连接、多媒体播放、游戏等。","kpCount":11}},{"id":442,"text":"容器","link":"https://cloud.tencent.com/product/tke","sources":[1,2],"ext":{"termId":1532,"pCategoryId":1002,"categoryId":1024,"categoryName":"通用技术 - 云原生","name":"容器","desc":"容器是一种轻量级的虚拟化技术，它允许将应用程序及其依赖项打包在一起，形成一个独立、可移植的运行环境。","kpCount":11}},{"id":3660,"text":"Ubuntu","link":"https://cloud.tencent.com/developer/techpedia/1963","sources":[2],"ext":{"termId":1963,"pCategoryId":1002,"categoryId":1026,"categoryName":"通用技术 - 操作系统","name":"Ubuntu","desc":"Ubuntu操作系统是一个基于Linux内核的自由、开源、免费的桌面和服务器操作系统。它由Canonical公司开发和维护，是最受欢迎的Linux操作系统之一。Ubuntu操作系统具有易用性、稳定性、安全性、兼容性等特点，支持多种桌面环境和软件，适用于桌面、服务器、云计算、物联网等各种场景。","kpCount":12}},{"id":3530,"text":"Linux","link":"https://cloud.tencent.com/developer/techpedia/1821","sources":[2],"ext":{"termId":1821,"pCategoryId":1002,"categoryId":1026,"categoryName":"通用技术 - 操作系统","name":"Linux","desc":"Linux是一种开源的操作系统，它由Linus Torvalds在1991年创建。它基于Unix操作系统，具有高度的稳定性、安全性和可靠性。Linux操作系统可以在各种计算机硬件上运行，包括个人电脑、服务器、移动设备和嵌入式系统。","kpCount":16}},{"id":5,"text":"GPU","link":"https://cloud.tencent.com/act/pro/promotion-cvm","sources":[1],"ext":null}]}},"tdk":{"title":"使用 Docker 来快速上手中文 Stable Diffusion 模型：太乙-腾讯云开发者社区-腾讯云","keywords":"docker,https,网络安全,容器","description":"本篇文章，我们聊聊如何使用 Docker 快速运行中文 Stable Diffusion 模型：太乙。"},"meta":{"subject":"通用技术-服务器技术-docker,通用技术-网络技术-https,通用技术-网络技术-网络安全,通用技术-服务器技术-容器","subjectTime":"2023-03-05 17:35:34","articleSource":"W","magicSource":"N","authorType":"O,Z"},"link":{"canonical":"https://cloud.tencent.com/developer/article/2233624"},"cssName":["Article","DraftMaster","Player"]}},"page":"/article/[articleId]","query":{"from":"15425","articleId":"2233624"},"buildId":"hXS71qMqfq_tE1vHov7vW","assetPrefix":"https://qccommunity.qcloudimg.com/community","isFallback":false,"gssp":true,"appGip":true,"scriptLoader":[]}</script><script src="./docker-compose_files/qcloudStatApi.js"></script><script src="./docker-compose_files/community-track.374ca54a.iife.js"></script><script>
          if (window.QC_COMMUNITY_TRACK) {
            var track = new QC_COMMUNITY_TRACK();
            Object.defineProperty(window, 'QC_TRACK_INSTANCE', {
              value: {
                get report() {
                  return track.report;
                },
              },
              writable: false,
            });
          }
    </script><next-route-announcer><p aria-live="assertive" id="__next-route-announcer__" role="alert" style="border: 0px; clip: rect(0px, 0px, 0px, 0px); height: 1px; margin: -1px; overflow: hidden; padding: 0px; position: absolute; width: 1px; white-space: nowrap; overflow-wrap: normal;"></p></next-route-announcer><iframe allow="join-ad-interest-group" data-tagging-id="AW-940175154" data-load-time="1703934456334" height="0" width="0" style="display: none; visibility: hidden;" src="./docker-compose_files/940175154.html"></iframe><div id="syno-notification-is-installed"></div><div id="tea-overlay-root"></div></body></html>